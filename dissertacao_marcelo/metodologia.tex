
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Metodologia Proposta
%% Copyright 2009 Marcelo de Oliveira Lima.
%% Este documento é distribuído nos termos da licença 
%% GNU General Public License v2.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Projeto Completo de Redes Ópticas em Hierarquia}
\label{metodo}
\thispagestyle{empty}

O tipo de topologia para redes ópticas com roteamento por comprimento de onda mais estudado na literatura é a topologia em malha. No entanto, existem trabalhos
que exploram redes com arquitetura em hierarquia, mais precisamente anéis em hierarquia \cite{fonseka}, \cite{spie06}, \cite{conftele07}. Contudo, até onde
possuímos conhecimento, a junção destes dois tipos de arquiteturas ainda não foi explorado no contexto de WRONs. Neste trabalho, decidiu-se por estudar uma
arquitetura de malhas em hierarquia, onde existe uma sub-rede na hierarquia superior que será chamada de \textit{backbone}, cujos seus nós pertencem cada um a
uma outra sub-rede de hierarquia inferior. Cada sub-rede inferior é chamada de \textit{cluster}. Estas sub-redes podem assumir arquiteturas em malha
ou anel, de acordo com o grau lógico em estudo. Quando se trabalha com grau lógico 1, trata-se de um anel, caso contrário de uma topologia em malha. A figura
\ref{fig:hierarquia} ilustra uma topologia hierárquica genérica. 

\begin{figure}[htb!]
 \begin{center}
 \includegraphics[scale=1.1]{./figs/hierarquica.eps}
 % hierarquica.eps: 0x0 pixel, 300dpi, 0.00x0.00 cm, bb=0 0 238 170
 \caption{Exemplo de topologia de rede em hierarquia.}
 \label{fig:hierarquia}
 \end{center}
\end{figure}


O objetivo principal deste trabalho é criar uma metodologia que viabilize o projeto completo de malhas hierárquicas, aproveitando o potencial da
modelagem TWA, juntamente com métodos heurísticos. Tomando como requisitos apenas um conjunto de nós de rede, com sua disposição geográfica e requisições de
tráfego esperadas. O projeto completo abrange aqui, além das variáveis de decisão suportadas pelo modelo TWA, a escolha da estrutura hierárquica da rede.

Idealmente, o projeto completo de uma malha hierárquica poderia ser feito incluindo restrições no TWA que modelassem a hierarquia, semelhante ao que foi
feito em \cite{tesetommy}. Todavia, com o objetivo de tratar do projeto de redes de grande porte, optamos por uma abordagem simplificada em termos de modelagem
matemática, deixando a escolha da composição das sub-redes a cargo de uma heurística desenvolvida a partir de algoritmos genéticos. Conforme mencionado, as
hierarquias projetadas neste trabalho terão apenas dois níveis, com um \textit{backbone} central e \textit{clusters} periféricos, de forma semelhante aos
exemplos encontrados na literatura para anéis hierárquicos.

Uma simplificação adotada é que as ligações entre os \textit{clusters} e o \textit{backbone} serão opacas, ou seja, todos os componentes de uma ligação lógica
estão em um mesmo nível da hierarquia. Deste modo, o \textit{backbone} e os \textit{clusters} podem ser vistos como redes independentes, exceto pelo tráfego que
cruza de um nível hierárquico para outro, chamado de tráfego de acesso. Este tráfego pode ser acumulado nos nós de acesso ao \textit{backbone} (como
será mostrado na Seção \ref{sec:fitness}), de modo que sua distribuição e roteamento podem ser feitos paralelamente em cada sub-rede.

Assim, para definir a estrutura hierárquica basta separar os nós da rede em conjuntos, que formarão cada \textit{cluster}, e escolher em cada um qual será
o nó de acesso ao \textit{backbone}. Por sua vez, este último será formado pelo conjunto de nós de acesso, também chamados de super-nós \cite{spie06},
\cite{conftele07}.

Dessas considerações, temos que cada sub-rede pode ser projetada separadamente, eliminando a necessidade de uma modelagem para toda a hierarquia.

A escolha da estrutura hierárquica, como será definida, é um Problema de Cobertura de Conjuntos (PCC), com uma função objetivo especial. A formulação
clássica
do PCC é um problema de programação linear inteira NP-completo \cite{cormen02}. Portanto, abordagens heurísticas são adequadas para sua resolução. Neste
trabalho utilizamos um algoritmo genético nesta etapa.
  
Tendo sido determinada a estrutura hierárquica, cada sub-rede é modelada com o TWA. Nesta fase, a estratégia adotada foi definir parâmetros de qualidade
satisfatórios para as variáveis de interesse, de modo que qualquer solução viável encontrada já seria suficiente para garantir a qualidade do projeto.

As variáveis de interesse em questão são o congestionamento da rede, o total do tráfego retransmitido, o custo de instalação da rede física, o número de
comprimentos de onda utilizados e o número total de transceptores utilizados. As duas primeiras são comumente tratadas pela literatura no projeto de topologias
lógicas (VTD), sem considerar o projeto da rede física ou o roteamento e alocação de comprimentos de onda (RWA) \cite{ram02}.

Para estabelecer parâmetros de qualidade para congestionamento e tráfego retransmitido, são estimados estatisticamente as médias e desvios padrões de suas
populações de soluções viáveis para o VTD, em cada sub-rede. Nessas inferências é garantida a representatividade das amostras obtidas, como será mostrado na
seção \ref{sec:subredes:estatisticas}.

Para o número de comprimentos de onda, foi utilizada uma estratégia adotada anteriormente em \cite{SBPO2009}. Tentamos obter soluções com um comprimento
de onda apenas e vamos incrementando esse número enquanto não for possível encontrar soluções viáveis. Essa técnica deriva de uma característica do TWA, pois o
número de variáveis no modelo é múltiplo do número de comprimentos de onda adotado.
%O que torna viável essa investigação partindo dos menores números de comprimentos de onda. 

Por sua vez, o custo de instalação da rede física é controlado garantindo que seja menor, proporcionalmente, que o custo de uma rede real bem conhecida, a
NSFNET \cite{ram02}. A forma como é estabelecida essa proporcionalidade será descrita na seção \ref{sec:subredes:custo_fisico}. Estamos considerando como
custo de instalação apenas a distância entre os nós da rede, que representa o comprimento dos enlaces de fibra instaladas entre os mesmos. O dimensionamento dos
nós poderá ser feito com base no projeto obtido desta metodologia, que deverá demandar o mínimo possível de recursos da rede.

No projeto de topologias lógicas, o número de transceptores da rede normalmente define as instâncias do problema \cite{ram02}, pois está relacionado com o
dimensionamento dos nós da rede. Essa abordagem também foi utilizada aqui, todavia, na literatura é comum definir o número exato de transceptores que cada
instância possui, pelo produto entre grau lógico e o número de nós da rede, com níveis diferentes de limitação de tráfego para cada uma \cite{Sivarajan01}.
Neste trabalho, nós apenas limitamos o número de transceptores, permitindo que o modelo encontre soluções mais econômicas para este parâmetro.

As próximas seções são dedicadas a explicação detalhada dos principais aspectos que compõem as etapas da metodologia proposta. Uma visão geral do procedimento
está apresentada na figura\ref{fig:descr.proc}. Existem três etapas sequenciais.


\begin{figure}[!htb]
\begin{center}
\includegraphics[scale=0.9, angle=270]{./figs/metodologia.eps}
% descr.proc.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=
\caption{Resumo da metodologia de projeto.}
\label{fig:descr.proc}
\end{center}
\end{figure}


Na primeira etapa, são fornecidos como dados as matrizes de demandas de tráfego e distâncias, únicos dados de entrada do projeto. Um algoritmo
genético faz a separação dos nós em sub-redes. Sua função objetivo minimiza o tráfego transferido entre as sub-redes e a distância entre os
nós, ou seja, procura-se concentrar o tráfego no interior das sub-redes, e formá-las com nós geograficamente próximos. Um resultado secundário dessa fase
são as matrizes de distância e tráfego para cada sub-rede.

Na fase intermediária, são obtidos os limites superiores (\textit{upper bounds} - UB) para o congestionamento e o tráfego retransmitido na rede, por meio de
inferência estatística baseada na média e desvio padrão dos resultados das avaliações de amostras de soluções viáveis para o VTD. Estes limites superiores são
valores máximos admissíveis para o congestionamento e o tráfego retransmitido, impostos às variáveis do modelo de programação inteira-mista para garantir, com
relação a estas métricas, a qualidade da solução a ser obtida na próxima etapa . Além dos UB, para validar os resultados, são também calculados limites
inferiores teóricos (\textit{lower bounds} - LB) para essas métricas. As formulações para os LB foram apresentadas por \cite{dissertFabio}, e os UB são
calculados a partir da média e do desvio padrão. Por fim, também são calculados UB para o custo de instalação física de cada sub-rede.

A última etapa consiste na resolução do modelo TWA para cada sub-rede, respeitando os \textit{bounds} (UB e LB) calculados e visando utilizar o menor número
possível de comprimentos de onda. O resultado desta última fase fornece a solução do projeto, representado pelas topologias física e lógica, bem como a forma de
roteamento e alocação dos comprimentos de onda, em função da da distribuição das demandas de tráfego esperadas. Esses resultados são referentes às sub-redes em
separado, porém, quando são agrupados, representam o resultado global para uma WRON com topologias hierárquicas.


\section{Estrutura Hierárquica}
\label{sec:EstruturaHierarquica}

%%%%% Redação antiga %%%%%%%%%%%%%%%
% A quantidade e o tamanho dos 
% \textit{clusters} é livre, sendo definido apenas um mesmo número $M_i$ para o mínimo de \textit{clusters} e o seu tamanho mínimo. Deste modo, se
% a rede possui $n$ nós, então o número máximo de \textit{clusters} e seu tamanho máximo ($M_a$) será igual a $\lfloor n/M_i \rfloor$.

A quantidade e o tamanho dos \textit{clusters} é livre, sendo definidos um tamanho máximo $M_a$ e um mínimo $M_i$, além da quantidade máxima de
clusters $Q_a$. Uma quantidade mínima de \textit{clusters} fica implicitamente definida por esses valores, não sendo necessário controlá-la.
 Assim, uma rede de $n$ nós e $k$ \textit{clusters}, é representada por dois vetores. Um vetor de tamanho $k$ contendo os tamanhos dos \textit{clusters}
($T=(t_1,\cdots,t_k)$) e outro
de tamanho $n$ contendo uma permutação dos nós da rede ($P=(p_1,\cdots,p_n)$). Onde o primeiro \textit{cluster} é representado por $(p_1,\cdots,p_{t_1})$, o
segundo por $(p_{[1+\,t_1]},\cdots,p_{[t_1+\,t_2]})$, e o $i$-ésimo \textit{cluster} é representado por:

$$(p_{[1+\,s_{(i\,-1)}]},\cdots,p_{[s_{i}]})\mbox{, onde } s_i=t_1 + t_2 + \cdots + t_i$$

Em cada \textit{cluster}, o primeiro nó da sequência é interpretado como o nó de acesso ao \textit{backbone}. Portanto, o \textit{backbone} é representado
por:

$$(p_1,p_{[1+\,t_1]},\cdots,p_{[1+\,s_{(k\,-1)}]})$$

Para a escolha da estrutura hierárquica da rede foi implementado um algoritmo genético com a biblioteca {\itshape Galib} (Apéndices \ref{ga} e
\ref{galib}). Para representar a hierarquia, é definido um cromossomo utilizando um vetor de tamanho $n+Q_a$, contendo uma
permutação dos números inteiros positivos até esse valor: $n$ números para representar os nós da rede mais $Q_a$ números, candidatos a tamanho de
\textit{cluster}. 
A interpretação do cromossomo como uma hierarquia é feita da seguinte forma: 

\begin{enumerate}
\item Separa-se o cromossomo em dois vetores, mantendo-se a ordem dos números. O primeiro, de tamanho $n$, contém os números menores ou iguais à $n$. Este
é o vetor $P$, uma permutação dos nós da rede. O segundo vetor ($C=(c_1,\cdots,c_{Q_a})$) contém os números maiores que $n$ e dará origem ao vetor de
tamanhos
$T$. 
\item A partir de $c_1$, iterativamente, faz-se $t_i= M_i + [c_i\mod\Delta]$, enquanto $n - s_i \geqslant M_i$, onde $\Delta = (M_a - M_i)$ e $s_i$ como
definido acima. Ou seja, enquanto o número de nós
restante não for menor que o mínimo admitido para formar outro \textit{cluster}. Quando isso ocorrer, descarta-se o valor calculado para $t_i$ e forma-se o
último \textit{cluster} com os nós restantes. 
\end{enumerate}

Note que o cálculo de $t_i$, como foi definido acima, leva o valor de $c_i$ para um intervalo de possíveis tamanhos de \textit{clusters}. Os valores que
darão origem ao vetor de tamanhos $T$, foram definidos como números maiores que $n$ para simplificar a codificação do cromossomo. Sendo este uma simples
permutação de inteiros entre $1$ e $n+Q_a$, sem uma estrutura particular, permitiu utilizar operadores genéticos pré disponíveis na biblioteca
\textit{Galib} e bem conhecidos na literatura \cite{ga2}. São eles os operadores genéticos do código $Ex26$ da \textit{Galib}, com a
função de cruzamento: \textit{Edge Recombination Crossover}. 

A estrutura de cromossomo utilizada não permite ao algoritmo genético visitar todas as possíveis configurações da hierarquia, da forma como foi definido na
início desta seção. Dentre as limitações, destaca-se o fato do desenho do cromossomo inibir a criação de hierarquias com \textit{clusters}
de tamanho uniforme. Pois os tamanhos são retirados de uma permutação dos números de $n+1$ até $n+Q_a$, módulo $\Delta$; isso dificulta ocorrer
entradas repetidas no vetor de tamanhos. Além disso, deve-se garantir que a soma de tamanhos possíveis cobre $n$, o que pode não ocorrer dependendo dos
valores de $M_a$, $M_i$ e $Q_a$. Isso é garantido se a inequação a seguir for verdadadeira:

$$ n \leqslant \sum_{i=1}^{Q_a} M_i + [(n + i)\mod\Delta] $$ 

Essas desvantagens no modelo do cromossomo são compensadas, pelo fato dos operadores genéticos utilizados suportarem indivíduos formados por permutação de
números inteiros, sem gerar soluções inviáveis. Isso contribui para a eficiência do algoritmo \cite{ga1}, pois evita visitar soluções que não contribuem
para a melhora na evolução. Além disso, economizou-se o esforço em seu desenvolvimento, implementação e validação.

O algoritmo genético adotado foi o \textit{GADemeGA}, também disponível na \textit{Galib}, que mantém populações paralelas com probabilidade de migração
a cada geração da evolução. Os parâmetros de configuração das funções da \textit{Galib} foram mantidos em seus valores padrão e demostraram desempenho
satisfatório, mas para implementações mais robustas é recomendado que sua calibragem seja melhor estudada.


\section{Qualidade da Estrutura Hierárquica}
\label{sec:fitness}

Além da codificação do cromossomo e da escolha das funções da \textit{Galib} a serem utilizadas, o algoritmo genético se completa com a definição da sua
função objetivo, que atribuirá uma métrica de qualidade para os cromossomos. 

Dois parâmetros importantes no projeto de uma rede são os custos de instalação e operação da mesma \cite{bannister90}, \cite{liu2008}, \cite{guan}. Na separação
dos conjuntos de nós que formarão as sub-redes um fator que influencia fortemente no custo de instalação é a distância entre os nós. Se as sub-redes forem
agrupados de modo que nós próximos façam parte do mesmo conjunto, haverá uma tendência de menor custo de instalação dos enlaces. Por esse motivo, a distância
média entre os nós é uma boa métrica para minimizar o custo de instalação físico.

Não obstante, se dois nós que possuem grande quantidade de demanda de tráfego entre eles estiverem no mesmo \textit{cluster}, eles deixarão de rotear pelo
\textit{backbone} esse forte fluxo. Se essa tendência se mantiver por toda a rede, com as maiores demandas representando tráfego doméstico dos
\textit{clusters}, é razoável supor que esta configuração poupará custo de operação da rede, pois estará reduzindo o tráfego de acesso ao \textit{backbone} e
também o retransmitido entre nós intermediários. Definimos tráfego de acesso como sendo todo aquele que cruza as hierarquias da rede, em ambos os sentidos, ou
seja, se origina em uma sub-rede com destino a outra. Destaca-se que para efeito de resultados do projeto, ele é computado apenas nos super-nós que fazem a sua
interface entre hierarquias distintas, pois nos demais nós ele é contabilizado indistintamente como tráfego retransmitido.

A figura \ref{fig:ga.group} ilustra o processo de decisão do genético, onde ele busca agrupar os nós fisicamente mais próximos e ao mesmo tempo
seleciona em cada grupo, ou sub-rede, um nó que será utilizado como interface entre as demais sub-redes, de forma a minimizar o tráfego de acesso. Esses nós de
acesso estão destacados no interior de cada sub-rede. 


\begin{figure}[!htb]
\begin{center}
\includegraphics[scale=1.3, angle=270]{./figs/ga_group.eps}
\caption{Ilustração do processo de decisão do genético.}
\label{fig:ga.group}
\end{center}
\end{figure}


Deste modo, a função objetivo do algoritmo genético foi definida como a soma da distância média entre os nós da hierarquia ($M$) com o total de tráfego
de acesso ao \textit{backbone} ($T$). Esses valores podem ser calculados sem que seja necessário conhecer a estrutura completa da rede, basta sabermos a
estrutura hierárquica, como foi definida na seção anterior.

Como resultado do algoritmo genético, além da estrutura hierárquica da rede, também são derivadas as matrizes de demanda e distância de cada sub-rede. As
matrizes de distâncias são apenas um subconjunto da original. Enquanto que as matrizes de demanda acumulam nos nós de acesso todo tráfego que deverá entrar no
\textit{cluster} e sair dele.

A equação \ref{DefDistMed} define a fórmula de cálculo para $M$. Primeiro calcula-se a soma das distâncias entre os nós de cada grupo, \textit{backbone}
($TDist_{bk}$) e \textit{clusters} ($TDist_{cl}$), e a média desses valores é tomada como a distância média da hierarquia. Dependendo do estudo de caso em
questão, pode ser de interesse ponderar esses termos, possivelmente atribuindo maior peso às distâncias do \textit{backbone}. Na equação \ref{DefDistMed} esses
pesos ($PesoDist_{bk}$ e $PesoDist_{cl}$) estão apresentados multiplicando seus respectivos termos de distância. O denominador no cálculo de $M$
é a soma da quantidade de termos contidos nas matrizes de distâncias do \textit{backbone} ($NumDist_{bk}$) e dos \textit{clusters} ($NumDist_{cl}$).

\begin{equation}
M = \frac{TDist_{bk}\cdot PesoDist_{bk} + TDist_{cl}\cdot PesoDist_{cl}}{NumDist_{bk} + NumDist_{cl}}
\label{DefDistMed}
\end{equation} 

Para calcular o tráfego de acesso em um super-nó, soma-se todo o tráfego originado dentro do seu \textit{cluster} cujo destino são nós de outros
\textit{clusters}, mais o tráfego da condição inversa. Ou seja, que origina-se em outros \textit{clusters} e possui destino no interior do \textit{cluster} a
que pertence o referido super-nó. Acumulando-se essa soma para todos os super-nós, temos o total de tráfego de acesso da rede $T$.

A equação \ref{DefTrafAcesso} mostra que o total de tráfego de acesso também pode ser ponderado ($PesoTrafAcesso$) de acordo com o interesse do estudo
realizado.

\begin{equation}
T = TrafAcesso\cdot PesoTrafAcesso
\label{DefTrafAcesso}
\end{equation} 

Nos experimentos que serão apresentados no próximo capítulo, as entradas das matrizes de demanda de tráfego e distância possuem a mesma ordem de grandeza.
Podendo representar respectivamente a taxa de transferência de pacotes em $Gbits/s$ e centenas de quilômetros de distância por exemplo. Fica claro que neste
caso $M$, por ser uma média, tem ordem de grandeza bem inferior à de $T$, que é uma soma simples. Portanto, para garantir o equilíbrio entre as duas
métricas, um teste piloto deve ser feito para estabelecer uma proporção que deixe $M$ e $T$ com a mesma ordem de grandeza. Feito isso, também é possível
atribuir pesos para cada um, conforme for o interesse do estudo de caso em questão. A equação \ref{DefFitness} ilustra a fórmula de cálculo da função objetivo
do genético (\textit{fitness}), ilustrando o uso de um fator de calibragem ($C_a$) a fim de tornar $M$ e $T$ compatíveis em termos de ordem de grandeza.

\begin{equation}
Fitness = M\cdot C_a + T
\label{DefFitness}
\end{equation} 

O critério de parada adotado para o algoritmo genético foi a convergência da função objetivo, baseada na estagnação da função objetivo. Quando deixar de
haver melhora na evolução por um dado número de gerações, o algoritmo genético é interrompido. A eficiência deste critério também será analisada quando
forem feitos experimentos computacionais. 


\section{Qualidade do Projeto das Sub-Redes}
\label{sec:subredes}

Para cada sub-rede, são definidos conjuntos de parâmetros de qualidade para o seu projeto. Esses parâmetros devem ser considerados satisfatórios para cada
instância, representando uma qualidade elevada para a rede, pois na última etapa do procedimento eles serão fornecidos para o modelo TWA a fim de se obter uma
solução viável que atenda a todos esses parâmetros.

Distinguindo as instâncias pelo grau lógico, para o congestionamento nas sub-redes e o total de tráfego retransmitido nas mesmas, são analisadas
estatisticamente as populações de soluções para o VTD. Pois essas são métricas comumente tratadas nesse problema \cite{ram02}. Dessa análise, serão
estabelecidas as limitações para o congestionamento e para o tráfego retransmitido. Além disso, também será definida uma limitação para o custo de instalação da
rede física, que é independente da instância.

Na seção \ref{sec:subredes:estatisticas} será explicado o processo de estimação das estatísticas para congestionamento e tráfego retransmitido. O critério de
limitação do custo de instalação está descrito na seção \ref{sec:subredes:custo_fisico}. Por fim, para que as limitações das métricas possam ser repassadas ao
modelo TWA serão necessárias restrições adicionais, sendo estas apresentadas na seção \ref{sec:subredes:restricoes}.


\subsection{Congestionamento e Tráfego Retransmitido}
\label{sec:subredes:estatisticas}

Conforme os trabalhos que tratam do VTD, as instâncias são determinadas pelo número total de transceptores utilizados, que é uma função do grau lógico da
rede. Pois o número total de transceptores utilizados é dado justamente pelo número de nós da rede multiplicado pelo seu grau lógico \cite{ram02}. 

Deste modo, para cada grau lógico geramos aleatoriamente uma amostra de soluções para a topologia lógica da rede. Modelos de programação linear foram
implementados em \textit{AMPL} \cite{ampl} para distribuir o tráfego da rede sobre cada topologia lógica, através do solver \textit{GLPK} (\textit{GNU
Linear Programming Kit} - gnu.org/software/glpk). Obtendo, para cada topologia lógica gerada, a distribuição de tráfego ótima para o congestionamento da
rede e também para o total do tráfego retransmitido \cite{Renato06}.

Dessas amostras estimamos a média e o desvio padrão das populações para o congestionamento e para o tráfego retransmitido, garantindo a representatividade de
cada amostra. Esta estimação se classifica como um problema de Estatística Indutiva \cite{estatistica}, que tem como objetivo tirar conclusões probabilísticas
sobre aspectos das populações, com base na observação de amostras extraídas das mesmas. Estas amostras servem de base para inferências que são feitas a cerca
das respectivas populações. Para tanto, supõe-se que os valores da população se distribuem segundo um dado modelo de distribução de probabilidade cujos
parâmetros necessitam ser estimados. Segundo \cite{estatistica}, esta suposição é plausível, pois, em muitos casos, pode-se antecipar com razoável precisão, um
modelo para a distribuição da população. O processo de estimação de parâmetros utilizado é denominado de estimação por intervalo, onde é contruído um intervalo,
o qual deve, com probabilidade conhecida, conter o parâmetro.

Chamamos de estimador a quantidade, calculada em função dos elementos da amostra, que será usada no processo de estimação do parâmetro desejado. O estimador é
uma estatística e será, portanto, uma variável aleatória caracterizada por uma distribuição de probabilidade e seus respectivos parâmetros próprios. E
chamaremos de estimativa cada particular valor assumido por um estimador.

Ao intervalo que, com probabilidade conhecida, deverá conter o valor real do parâmetro chamaremos intervalo de confiança para esse parâmetro. À probabilidade,
que será designada por $1 - \alpha$, de que um intervalo de confiança contenha o valor do parâmetro chamaremos grau de confiança do respectivo intervalo. Dessa
forma, vemos que $\alpha$ será a probabilidade de erro na estimação por intervalo, isto é, a probabilidade de errarmos ao afirmar que o valor do parâmetro está
contido no intervalo de confiança. Será suposto que os intervalos de confiança são simétricos em probabilidade, isto é, a probabilidade do parâmetro ficar fora
do intervalo à sua esquerda é igual à probabilidade de ficar fora à direita, ambas iguais a $\alpha/2$. A partir do exposto, pode-se afirmar que o
  intervalo conterá ou não o parâmetro, com probabilidade $1 - \alpha$ e $\alpha$, respectivamente.

Para determinar o tamanho necessário de cada amostra, de modo que estas sejam representativas para cada parâmetro estatístico estimado, utilizamos o método
interativo apontado por \cite{estatistica}. Para a média, o intervalo de confiança pode ser obtido por:

$$e_0 = Z_{\alpha/2}\cdot \frac{\sigma}{\sqrt{n}}$$

Onde $e = 2 \cdot e_0$ é a margem de erro, a amplitude de intervalo de confiança, $Z_p$ é a distribuição normal reduzida, $1 - \alpha$ é o nível de confiança
exigido, $\sigma$ é o desvio padrão populacional e $n$ é o tamanho da amostra. Mas ao invés de estimar o intervalo de confiança, desejamos, a partir de uma
margem de erro e nível de confiança desejados, estimar o tamanho de amostra necessário. Resolvendo a equação acima para $n$, temos:

$$n = \left( \frac{Z_{\alpha/2}\cdot \sigma}{e_0} \right)^2 $$

Onde $n$ agora é a estimativa para o tamanho da amostra. Embora não conheçamos o desvio padrão populacional $\sigma$, a relação a seguir permite a
substituição pela sua estimativa amostral $s$:

%$$s = \sqrt{\frac{\sum_{i=1}^{n} (X_i - \bar X)^2}{n-1}}$$

$$ t_{(n - 1, \alpha/2)} \cdot s = Z_{\alpha/2}\cdot \sigma $$

Onde $t_{(n - 1, p)}$ é a distribuição $t$ de \textit{Student} com $n - 1$ graus de liberdade, que faz compensar o efeito da maior incerteza embutida pelo
uso se $s$ no lugar de $\sigma$. Assim, ficamos então com:


\begin{equation}
n = \left( \frac{t_{(n' - 1, \alpha/2)}\cdot s}{e_0} \right)^2
\label{eq:est_med}
\end{equation} 


Onde $n'$ é o tamanho da amostra utilizada para calcular $s$. Agora, se $n\leqslant n'$, a amostra já terá sido suficiente para a estimação da média. Caso
contrário, mais elementos devem ser retirados aleatoriamente da população e adicionados à amostra, até que esta forneça uma estimativa $n\leqslant n'$.

Procedemos de forma análoga para estimar o tamanho de amostra representativa para a estimativa do desvio padrão, cujo intervalo de confiança pode ser obtido por
\cite{estatistica}:


\begin{equation}
e' = \sqrt{\frac{(n' - 1)\cdot s^2}{\chi^2_{(n' - 1, 1 - \alpha/2)}}} - \sqrt{\frac{(n' - 1)\cdot s^2}{\chi^2_{(n' - 1, \alpha/2)}}}
\label{eq:est_dp}
\end{equation} 


Onde $\chi^2_{(n - 1, p)}$ é a distribuição \textit{Qui-Quadrado} com $n - 1$ graus de liberdade e $e'$ é a amplitude do intervalo de confiança dada
pela amostra. Neste caso, vamos incrementando o tamanho da amostra ($n'$) até que $e'\leqslant e$, ou seja, até que o erro calculado seja menor ou igual ao
exigido. 

Em ambas as estratégias, para a média e para o desvio padrão, é certo que encontraremos um valor em que $n'$ seja representativo, pois $s$ converge para
$\sigma$ quando $n'$ aumenta. Todavia, quanto maior for o nível de certeza exigido e quanto menor for o erro aceito, maior será o tamanho de amostra
requerido.

% A rigor, em todos os casos, devíamos garantir que $n'$ é suficientemente grande para que a distribuição da média amostral seja aproximadamente normal,
% como garante o Teorema Central do Limite \cite{estatistica}. Pois não conhecemos de antemão as distribuições das populações. Entretanto, trabalhando com
% apenas uma amostra isso não é possível, mas podemos minimizar essa falta adotando amostras iniciais grandes. E a definição do quão grande devem ser as
% amostras iniciais pode ser estimada por testes piloto.

Para definição das formulações apresentadas para estimação da média, é suposto que a distribuição da média amostral é normal
\cite{estatistica}. Isso ocorrerá
se a população for normalmente distribuída ou, caso contrário, com boa aproximação, se a amostra for grande. Em nosso caso de estudo,
não se conhece de antemão a distribuição da população, porém o Teorema Central do Limite garante que se a amostra for suficientemente grande, no caso de
população infinita ou
amostragem com reposição, a distribuição da média amostral será aproximadamente normal. E ainda, quanto maior $n'$ mais a distribuição da média amostral se
aproximará da normal. Para verificar se $n'$ é grande o suficiente seria necessário gerar várias amostras e verificar se a distribuição das médias se aproxima
da normal. Para não ser necessário realizar essa verificação para todas as instâncias, foram feitos testes pilotos que estimam um tamanho mínimo para $n'$, de
forma que a distribuição das médias amostrais seja aproximadamente normal.
 
No caso da formulação para estimação do desvio padrão, a equação \ref{eq:est_dp} é exata para o caso de população normalmente distribuída \cite{estatistica}.
No entanto, em nossa aplicação não podemos fazer esta afirmativa de antemão, sendo aplicado de forma aproximada este método de estimação. Conforme será
apresentado no capítulo \ref{result}, a partir dos tamanhos de amostras calculados utilizando as equações \ref{eq:est_med} e \ref{eq:est_dp}, e ainda,
considerando observações experimentais, a convergência para as estimativas da média e do desvio padrão foi alcançada satisfatoriamente.

Para calcular as distribuições $t$ de \textit{Student} e \textit{Qui-Quadrado} foi utilizado o \textit{Math Toolkit}, uma biblioteca da linguagem de
programação \textit{C++} do repositório \textit{Boost} \cite{boost}. 

Os parâmetros estimados para o congestionamento darão suporte a escolha da restrição de capacidade do TWA. E por sua vez os parâmetros estimados para o
tráfego retransmitido serão utilizados para definir um limite superior para essa métrica.


\subsection{Custo Físico}
\label{sec:subredes:custo_fisico}

Neste trabalho, projetamos a rede desde sua topologia física. Nossa
metodologia visa obter uma alocação de recursos suficiente para atender aos requisitos impostos da forma mais econômica possível, mas sem sacrificar o
desempenho da rede. Mas, pela própria estrutura do modelo TWA, decisões de menor complexidade são deixadas de
fora, pois podem ser resolvidas em outras fases do projeto \cite{dissertFabio}. Por exemplo, não consideramos aqui o dimensionamento dos nós da rede. Pois
a estratégia é que uma boa solução nesta fase do projeto facilite as fases posteriores.

% Considerando que os enlaces de fibra óptica são bidirecionais, estamos considerando aqui como custo de instalação físico apenas o custo de instalação da
% primeira fibra (referência). Apoiados no fato de que os cabos atuais comumente possuem vários pares de fibra. Portanto, utilizar mais de uma fibra no
% mesmo
% enlace é mais uma questão de dimensionamento dos nós do que do enlace em si.

Outro fator a ser considerado é que a solução para a topologia física de uma rede não pode ser muito dependente da instância. Portanto é necessário um
critério de qualidade para a topologia física que não considere o número de transceptores, pois estes definirão as instâncias. Como critério de qualidade,
propomos aqui garantir que as redes criadas não sejam mais onerosas, proporcionalmente, do que alguma rede real bem conhecida.

Para estabelecer essa proporcionalidade, devemos obter uma razão adimensional que represente cada rede física,
para então confrontá-las. 

Isso pode ser feito tomando a razão entre a média por nó do custo de ligações físicas existentes ($FE = (1/N)\cdot\sum_{mn} C_{mn}\cdot D_{mn}$) e a média
do custo de todas as ligações físicas possíveis ($FP = \sum_{mn} C_{mn}/(N^2 - N)$). O que resulta na definição \ref{def:TIF}.

\begin{definicao}[TIF]
\label{def:TIF}
A Taxa de Instalação Física (TIF) é dada pela relação:
$$TIF = \frac{FE}{FP} = \frac{N\cdot(N - 1)}{N}\cdot \frac {\sum_{mn} C_{mn}\cdot D_{mn}}{\sum_{mn} C_{mn}} = (N - 1)\cdot \frac {\sum_{mn} C_{mn}\cdot
D_{mn}}{\sum_{mn} C_{mn}}$$ 
\end{definicao}

Para garantir a proporcionalidade, inicialmente calculamos a TIF para uma rede real que seria usada como referência. E as redes a serem projetadas usariam
essa TIF de referência como limitante superior. Ou ainda, pode-se embutir um \textit{TIFgap}, exigindo que a rede projetada tenha TIF $20\%$ ou $30\%$
abaixo da TIF de referência, por exemplo. Todavia, exigir um \textit{TIFgap} muito grande pode acarretar em inviabilidade.


\subsection{Restrições Adicionadas ao TWA}
\label{sec:subredes:restricoes}

Para incluir limitações superiores (\textit{Upper Bounds}) em variáveis de interesse, definimos a seguir restrições que devem ser adicionadas ao modelo TWA
do capítulo \ref{twa}.


\begin{dados}
\label{UBs}
\textit{Upper bounds}:
\begin{enumerate}
\item $TT$ $=$ Número total de transceptores na rede.
\item $TR$ $=$ Total tráfego retransmitido.
\item $TIF$ $=$ Taxa de Instalação Física.
\end{enumerate}
\end{dados}

\begin{equation}
\sum_{mnw} B_{mw}^{mn} \leqslant TT
\label{TT}
\end{equation}

\begin{equation}
\sum_{sijw} T\cdot q_{sw}^{ij}\cdot A_s \leqslant TR \mbox{, com } i\neq s.
\label{TR}
\end{equation}

\begin{equation}
\sum_{mn} C_{mn}\cdot D_{mn} \leqslant TIF\cdot \sum_{mn} C_{mn}/(N - 1) \mbox{, com } m<n.
\label{TIF}
\end{equation}

A equação \ref{TT} limita superiormente o número total de transceptores na rede, através da soma de todas as componentes topológicas cujo nó de início
($n$)
é o nó de origem das ligações lógicas. Dessa forma, não há exigência quanto a uniformidade do grau lógico na rede, e podemos obter soluções que demandem
de
uma quantidade menor de transceptores.

Por sua vez, a equação \ref{TR} limita superiormente a soma de todo o tráfego retransmitido na rede, pela soma de todas as componentes de tráfego cujo nó
de origem das ligações lógicas ($i$) é diferente da fonte de tráfego $s$. Esse \textit{upper bound} para o tráfego retransmitido nos permite garantir uma
qualidade mínima para a retransmissão do tráfego na rede.

Na restrição \ref{TIF}, que limita superiormente o custo de instalação da rede física, entra em cena a TIF que será imposta às instâncias da rede.
