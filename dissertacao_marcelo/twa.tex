
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Revisão das Teorias Utilizadas
%% Copyright 2009 Marcelo de Oliveira Lima.
%% Este documento é distribuído nos termos da licença 
%% GNU General Public License v2.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Modelo TWA}
\label{twa}


O modelo TWA (\textit{Traffic over Wavelength Assignment}) foi apresentado inicialmente em \cite{sbpo09}. Nesta seção a sua descrição será reproduzida conforme
aparece em  \cite{dissertFabio}. Essa formulação é capaz de tratar desde a escolha da topologia física de uma WRON até a definição da topologia virtual,
incluindo a distribuição de tráfego, a definição das rotas físicas e a alocação de comprimentos de onda. Este modelo possui um reduzido número
de variáveis e restrições, se comparado a modelos que resolvem apenas o RWA, como os que são tratados em \cite{Jaumard04}. Na literatura o projeto completo,
incluindo topologias física e lógica, foi modelado em \cite{Xin:03}, possuindo uma complexidade elevada, que torna o uso de
heurísticas uma exigência.

O TWA guarda semelhanças com alguns modelos conhecidos \cite{ram02, Tornatore07}. Fazendo uso das definições dos sub-problemas que compõem o projeto de redes
ópticas, conforme apresentados no capítulo \ref{redopt}, nas modelagens para o WA \cite{Zang00}, é designado um comprimento de onda a cada caminho óptico,
considerando o seu percurso físico determinado pelo WR. A configuração dos caminhos ópticos, em termos de quantidade, fonte e destino, é obtida pela solução do
VTD. Esta abordagem de modelos separados para VTD e RWA exige variáveis diferentes para as ligações lógicas, para suas rotas físicas e para a alocação de
comprimentos de onda \cite{Karcius04}.

O TWA propõe uma visão diferente.
Tendo sido alocados comprimentos de onda entre pares ordenados de nós com variáveis específicas, estarão determinadas implicitamente, pelas
restrições do modelo, as rotas físicas e as ligações lógicas entre esses pares de nós. Escrevendo todas as restrições do RWA e do VTD apenas em
termos dessas variáveis de alocação de comprimentos de onda, não serão necessárias variáveis adicionais para determinar as rotas físicas e as
ligações lógicas, o que simplifica o modelo e o torna computacionalmente mais tratável.

As restrições do TWA, em função das variáveis de alocação de comprimento de onda, determinam a configuração e o roteamento dos caminhos ópticos, o
que define as topologias física e lógica, além da alocação de comprimentos de onda. Restando apenas resolver a distribuição do tráfego. Esta última é
tradicionalmente feita em função das variáveis de topologia lógica e roteamento de tráfego do VTD \cite{ram02}, retornando a matriz de topologia
lógica e as requisições de tráfego designadas a cada um dos caminhos ópticos. A partir daí, a solução do VTD é fornecida como entrada para o RWA
\cite{Zang00}, na forma de uma matriz de requisições de tráfego associadas aos caminhos ópticos. Diferentemente do procedimento tradicional, o TWA possui
restrições para a distribuição do tráfego que também são escritas em função das variáveis de alocação de comprimentos de onda. Na prática, isso elimina as
restrições de distribuição de requisições de tráfego do RWA \cite{Zang00}. Isto está ilustrado na figura \ref{fig:VTD-RWA-TWA}.

\begin{figure}[htb]
\centering
\includegraphics[bb=103 327 597 452, scale=.9]{figs/VTD-RWA-TWA.eps}
% VTD-RWA-TWA.eps: 0x0 pixel, 300dpi, 0.00x0.00 cm, bb=103 327 597 452
\caption{Dois sub-problemas se fundem no TWA}
\label{fig:VTD-RWA-TWA}
\end{figure}

Assim sendo, as variáveis e restrições do TWA consistem em um modelo completo para o projeto de redes ópticas, pois considera todos os seus
subproblemas de maneira integrada. Algumas vantagens  foram incorporadas, a principal delas é que a distribuição do tráfego e seu roteamento são
feitos com variáveis agregadas, de forma similar a modelos menos abrangentes encontrados na literatura \cite{Tornatore07, ram02}. Outra
característica é que ele naturalmente admite múltiplos caminhos ópticos e múltiplas fibras ópticas entre cada par de nós da
rede, sem a necessidade de diferenciar cada ligação por uma variável de decisão diferente, como na abordagem utilizada anteriormente em
\cite{ram02}.

\begin{notation}
Os índices $m,n,s,d,i,j\in \{1,..,N\}$ representam os nós da rede, e os pares ordenados $(m,n)$, $(s,d)$ e $(i,j)$ indicam 
respectivamente ligações físicas, demandas de tráfego e ligações lógicas, com $m\neq n$, $s\neq d$ e $i\neq j$. O índice $w 
\in \{1,..,W\}$ representa os comprimentos de onda disponíveis. Por sua vez, $[m,n]$ representa uma ligação física birecional. 
\end{notation}

\begin{figure}[htb]
\centering
\includegraphics[bb=131 654 523 824,scale=.9]{figs/indices.eps}
\caption{Representação gráfica da notação associada aos nós da rede.}
\label{fig:Indices}
\end{figure}

A Figura \ref{fig:Indices} ilustra os diferentes escopos dos índices associados aos nós da rede, com relação aos enlaces físicos $(m,n)$, lógicos
$(i,j)$ e demandas de tráfego $(s,d)$. Esta notação segue a convenção comumente utilizada em trabalhos anteriores \cite{mukherjee,ram02}. É
importante dizer que, como esta modelagem suporta múltiplas fibras e caminhos ópticos entre cada par de nós, os pares $(m,n)$ e $(s,d)$ representam
conjuntos de possíveis ligações físicas e lógicas, respectivamente. Esses conjuntos não serão explicitamente controlados, sendo esse um dos motivos
da eficiência do modelo.

\begin{dados}
\label{Cons}
Uma instância para o modelo TWA é definida por:

\begin{enumerate}
\item $N$ $=$ Número de nós da rede.
\item $W$ $=$ Máximo de comprimentos de onda por fibra.
\item $K$ $=$ Multiplicidade física máxima entre os pares de nós.
\item $Cap$ $=$ Capacidade de tráfego de cada canal lógico.
\item $C_{mn}$ $=$ Custo de uma ligação física bidirecional $[m,n]$.
\item $T$ $=$ Custo por unidade de fluxo.
\item $P_{sd}$ $=$ Demanda de tráfego, com origem $s$ e destino $d$.
\item $A_s = \sum_d P_{sd}$ e $Q_{sd}=P_{sd}/A_s$.
\end{enumerate}
\end{dados}


A variável central do modelo, a partir da qual todas as demais serão definidas, chamada de \textit{componente da Topologia 
Generalizada} (ou simplesmente \textit{componente topológica}), é representada graficamente na Figura \ref{fig:B} e 
formalmente definida na Variável \ref{comp}. Ela sozinha representa as topologias lógica e física, o trajeto físico das 
ligações lógicas e o comprimento de onda utilizado.

\begin{var}
\label{comp}
Seja $B_{iw}^{mn} = k\in \{0,..,K\}$, com $i\neq n$, uma componente do conjunto das ligações lógicas com origem $i$ e comprimento de onda $w$,
que utilizam $k$ ligações físicas entre os nós $(m,n)$.
\end{var}

\begin{figure}[hbt]
\centering
\includegraphics[bb=36 739 246 805, scale=0.9]{figs/B.eps}
% B.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=36 739 246 805
\caption{Representação gráfica de uma componente topológica.}
\label{fig:B}
\end{figure}

Numa componente da topologia generalizada $B_{iw}^{mn} = k$, o índice $i$ representa o nó de origem das $k$ ligações lógicas 
que, passando por uma das ligações físicas iniciadas em $m$ e incidentes em $n$, usa o comprimento de onda $w$. Conforme a terminologia utilizada daqui por
diante, \textit{uma componente topológica $B_{iw}^{mn} = k$ é iniciada em $m$, incidente em $n$, com origem $i$,
comprimento de onda $w$ e valor $k$}.

Considerando que $B_{iw}^{mn}=k$ para algum $k \in \{0,..,K\}$, existem $k$ ligações lógicas originadas em $i$ no comprimento de onda $w$, passando
por $k$ enlaces físicos distintos entre o par de nós $(m,n)$. Neste caso, cada um desses $k$ enlaces físicos terá que ser uma fibra óptica distinta
interligando o mesmo par de nós $(m,n)$, pois haveria interferência se houvessem dois sinais ópticos originados por fluxos de tráfego diferentes se
propagando no mesmo sentido, na mesma fibra, com o mesmo comprimento de onda. Note que $K$ limita apenas a multiplicidade dos enlaces físicos, ou
seja, o número de fibras ópticas dispostas em paralelo entre dois nós $(m,n)$. Mesmo que $K=1$, o que torna $B_{iw}^{mn}$ uma variável binária, as
diversas ligações lógicas entre um par $(i,j)$ poderão usar múltiplos trajetos físicos, ou ainda, mais de um comprimento de onda em uma mesma
fibra. Se ,$\forall i$ , $k=0$ para qualquer $w$, então nenhum enlace físico entre o par de nós $(m,n)$ é utilizado, ou seja $B_{im}^{nw}=0$, $\forall
(i,w)$.

Na Figura \ref{fig:Tops}, temos um exemplo de interpretação das componentes topológicas, todas com origem no nó $i$ e com o 
mesmo comprimento de onda $w_1$. No item $d)$ desta figura, o valor $2$ da componente que liga os nós $(i,m)$ é interpretado 
como duas ligações físicas entre esses nós, representadas no item $a)$. No item $b)$, vemos uma ligação lógica dupla entre os 
nós $(i,n)$, onde uma delas passa de forma transparente pelo nó $m$, como indicado no item $c)$. Note ainda que, no item 
$d)$, há dois caminhos lógicos incidentes em $m$ mas apenas um iniciando. Isso indica que uma ligação lógica termina em $m$, 
enquanto a outra segue adiante.

% \clearpage
\begin{figure}[hbt]
\centering
\includegraphics[width=0.8\textwidth]{figs/topologias-twa.eps}
% \includegraphics[bb=39 455 511 811, scale=0.4]{figs/topologias.eps}
% topologias.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=30 375 511 801
\caption{Exemplo da interpretação das componentes topológicas.}
\label{fig:Tops}
\end{figure}
% \clearpage

A definição das componentes topológicas não deixa claro aonde terminam as ligações lógicas. Sua finalização será garantida 
implicitamente pelas restrições do modelo. Isso reflete a agregação do roteamento dos comprimentos de onda, similar a trabalhos encontradas na
literatura \cite{Jaumard04}.

A indexação atribuída às variáveis $B_{iw}^{mn}$ especificam apenas o nó $i$, que é onde se iniciam os enlaces lógicos representados. Isto
significa que estas variáveis agregam todas as ligações lógicas originadas em $i$ que utilizam o enlace físico $(m,n)$ e o comprimento de onda $w$,
independente do nó $j$ em que terminam estas ligações lógicas. Esta técnica consiste em uma abordagem bastante conhecida para a representação de
variáveis em problemas de distribuição de fluxo em redes. Em \cite{Tornatore07}, este conceito de agregação de tráfego é aplicado como meio de
simplificação do modelo, reduzindo substancialmente o número de variáveis dos problemas resultantes. No TWA, esta agregação cumpre o mesmo papel de
simplificação, cabendo às restrições do modelo garantir implicitamente a terminação correta destas ligações lógicas agregadas nas variáveis
$B_{iw}^{mn}$.

As Variáveis \ref{FisVar} e \ref{FlowVar} completam as definições necessárias para apresentarmos a forma básica do modelo TWA, expresso nas
Restrições de (\ref{DefCapFlow}) à (\ref{MinC}).

\begin{var}
\label{FisVar}
Seja $D_{mn} \in \{0,..,K\}$, com $m>n$, o número de ligações físicas bidirecionáis entre o par de nós $m$ e $n$. 
\end{var}

\begin{var}
\label{FlowVar}
Seja $q_{sw}^{ij} \in [0,1]$ a fração de fluxo originado em $s$, passando pelas ligações lógicas entre o par $(i,j)$, no comprimento de onda $w$,
com $s\neq j$. 
\end{var}

\begin{equation}
\sum_{s} q_{sw}^{ij}\cdot A_s \leqslant Cap\cdot \left(\sum_{m} B_{iw}^{mj} - \sum_{n} B_{iw}^{jn}\right) \Forall{(i,j,w)}
\label{DefCapFlow}
\end{equation} 

\begin{equation}
\sum_i B_{iw}^{mn} \leqslant \mbox{$D_{mn}$  se $m>n$, ou $D_{nm}$ se $m<n$, } \Forall{(m,n,w)}
\label{DefFis}
\end{equation} 

\begin{equation}
\sum_{jw} q_{sw}^{sj} = 1 \Forall{s} \qquad \text{and} \qquad 
\sum_{iw} q_{sw}^{id} - \sum_{jw} q_{sw}^{dj} = Q_{sd} \Forall{(s,d)}
\label{ConservFlow}
\end{equation} 

\begin{equation}
\text{\small Minimize:} \sum_{mn} C_{mn}\cdot D_{mn} + \sum_{sijw} T\cdot q_{sw}^{ij}\cdot A_s 
\label{MinC}
\end{equation}

A Restrição (\ref{DefCapFlow}) acumula múltiplas funções: garante a continuidade dos percursos lógicos e a conservação dos comprimentos de onda; controla a
capacidade de tráfego dos canais lógicos, que também pode ser um \textit{uper bound} para o congestionamento; e anula as frações de fluxo agregado nas
ligações
lógicas não utilizadas.

Se o número de componentes topológicas incidentes em $m$ for maior que o número de iniciadas, não originadas nele, essa diferença é 
o número de ligações lógicas que terminam em $m$. É deste modo que a finalização das ligações lógicas pode ser mapeada. Isso 
assegura a rastreabilidade das ligações lógicas desde sua origem, a partir das componentes topológicas agregadas.

Para resolver o sub-problema de roteamento de tráfego, são definidas as variáveis de fração de fluxo agregado (Variável \ref{FlowVar}), utilizadas
na Restrição (\ref{DefCapFlow}). Como podem haver múltiplas ligações lógicas entre um par $(i,j)$, o tráfego 
entre um par de nós deverá ser limitado pela capacidade de uma ligação lógica multiplicada pelo número de ligações lógicas em questão. Na
Restrição (\ref{DefCapFlow}), este número é representado, para as ligações lógicas entre o par $(i,j)$, como a
quantidade de componentes topológicas incidentes em $j$ ({\footnotesize$\sum_{mw}B_{iw}^{mj}$}), diminuído do número de componentes
topológicas iniciadas em $j$ ({\footnotesize$\sum_{nw}B_{iw}^{jn}$}).

Apesar da topologia física ser determinada pelas componentes da topologia generalizada, para fins de controle do custo de instalação da rede física,
é necessário novas incógnitas. Para este fim, é definida a Variável \ref{FisVar}, que registra em $D_{mn}$ a multiplicidade física bidirecional alcançada
pelas componentes topológicas. Se $D_{mn}=0$, não há ligações físicas entre o 
par $(m,n)$, mas se $D_{mn}=k$, para algum $k \in \{0,..,K\}$, existem $k$ ligações físicas bidirecionáis entre o par $(m,n)$.

Note que as componentes topológicas estão definidas em função de ligações físicas orientadas. Todavia, convencionamos que as ligações físicas estabelecidas
serão bidirecionáis. 

Pela forma como $D_{mn}$ é calculada na Restrição (\ref{FisVar}), a rigor, seu valor poderia ser maior do que é determinado pelas componentes topológicas.
Mas isso não ocorre quando o número de ligações físicas for minimizado na função objetivo.

Se $D_{mn}$ for dado de entrada do problema, a Restrição (\ref{DefFis}) limita a multiplicidade física das componentes topológicas 
$B_{im}^{nw}$. Ainda neste caso, se $D_{mn}=0$ para um certo par $[m,n]$, devem ser retiradas da modelagem as variáveis $B_{im}^{nw}$ correspondentes. Isto
deve ser considerado em todo o modelo e daqui por diante toma-se como subentendido.

A conservação de fluxo é assegurada pela Restrição (\ref{ConservFlow}), que também garante o envio e a entrega das demandas 
de tráfego. As equações da Restrição (\ref{ConservFlow}) são semelhantes, em sua forma, às encontradas na modelagem agregada 
para o VTD \cite{ram02}. Todavia, sua interpretação é sutilmente diferente, pois aqui uma determinada fração de fluxo de tráfego pode ser
subdividida e transportada simultaneamente por mais de uma ligação lógica entre o par $(i,j)$. Por exemplo, em comprimentos de onda diferentes em um mesmo
enlace físico $(m,n)$ que interliga diretamente $(i,j)$, ou por rotas físicas disjuntas entre os nós $(i,j)$, neste último caso, independente do
comprimento de onda.

Uma métrica importante no projeto da redes ópticas é a minimização dos custos de instalação e operação \cite{mukherjee}. O 
custo de instalação $C_{mn}$ é o custo associado a uma ligação física bidirecional entre o par de nós $[m,n]$. O custo de 
operação $T$ é definido como o custo por unidade de fluxo($\sum_{sijw} T\cdot q_{sw}^{ij}\cdot A_s$). Este último pode ser dividido em
duas partes, uma constante ($Tc = \sum_{sd} T\cdot P_{sd}$), formada pelas demandas de tráfego (que necessariamente deverão ser roteadas), e outra variável 
($Tv = T,\, \mbox{\small$i\neq s$}$), composta pelo tráfego adicional que é gerado, ou seja, o tráfego 
retransmitido.

Por essa razão, minimizar o custo por unidade de fluxo é equivalente a minimizar o tráfego retransmitido na rede, o que por 
sua vez, equivale a minimizar o processamento eletrônico de tráfego dos nós da rede \cite{Renato06}. Soma-se a isso o fato de 
que é necessária nesta modelagem a Restrição (\ref{DefCapFlow}), de limitação da capacidade $Cap$ dos canais lógicos. Deste 
modo, limitando o congestionamento na rede e minimizando o processamento, temos uma abordagem mais eficiente, quanto ao custo 
computacional, para o projeto da topologia virtual em comparação com a minimização do congestionamento da rede 
\cite{Renato06,ram02}. 

Se não for necessário ponderar o custo por unidade de fluxo, basta fazer $T=1$, e se não for necessário considerar o custo 
total de instalação ($CI = \sum_{mn} C_{mn}\cdot D_{mn}$), basta fazer $C_{mn}=0$ para todo $[m,n]$. Deste modo seria 
simplesmente um modelo de minimização do processamento, com limitação do congestionamento \cite{Renato06}. A função objetivo, 
que é a minimização do custo total $R = CI + Tc + Tv$, é dada explicitamente pela Restrição (\ref{MinC}).

Como o número de componentes topológicas é $N³\cdot W\cdot K$ e o número de restrições é $\Theta(N²\cdotp W)$, o número de variáveis do modelo é da ordem de
$\Theta(N³\cdotp W\cdot K)$. Quando a topologia física é um dado de entrada, sendo $H$ o número total de ligações físicas da rede, então o número de 
componentes da topologia generalizada será $N\cdotp H\cdotp W$. Supondo uma topologia física conexa, temos $H>N$ \cite{cormen02}. Entretanto, é razoável
supor
que $H<N^2$. Assim, o número de variáveis do
modelo TWA, para topologia fixada, será $O(N^3\cdotp W)$.

