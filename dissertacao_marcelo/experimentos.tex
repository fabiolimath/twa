
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Resultados
%% Copyright 2009 Marcelo de Oliveira Lima.
%% Este documento é distribuído nos termos da licença 
%% GNU General Public License v2.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Resultados}
\label{result}
\thispagestyle{empty}

Com o objetivo de demonstrar experimentalmente o funcionamento da metodologia proposta para o projeto de uma WRON em malhas hierárquicas, foram realizados
testes computacionais. Serão apresentados os detalhes dos testes realizados com uma rede de $30$ nós. As matrizes de tráfego e distâncias, dados de entrada do
problema, foram geradas de forma aleatória, com entradas uniformemente distribuídas. A matriz de tráfego possui valores entre $0$ e $100$. A
matriz de distâncias, obedecendo a desigualdade triangular \cite{cormen02}, teve o posicionamento dos pontos sorteado sobre o quadrante do plano
cartesiano com ordenadas e abscissas também entre $0$ e $100$.

O computador onde foram executados os experimentos possui a seguinte configuração: \textit{Intel Pentium\rr $4$ CPU $3.00GHz$} de $2$ núcleos, com $2048
KB$ de \textit{cache}, $1.5GB$ de RAM, executando o sistema operacional \textit{Kubuntu 9.04}. Na resolução dos modelos de programação linear e programação
linear inteira mista, citados ao longo deste capítulo, a precisão nos cálculos adotada foi de $10^{-6}$.

Para facilitar o entendimento das etapas do procedimento, elas serão apresentadas e discutidas em sequência, demonstrando a aplicação da metodologia
apresentada no capítulo anterior. A primeira mostra como os nós da rede foram divididos nas sub-redes em hierarquia a partir do método heurístico desenvolvido.
Na segunda etapa, são apresentados os resultados das estatísticas de congestionamento e tráfego retransmitido para cada sub-rede, além do cálculo da TIF de
referência. Por fim, na última etapa são mostrados os resultados da resolução do modelo TWA para todas as sub-redes.


\section{Composição das Sub-Redes}
\label{resultados:sec:hierarquia}

Para a escolha da estrutura hierárquica da rede, que consiste da separação dos nós em \textit{clusters}, foi utilizado o algoritmo genético descrito na
Seção \ref{sec:EstruturaHierarquica}. Definimos $M_i = 4$ e $M_a = 10$, os tamanhos mínimo e máximo dos \textit{clusters}, respectivamente. A partir daí
temos, $Q_i = 3$ e $Q_a = 7$, as quantidades mínima e máxima de \textit{clusters} permitidas na solução para a hierarquia.

Dentro do genético existem pesos que podem ser atribuídos às distâncias dentro e fora do \textit{backbone} e para o tráfego de acesso. Esses pesos dependem
do caso concreto em que se deseja analisar. Nestes testes esses pesos foram todos deixados como $1$. Contudo, existe um parâmetro de calibragem que deve ser
definido para deixar tráfego e distâncias com a mesma ordem de grandeza na função objetivo. Pois nela, o tráfego entra como uma soma simples e as distâncias
como uma média, além disso, ambos são calculados sobre valores da mesma ordem de grandeza, valores entre $0$ e $100$. 

Para estabelecer o parâmetro de calibragem ($C_a$), foi feito um teste piloto gerando aleatoriamente indivíduos para o genético, com redes de diversos
tamanhos, variando entre $10$ e $100$ nós. Empiricamente, estimamos que, para este caso de estudo, a esperança para o tráfego de acesso das populações do
genético ($E_t$) é
razoavelmente
interpolada pela curva:

\[ E_t(n) = \frac{2}{3}\cdot A_t\cdot(n^2 - n) \] 

Onde $A_t = 100$ e equivale à amplitude do intervalo de onde foram retiradas as entradas da matriz de demandas, neste caso $100$.
Além disso, estimamos que a esperança da distância média das populações do genético ($E_d$) é satisfatoriamente aproximada por $E_d = A_d/3$. Onde $A_d =
100$ pode ser
visto como a média geométrica entre as amplitudes dos intervalos dos eixos cartesianos aonde foram posicionados os pontos da matriz de distâncias.
Como $A_t = A_d$, o parâmetro de calibragem fica definido por:

\[ C_a = \frac{E_t}{E_d} = 2\cdot(n^2 - n) \]

Assim, na rede de $30$ em estudo, o fator de calibragem adotado foi $C_a = 1740$. Mas vale ressaltar que estas estimativas devem ser revistas para redes
com mais que $100$ nós, ou no caso de matrizes de demandas ou distâncias com características diferentes das exploradas neste trabalho.

Para os operadores genéticos da \textit{GAlib}, as probabilidades de mutação, crossover e substituição foram mantidas em seus valores \textit{default}. O
tamanho da população e o número de populações paralelas foram definidos como $100$. A estagnação máxima adotada foi $500$, ou seja, o genético é
interrompido se ficar $500$ gerações sem haver melhora.

O tempo de execução do genético foi de $30.76$ minutos. A estagnação definida foi alcançada na geração $5473$, tendo o genético visitado mais de $13.7$
milhões de soluções. A figura \ref{fig:ga.stat} mostra a evolução do processo de busca. Como pode ser visto, até por volta da geração número 2400 obteve-se uma
evolução acentuada para a solução global, a partir daí os avanços foram menos significativos. Destaca-se que a variação no valor da função objetivo do genético
foi superior a $50\%$, evidenciando a variabilidade das soluções possíveis e a relevância de um bom método para a escolha da estrutura hierárquica da rede.


\begin{figure}[!htb]
\begin{center}
 \includegraphics[angle=270,scale=.63]{./figs/ga.stat.eps}
 \caption{Evolução do processo de busca do genético.}
 \label{fig:ga.stat}
\end{center}
\end{figure}


A hierarquia obtida, que representa a melhor solução visitada pelo genético, está representada na tabela \ref{tab:hierarquia}. A hierarquia
escolhida para a rede de $30$ nós é composta de $5$ \textit{clusters}, de tamanho variando entre $4$ e $8$ nós.

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|rcccccccc|}
\hline Tamanhos:  & $ 5 $ & $ 6 $ & $ 7 $ & $ 8 $ & $ 4  $ &&& \\
\textit{Clusters}: &&&&&&&& \\
$1$ - & $\mathbf{7 }$ & $ 9  $ & $ 16 $ & $ 26 $ & $ 27 $ & && \\
$2$ - & $\mathbf{28}$ & $ 11 $ & $ 24 $ & $ 25 $ & $ 4  $ & $ 20 $ && \\
$3$ - & $\mathbf{10}$ & $ 19 $ & $ 3  $ & $ 22 $ & $ 30 $ & $ 17 $ & $ 18 $ & \\
$4$ - & $\mathbf{15}$ & $ 1  $ & $ 14 $ & $ 23 $ & $ 12 $ & $ 21 $ & $ 29 $ & $ 6  $ \\
$5$ - & $\mathbf{13}$ & $ 5  $ & $ 8  $ & $ 2  $ &&&& \\
%  & ${\,\,\,\,\,\,\drsh}$ & \multicolumn{3}{l}{\textit{Backbone}} \\
\hline
\end{tabular}
\caption{Estrutura hierárquica para a rede de $30$ nós. Em negrito, os nós do \textit{backbone}.}
\label{tab:hierarquia}
\end{center}
\end{table}

Para a solução escolhida, a soma das distâncias, antes de calcular a média, para o \textit{backbone} foi $TDist_{bk} = 276.91$, e para os \textit{clusters} foi
$TDist_{cl} = 1920.23$. Os pesos para a distância dentro e fora do \textit{backbone} foram definidos como iguais a $1$,  de forma que no cálculo da média das
distâncias o melhor indivíduo possui $M = 24.4$. O total de tráfego de acesso ao \textit{backbone} foi $T = TrafAcesso = 51579.5$, sendo que não foi
utilizado peso para o tráfego. Assim, considerando os pesos unitários e o fator de calibragem $C_a$, o \textit{fitness} do melhor indivíduo foi $94057.6$.

As figuras \ref{fig:hist.dist} e \ref{fig:hist.traf} mostram os histogramas das soluções visitadas pelo genético durante a sua execução. A figura
\ref{fig:hist.dist}, mostra a variedade da distância média entre os nós do \textit{backbone} e dos \textit{clusters}, considerando as possíveis
configurações de hierarquia para a rede. Fica evidente que o melhor indivíduo retornado pelo algoritmo, com $M = 24.4$, possui uma excelente configuração com
relação ao custo físico da rede.


\begin{figure}[!htb]
\begin{center}
\includegraphics[angle=0,scale=.5]{./figs/c4.DistMed.eps}
 % hist.dist.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \caption{Histograma da distância média relativa às soluções visitadas pelo genético.}
 \label{fig:hist.dist}
\end{center}
\end{figure}


\begin{figure}[!htb]
\begin{center}
 \includegraphics[angle=0,scale=.5]{./figs/30.I1.s1.individuos-c4.TrafR_.eps}
 % hist.dist.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \caption{Histograma do tráfego de acesso relativo às soluções visitadas pelo genético.}
 \label{fig:hist.traf}
\end{center}
\end{figure}

A figura \ref{fig:hist.traf} ilustra a variação do tráfego de acesso entre as diversas configurações possíveis para a rede em hierarquia. Como pode ser
visto, a solução global retornada pelo genético, com $T = 51579.5$, está situada entre os indivíduos que representam as melhores soluções visitadas
para o tráfego de acesso. Em comparação com os resultados observados para distância média, o tráfego de acesso possui uma variação menor com as modificações na
configuração da rede. Para a distância a diferença entre a pior e a melhor solução visitada foi superior a $145\%$, enquanto para o tráfego de acesso essa
diferença foi menor que $30\%$.

De acordo com o critério de projeto, o posicionamento relativo da distância e do tráfego entre as possíveis estruturas hierárquicas, poderia ser modificada a
partir de uma alteração na ponderação entre tráfego de acesso e as distâncias no cálculo da função objetivo.


\section{Estatísticas de Congestionamento e Tráfego Retransmitido}
\label{resultados:sec:estatisticas}

Para cada sub-rede, \textit{clusters} e \textit{backbone}, as instâncias a serem analisadas são definidas pelo grau lógico. Para uma sub-rede $k$ de
tamanho $t_k$, os graus lógicos considerados são $1$, $2$, ..., $\lfloor t_k/2\rfloor$. Para cada instância foram estimados a média e o desvio padrão, ambos
com confiança de $99\%$ e margem de erro de $1\%$. A partir destes parâmetros, o tamanho adotado para cada amostra foi calculado utilizando a formulação
apresentada no capítulo \ref{metodo}.

A partir de testes piloto, estimou-se que as estatísticas atingiam estabilidade a partir de $10^3$ amostras, para a confiança e o erro adotados. Portanto,
esse valor foi utilizado como tamanho mínimo para as amostras.

Para cada grau lógico geramos aleatoriamente uma amostra de soluções para a topologia lógica da rede. Dois modelos de programação linear foram
implementados em \textit{AMPL} \cite{ampl} para distribuir o tráfego da rede sobre cada topologia lógica, através do \textit{solver} \textit{GLPK}
(\textit{GNU
Linear Programming Kit} - gnu.org/software/glpk). Obtendo, para cada topologia lógica gerada, a distribuição de tráfego ótima para o congestionamento da
rede e também para o total do tráfego retransmitido \cite{Renato06}. Dessas amostras estimamos a média e o desvio padrão das populações para o congestionamento
e para o tráfego retransmitido, garantindo a representatividade de cada amostra.

A figura \ref{fig:converg.stat} ilustra a convergência da média e desvio padrão do congestionamento para um caso específico, \textit{cluster} 4 com grau lógico
1. Pode-se notar que neste caso, para ambas as estatísticas, $10^3$ amostras foram suficientes para atingir razoável estabilidade. Mais adiante será mostrado
que tanto para o congestionamento quanto para o tráfego retransmitido, no caso de grau lógico 1, esse tamanho de amostra foi suficiente para todas as sub-redes,
segundo o método de estimação adotado. Na figura \ref{fig:converg.stat} as linhas vermelhas ilustram o valor da média e do desvio padrão referentes ao tamanho
de amostra estimado.

\vspace{10pt}
\begin{figure}[!htb]
\begin{center}
\includegraphics[angle=270,scale=.63]{./figs/cl4.gl1.converg.estat.eps}
\caption{Convergência da média e desvio padrão em função do tamanho da amostra.}
\label{fig:converg.stat}
\end{center}
\end{figure}

No decorrer deste capítulo, quando se fizer referência às sub-redes em estudo, a codificação que está apresentada na tabela \ref{tab:cod.id} será adotada para
identificação do \textit{backbone} e dos \textit{clusters}.

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline           Sub-rede & Tamanho & Identificação (ID) \\
\hline \textit{Backbone}  & $ 5 $  & bk.t5 \\
\hline \textit{Cluster} 1 & $ 5 $  & cl1.t5 \\
\hline \textit{Cluster} 2 & $ 6 $  & cl2.t6 \\
\hline \textit{Cluster} 3 & $ 7 $  & cl3.t7 \\
\hline \textit{Cluster} 4 & $ 8 $  & cl4.t8 \\
\hline \textit{Cluster} 5 & $ 4 $  & cl5.t4 \\
\hline
\end{tabular}
\end{center}
\caption{Identificação das sub-redes.}
\label{tab:cod.id}
\end{table}


A tabela \ref{tab:cod.legenda} apresenta as legendas para as tabelas \ref{tab:result.est.cong}, \ref{tab:result.est.traf} e \ref{tab:ubs}, que serão
utilizadas na apresentação dos resultados obtidos para as estatísticas de congestionamento e tráfego retransmitido nas sub-redes. Cada linha dessas tabelas
representa uma instância do processo de estimação, sendo definida por uma sub-rede e um grau lógico. O tempo total para o processo de estimação de parâmetros
estatísticos foi de $50$ minutos.


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|ccc|}
\hline
Gl & $=$ & Grau lógico \\
ID & $=$ & Identificação da sub-rede \\
LI & $=$ & Limitante inferior \\
%HLDA & $=$ & Heurística HLDA \\
Min & $=$ & Mínimo amostral \\
Max & $=$ & Máximo amostral \\
MED & $=$ & Média amostral \\
DP & $=$ & Desvio padrão amostral \\
MEDn & $=$ & Tamanho da amostra para média \\
DPn & $=$ & Tamanho da amostra para desvio padrão \\
t(s) & $=$ & Tempo de execução em segundos \\
CongDs & $=$ & Desvios padrão para o LS de congestionamento \\
LSCong & $=$ & Limitante superior para congestionamento \\
TRetrDs & $=$ & Desvios padrão para o LS de tráfego retransmitido \\
LSTRetr & $=$ & Limitante superior para tráfego retransmitido \\
\hline
\end{tabular}
\end{center}
\caption{Legenda para as tabelas \ref{tab:result.est.cong}, \ref{tab:result.est.traf} e \ref{tab:ubs}.}
\label{tab:cod.legenda}
\end{table}


Nas tabelas \ref{tab:result.est.cong} e \ref{tab:result.est.traf}, a coluna LI representa um limitante inferior para congestionamento e tráfego
retransmitido, respectivamente. As quatro colunas que a seguem, são apresentadas em valores percentuais relativamente ao LI, mais
especificamente, quantos por cento acima do mesmo, com exceção do desvio padrão, coluna $DP$, que é uma relação percentual direta. Como limitante inferior
para o congestionamento foi utilizado o MTB (\textit{Minimun Traffic Bound}),
enquanto para o tráfego retransmitido utilizou-se o FTB (\textit{Forwarded Traffic Bound}). Ambos os métodos para cálculo de limitantes inferiores, foram
apresentados em \cite{dissertFabio}. % Nestas mesmas tabelas, para efeito de comparação, a coluna HLDA apresenta respectivamente os resultados de
%congestionamento e tráfego retransmitido obtidos utilizando a conhecida heurística HLDA \cite{ram96}. 


% \begin{table}[!ht]
% \begin{center}
% \begin{tabular}{|cc|cccccc|cc|c|}
% \hline Gl & ID & LB & HLDA & Min & Max & MED & DP & MEDn & DPn & t(s) \\
% \hline 1 & c5.t4 & 4196 & 3\% & 3\% & 4\% & 3\% & 0.3\% & 1000 & 1000 & 1 \\
% 1 & bk.t5 & 8897 & 98\% & 97\% & 110\% & 100\% & 3.1\% & 1000 & 1000 & 3 \\
% 1 & c1.t5 & 5563 & 7\% & 5\% & 8\% & 7\% & 0.8\% & 1000 & 1000 & 3 \\
% 1 & c2.t6 & 5928 & 17\% & 10\% & 18\% & 13\% & 2.6\% & 1000 & 1000 & 8 \\
% 1 & c3.t7 & 7264 & 10\% & 7\% & 14\% & 10\% & 1.4\% & 1000 & 1000 & 19 \\
% 1 & c4.t8 & 8150 & 13\% & 10\% & 17\% & 13\% & 1.4\% & 1000 & 1000 & 42 \\
% \hline 2 & c5.t4 & 2098 & 0\% & 0\% & 110\% & 35\% & 46.0\% & 13912 & 6927 & 33 \\
% 2 & bk.t5 & 4448 & 59\% & 21\% & 230\% & 71\% & 52.0\% & 17924 & 8888 & 89 \\
% 2 & c1.t5 & 2782 & 4\% & 0\% & 110\% & 16\% & 35.0\% & 8262 & 4123 & 38 \\
% 2 & c2.t6 & 2964 & 0\% & 0\% & 120\% & 13\% & 31.0\% & 6457 & 3450 & 67 \\
% 2 & c3.t7 & 3632 & 100\% & 0\% & 120\% & 9\% & 25.0\% & 3994 & 2170 & 86 \\
% 2 & c4.t8 & 4075 & 0\% & 0\% & 120\% & 8\% & 24.0\% & 3655 & 1895 & 186 \\
% \hline 3 & c2.t6 & 1976 & 16\% & 0\% & 220\% & 24\% & 46.0\% & 13759 & 6606 & 148 \\
% 3 & c3.t7 & 2421 & 200\% & 0\% & 210\% & 14\% & 35.0\% & 7830 & 3857 & 174 \\
% 3 & c4.t8 & 2717 & 0\% & 0\% & 210\% & 13\% & 34.0\% & 7905 & 3773 & 416 \\
% \hline 4 & c4.t8 & 2037 & 0\% & 0\% & 320\% & 18\% & 34.0\% & 7587 & 3712 & 404 \\
% \hline
% \end{tabular}
% \end{center}
% \caption{Resultado das estatísticas para o congestionamento.}
% \label{tab:result.est.cong}
% \end{table}

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|ccccc|cc|c|}
\hline Gl & ID & LI & Min & Max & MED & DP & MEDn & DPn & t(s) \\
\hline 1 & c5.t4 & 4196 & 3\% & 4\% & 3\% & 0.3\% & 1000 & 1000 & 1 \\
1 & bk.t5 & 8897 & 97\% & 110\% & 100\% & 3.1\% & 1000 & 1000 & 3 \\
1 & c1.t5 & 5563 & 5\% & 8\% & 7\% & 0.8\% & 1000 & 1000 & 3 \\
1 & c2.t6 & 5928 & 10\% & 18\% & 13\% & 2.6\% & 1000 & 1000 & 8 \\
1 & c3.t7 & 7264 & 7\% & 14\% & 10\% & 1.4\% & 1000 & 1000 & 19 \\
1 & c4.t8 & 8150 & 10\% & 17\% & 13\% & 1.4\% & 1000 & 1000 & 42 \\
\hline 2 & c5.t4 & 2098 & 0\% & 110\% & 35\% & 46.0\% & 13912 & 6927 & 33 \\
2 & bk.t5 & 4448 & 21\% & 230\% & 71\% & 52.0\% & 17924 & 8888 & 89 \\
2 & c1.t5 & 2782 & 0\% & 110\% & 16\% & 35.0\% & 8262 & 4123 & 38 \\
2 & c2.t6 & 2964 & 0\% & 120\% & 13\% & 31.0\% & 6457 & 3450 & 67 \\
2 & c3.t7 & 3632 & 0\% & 120\% & 9\% & 25.0\% & 3994 & 2170 & 86 \\
2 & c4.t8 & 4075 & 0\% & 120\% & 8\% & 24.0\% & 3655 & 1895 & 186 \\
\hline 3 & c2.t6 & 1976 & 0\% & 220\% & 24\% & 46.0\% & 13759 & 6606 & 148 \\
3 & c3.t7 & 2421 & 0\% & 210\% & 14\% & 35.0\% & 7830 & 3857 & 174 \\
3 & c4.t8 & 2717 & 0\% & 210\% & 13\% & 34.0\% & 7905 & 3773 & 416 \\
\hline 4 & c4.t8 & 2037 & 0\% & 320\% & 18\% & 34.0\% & 7587 & 3712 & 404 \\
\hline
\end{tabular}
\end{center}
\caption{Resultado das estatísticas para o congestionamento.}
\label{tab:result.est.cong}
\end{table}



% \begin{table}[!ht]
% \begin{center}
% \begin{tabular}{|cc|cccccc|cc|c|}
% \hline Gl & ID & LB & HLDA & Min & Max & MED & DP & MEDn & DPn & t(s) \\
% \hline 1 & c5.t4 & 4500 & 92\% & 92\% & 94\% & 93\% & 1.1\% & 1000 & 1000 & 1 \\
% 1 & bk.t5 & 44000 & 16\% & 15\% & 22\% & 18\% & 2.3\% & 1000 & 1000 & 3 \\
% 1 & c1.t5 & 8500 & 100\% & 95\% & 110\% & 100\% & 4.2\% & 1000 & 1000 & 3 \\
% 1 & c2.t6 & 13000 & 110\% & 88\% & 110\% & 99\% & 5.6\% & 1000 & 1000 & 8 \\
% 1 & c3.t7 & 19000 & 95\% & 82\% & 100\% & 94\% & 5.7\% & 1000 & 1000 & 19 \\
% 1 & c4.t8 & 27000 & 100\% & 90\% & 110\% & 100\% & 4.1\% & 1000 & 1000 & 42 \\
% \hline 2 & c5.t4 & 1400 & 100\% & 89\% & 290\% & 140\% & 66.0\% & 28994 & 14406 & 69 \\
% 2 & bk.t5 & 14000 & 58\% & 17\% & 100\% & 37\% & 21.0\% & 2964 & 1495 & 15 \\
% 2 & c1.t5 & 2700 & 170\% & 93\% & 330\% & 140\% & 57.0\% & 21766 & 11025 & 100 \\
% 2 & c2.t6 & 3900 & 120\% & 81\% & 320\% & 150\% & 45.0\% & 13389 & 6648 & 140 \\
% 2 & c3.t7 & 5300 & 270\% & 82\% & 350\% & 160\% & 40.0\% & 10736 & 5335 & 230 \\
% 2 & c4.t8 & 7700 & 150\% & 91\% & 370\% & 150\% & 35.0\% & 7946 & 3855 & 400 \\
% \hline 3 & c2.t6 & 2400 & 150\% & 86\% & 460\% & 150\% & 56.0\% & 20890 & 10186 & 230 \\
% 3 & c3.t7 & 3700 & 360\% & 84\% & 410\% & 130\% & 40.0\% & 10798 & 5450 & 240 \\
% 3 & c4.t8 & 5000 & 98\% & 91\% & 400\% & 140\% & 36.0\% & 8729 & 4238 & 460 \\
% \hline 4 & c4.t8 & 3500 & 110\% & 97\% & 530\% & 140\% & 38.0\% & 9595 & 4647 & 510 \\
% \hline
% \end{tabular}
% \end{center}
% \caption{Resultado das estatísticas para o tráfego retransmitido.}
% \label{tab:result.est.traf}
% \end{table}

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|ccccc|cc|c|}
\hline Gl & ID & LI & Min & Max & MED & DP & MEDn & DPn & t(s) \\
\hline 1 & c5.t4 & 4500 & 92\% & 94\% & 93\% & 1.1\% & 1000 & 1000 & 1 \\
1 & bk.t5 & 44000 & 15\% & 22\% & 18\% & 2.3\% & 1000 & 1000 & 3 \\
1 & c1.t5 & 8500 & 95\% & 110\% & 100\% & 4.2\% & 1000 & 1000 & 3 \\
1 & c2.t6 & 13000 & 88\% & 110\% & 99\% & 5.6\% & 1000 & 1000 & 8 \\
1 & c3.t7 & 19000 & 82\% & 100\% & 94\% & 5.7\% & 1000 & 1000 & 19 \\
1 & c4.t8 & 27000 & 90\% & 110\% & 100\% & 4.1\% & 1000 & 1000 & 42 \\
\hline 2 & c5.t4 & 1400 & 89\% & 290\% & 140\% & 66.0\% & 28994 & 14406 & 69 \\
2 & bk.t5 & 14000 & 17\% & 100\% & 37\% & 21.0\% & 2964 & 1495 & 15 \\
2 & c1.t5 & 2700 & 93\% & 330\% & 140\% & 57.0\% & 21766 & 11025 & 100 \\
2 & c2.t6 & 3900 & 81\% & 320\% & 150\% & 45.0\% & 13389 & 6648 & 140 \\
2 & c3.t7 & 5300 & 82\% & 350\% & 160\% & 40.0\% & 10736 & 5335 & 230 \\
2 & c4.t8 & 7700 & 91\% & 370\% & 150\% & 35.0\% & 7946 & 3855 & 400 \\
\hline 3 & c2.t6 & 2400 & 86\% & 460\% & 150\% & 56.0\% & 20890 & 10186 & 230 \\
3 & c3.t7 & 3700 & 84\% & 410\% & 130\% & 40.0\% & 10798 & 5450 & 240 \\
3 & c4.t8 & 5000 & 91\% & 400\% & 140\% & 36.0\% & 8729 & 4238 & 460 \\
\hline 4 & c4.t8 & 3500 & 97\% & 530\% & 140\% & 38.0\% & 9595 & 4647 & 510 \\
\hline
\end{tabular}
\end{center}
\caption{Resultado das estatísticas para o tráfego retransmitido.}
\label{tab:result.est.traf}
\end{table}


%Uma evidência da qualidade das amostras de topologia visitadas para estimação das estatísticas, é a comparação dos mínimos amostrais com a heurística HLDA,
%em todos os casos a melhor topologia sorteada obteve resultado melhor ou igual ao HLDA.
Um ponto que pode ser destacado é que para o congestionamento, o LI calculado possui excelente qualidade visto que é muito próximo dos
mínimos amostrais. Da mesma maneira, essa é uma evidência de que a amostra coletada possui boas soluções. Quanto ao tráfego retransmitido, a não ser para o
\textit{backbone}, não se pode afirmar que o LI calculado possui qualidade excelente.


\begin{figure}[!htb]
\includegraphics[angle=270,scale=.63]{./figs/cong.lb.eps}
% cong.lb.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
\caption{Limitantes inferiores para o congestionamento.}
\label{fig:cong.lb} 
\end{figure}


\begin{figure}[!htb]
\includegraphics[angle=270,scale=.63]{./figs/traf.lb.eps}
% traf.lb.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
\caption{Limitantes inferiores para o tráfego retransmitido.}
\label{fig:traf.lb} 
\end{figure}


Nas tabelas \ref{tab:result.est.cong} e \ref{tab:result.est.traf}, observa-se casos onde a grande variabilidade das topologias visitadas leva a desvios padrão
superiores a $50\%$. Para o congestionamento, chamam a atenção as instâncias que possuem desvio padrão superior a média. Para o caso de grau lógico 1, rede em
anel, destaca-se a pequena diferença entre máximo e mínimo. A pouca variabilidade desse tipo de topologia é reforçada pelo pequeno desvio padrão observado
nestas instâncias.

As figuras \ref{fig:cong.lb} e \ref{fig:traf.lb} apresentam graficamente as variações dos limitantes inferiores de congestionamento e tráfego retransmitido,
respectivamente. Nelas é possível observar o comportamento dos mesmos em função do grau lógico em cada sub-rede.



Conforme mencionado no capítulo anterior, o resultado principal dessa etapa de estimação de estatísticas para congestionamento e tráfego retransmitido é a
definição de limitantes superiores para os mesmos. A partir das estatísticas obtidas pode-se definir uma regra para esses limitantes superiores que
represente valores de boa qualidade para essas métricas. Os valores definidos em função das estatísticas serão repassados para o modelo TWA na etapa final do
processo de resolução.

Conforme definido nas equações \ref{DefUBCong} e \ref{DefUBTRetr}, os limitantes superiores foram calculados como a média menos uma quantidade de desvios
padrão, tanto para o congestionamento ($CongDs$) quanto para o tráfego retransmitido ($TRetrDs$). Para as duas métricas essa quantidade de desvios padrão é
múltipla de $0.5$ e foram definidas como a maior possível, desde que o limitante superior resultante não ultrapasse o respectivo mínimo amostral. A
tabela
\ref{tab:ubs} mostra os valores resultantes desta regra.

\begin{equation}
LSCong = MED - CongDs\cdot DP
\label{DefUBCong}
\end{equation} 

\begin{equation}
LSTRetr = MED - TRetrDs\cdot DP
\label{DefUBTRetr}
\end{equation} 

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|cc|cc|}
\hline ID & GL & CongDs & LSCong & TRetrDs & LSTRetr \\
\hline bk.t5 & 1 & 1.0 & 17636 & 1.0 & 51437 \\
bk.t5 & 2 & 0.5 & 6434 & 0.5 & 18088 \\
\hline c1.t5 & 1 & 1.0 & 5883 & 1.0 & 16835 \\
c1.t5 & 2 & 0.0 & 3224 & 0.5 & 5774 \\
\hline c2.t6 & 1 & 1.0 & 6558 & 1.5 & 24601 \\
c2.t6 & 2 & 0.0 & 3359 & 1.5 & 7092 \\
c2.t6 & 3 & 0.5 & 2002 & 1.0 & 4569 \\
\hline c3.t7 & 1 & 1.5 & 7836 & 1.5 & 35938 \\
c3.t7 & 2 & 0.0 & 3950 & 2.0 & 9625 \\
c3.t7 & 3 & 0.0 & 2768 & 1.0 & 6872 \\
\hline c4.t8 & 1 & 2.0 & 8984 & 2.5 & 51115 \\
c4.t8 & 2 & 0.0 & 4379 & 1.5 & 15137 \\
c4.t8 & 3 & 0.0 & 3071 & 1.0 & 9981 \\
c4.t8 & 4 & 0.5 & 2056 & 1.0 & 7194 \\
\hline c5.t4 & 1 & 1.5 & 4306 & 1.0 & 8555 \\
c5.t4 & 2 & 0.5 & 2353 & 0.5 & 2991 \\
\hline
\end{tabular}
\end{center}
\caption{Limitantes superiores calculados para congestionamento e tráfego retransmitido.}
\label{tab:ubs}
\end{table}

Para os casos em que $CongDs = 0$, significa que o limitante superior para o congestionamento foi definido como a própria média amostral ($MED$).


Além dos parâmetros de controle $LSCong$ e $LSTRetr$, que obtemos a partir das estatísticas, para garantir que a solução obtida para a topologia física com
o
modelo TWA não seja muito dependente da instância, como foi comentado na seção \ref{sec:subredes:custo_fisico}, calculamos a $TIF$ para a rede NFSNET
\cite{ram02}. O valor calculado foi $TIF_{NFSNET} = 1.82$, e este será o valor de referência sobre o qual ainda exigimos uma folga para baixo ($TIFgap$), para
dessa forma definir o limitante superior para o custo físico ($LSCFis$) de cada sub-rede. Conforme será detalhado na próxima seção, o $TIFgap$ utilizado
variou entre $70\%$ e $20\%$. 

\begin{equation}
LSCFis = \dfrac{TIF_{NFSNET}\cdot (1-TIFgap)\cdot \sum_{mn} C_{mn}}{N-1}
\label{DefUBCFis}
\end{equation} 

A equação \ref{DefUBCFis} define a fórmula de cálculo para $LSCFis$. Como se pode notar, partindo de um valor de referência ($TIF_{NFSNET}$), um fator de
qualidade ($TIFgap$) e a somatória dos custos de instalação de uma sub-rede, neste trabalho representado pela matriz de distâncias, é possível calcular o
limitante superior para cada instância do problema.


\section{Resolução das Sub-redes com TWA}
\label{resultados:sec:twa}

Como iremos procurar soluções resolvendo um modelo de programação linear inteira, nestes testes, não estamos utilizando a capacidade do TWA de
produzir soluções com múltiplas ligações físicas, com o intuito de reduzir o número de variáveis binárias no modelo. Entretanto ainda são admitidas
soluções com múltiplas ligações lógicas, pois no TWA isso não interfere no número de variáveis. 

Todas as estatísticas de congestionamento e tráfego retransmitido foram calculadas utilizando como instâncias as combinações de sub-rede e grau lógico.
Destaca-se que as restrições do modelo TWA utilizadas para controle de grau lógico, na prática não limitam o grau lógico de cada nó da forma tradicional
\cite{ram96}, efetivamente o que é limitado é o total de transceptores utilizados na topologia virtual, conforme a restrição \ref{TT}. Dessa forma, as
instâncias do TWA também são definidas pelo grau lógico, mas como referência, pois o que será limitado é o total de transceptores, que são no máximo o número
de nós da sub-rede vezes o grau lógico da instância.

Os valores de limitantes superiores utilizados para tráfego retransmitido e congestionamento são os apresentados na tabela \ref{tab:ubs}. Com relação à
limitação do custo físico, iniciamos com um $TIFgap$ de $40\%$ pois em testes piloto este se mostrou promissor. Reduzimos o $TIFgap$ nas situações em que não
foi possível encontrar solução viável. Além disso, aumentamos o $TIFgap$ enquanto ainda fossem encontradas soluções, visando obter o melhor custo físico
possível que ainda atendesse às demais exigências. Em ambos os casos, o valor do $TIFgap$ é alterado em $10\%$, para cima ou para baixo.

Para cada $TIFgap$, a estratégia adotada foi, partindo do menor grau lógico ($Gl=1$), fixar nos valores mínimos o número de comprimentos de onda, e
executar o modelo básico do TWA com as adições indicadas na Seção \ref{sec:subredes:restricoes}. Um \textit{solver} para problemas MILP é instanciado com
essa configuração. Enquanto o \textit{solver} retornar que o problema é insolúvel \cite{mukherjee}, o número de comprimentos de onda ($W$) será incrementado,
até um limite definido. Atingido esse limite, o $TIFgap$ é reduzido de $10\%$ e $W$ retornado para seu valor inicial.

Se o \textit{solver} não encontrar uma solução viável dentro de $10^4$ segundos, então ele é abortado e é aplicado o mesmo procedimento de quando a
solução é insolúvel. Isso é feito com o objetivo de folgar as restrições de modo que o \textit{solver} possa encontrar uma solução viável mais
rapidamente, sacrificando um pouco a qualidade das restrições. Essas situações fazem parte do método e o seu tempo é contabilizado conjuntamente com o
das instâncias insolúveis. Um método de uso similar para o modelo TWA foi apresentado anteriormente em \cite{SBPO2009}.

Se uma solução viável é encontrada, o \textit{solver} é interrompido, a solução é registrada e o grau lógico é incrementado, dando continuidade ao processo.
Vale relembrar que o \textit{solver} é interrompido pois todos os parâmetros de interesse já estão limitados satisfatoriamente, portanto qualquer solução viável
já atende o que foi exigido. Não sendo necessário perseguir otimalidade neste ponto.

Como, nesta modelagem, $W$ está diretamente relacionado a quantidade de variáveis, é mais conveniente começar com $W=1$. Disso decorre a escolha 
de também começarmos com $Gl=1$. A maior prioridade para a incrementação é dada ao $Gl$, pois variando este temos instâncias diferentes. 
A menor precedência ficou para $W$, pois quanto menor ele for menores precisarão ser os custos de instalação da rede.

O pseudo código \ref{pseudocod:TWA} ilustra o processo iterativo de resolução do modelo TWA para cada sub-rede.


\begin{pseudocod}[Uso do TWA] Para cada sub-rede $k$ de tamanho $t_k$, deve-se executar: \\
$\hspace{10pt}$ \textbf{Dados de Entrada da sub-rede:}\\
$\hspace{10pt}$ $\text{Matrizes de tráfego e distância}$; $LSCong$; $LSTRetr$; $TIF_{NFSNET}$ \\
$\hspace{10pt}$ \underline{1} $\hspace{30pt}$ \textbf{FOR} $Gl=1$ \textbf{TO} $Gl=\lfloor t_k/2\rfloor$ \textbf{DO} \\
$\hspace{10pt}$ \underline{2} $\hspace{60pt}$ $W=1$; $TIFgap = 40\%$;\\
$\hspace{10pt}$ \underline{3} $\hspace{60pt}$ \textbf{DO UNTIL} $W=5$ \textbf{OR} $\text{Solução Viável}$ \\
$\hspace{10pt}$ \underline{4} $\hspace{90pt}$ $SOLVER_{\left[TWA\right]}$; \\
$\hspace{10pt}$ \underline{5} $\hspace{90pt}$ $W = W+1$; \\
$\hspace{10pt}$ \underline{6} $\hspace{60pt}$ \textbf{END DO} \\
$\hspace{10pt}$ \underline{7} $\hspace{60pt}$ \textbf{IF NOT} $\text{Solução Viável}$ \textbf{AND} $10\% \leqslant TIFgap \leqslant 40\%$ \\
$\hspace{10pt}$ \underline{8} $\hspace{90pt}$ $TIFgap = TIFgap - 10\%$; \\
$\hspace{10pt}$ \underline{9} $\hspace{90pt}$ $W=1$; \\
$\hspace{10pt}$ \underline{10} $\hspace{83pt}$ \textbf{GO TO} \underline{step (3)} \\
$\hspace{10pt}$ \underline{11} $\hspace{53pt}$ \textbf{END IF} \\
$\hspace{10pt}$ \underline{12} $\hspace{53pt}$ \textbf{IF} $\text{Solução Viável}$ \textbf{AND} $TIFgap \geqslant 40\%$ \\
$\hspace{10pt}$ \underline{13} $\hspace{83pt}$ $TIFgap = TIFgap + 10\%$; \\
$\hspace{10pt}$ \underline{14} $\hspace{83pt}$ $W=1$; \\
$\hspace{10pt}$ \underline{15} $\hspace{83pt}$ \textbf{GO TO} \underline{step (3)} \\
$\hspace{10pt}$ \underline{16} $\hspace{53pt}$ \textbf{END IF} \\
$\hspace{10pt}$ \underline{17} $\hspace{23pt}$ \textbf{END FOR} 
\label{pseudocod:TWA}
\end{pseudocod}


Utilizamos o \textit{solver} SCIP (\textit{Solving Constraint Integer Programs} - scip.zib.de) para encontrar as soluções viáveis para as diversa instâncias
do TWA. Além de calcular congestionamento e tráfego retransmitido para as estatísticas, como foi descrito na seção \ref{sec:subredes:estatisticas}, o GLPK
também foi usado para interpretar o modelo AMPL, gerando a entrada de dados para o SCIP. Vale observar que o SCIP e o GLPK são \textit{softwares} livres, de
código fonte aberto e de distribuição gratuita.

A tabela \ref{tab:cod.legenda2} apresenta as legendas para a tabela \ref{tab:result.twa}, que será utilizada na apresentação dos resultados obtidos para o
projeto completo das sub-redes utilizando o modelo TWA. Nesta tabela, cada linha representa uma instância, composta por uma sub-rede e um grau lógico.


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|ccc|}
\hline
ID & $=$ & Identificação da sub-rede \\
Gl & $=$ & Grau lógico \\
W & $=$ & Número de comprimentos de onda \\
TIFgap & $=$ & Folga em relação à TIF da NFSNET \\
TTranc & $=$ & Total de transceptores \\
CFis & $=$ & Custo físico \\
TIF & $=$ & TIF resultante \\
Cong & $=$ & Congestionamento \\
TRetr & $=$ & Tráfego retransmitido \\
Ti(s) & $=$ & Tempo de execução da instância \\
Tt(s) & $=$ & Tempo de execução total \\
\hline
\end{tabular}
\end{center}
\caption{Legenda para a tabela \ref{tab:result.twa}.}
\label{tab:cod.legenda2}
\end{table}


Conforme descrito na seção anterior, a limitação de custo físico foi definida com base na TIF da rede real NFSNET, como definido na equação \ref{DefUBCFis}. Os
valores de $LSCFis$, foram calculados a partir desse valor de referência para a TIF, menos um percentual $TIFgap$, que representa uma tentativa de
forçar uma boa qualidade no resultado do projeto da rede física. Na coluna TIF da tabela \ref{tab:result.twa}, está apresentado o valor da TIF calculado para a
solução obtida para a topologia física. O número de comprimentos de onda ($W$) necessários para atender às demandas de tráfego, que é um fator relevante do
ponto de vista de complexidade e custo de uma rede, variou entre $1$ e $4$.


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|cc|ccccc|cc|}
\hline ID & Gl & W & TIFgap & TTranc & CFis & TIF & TRetr & Cong & Ti(s)  & Tt(s) \\
\hline bk.t5 & 1 & 1 & 70\% & 5 & 51 & 0.54 & 51084 & 17526 & 0.1 & 5 \\
bk.t5 & 2 & 2 & 70\% & 10 & 51 & 0.54 & 17667 & 6434 & 0.4 & 15 \\
\hline c1.t5 & 1 & 1 & 20\% & 5 & 79 & 1.42 & 16635 & 5882 & 1 & 81842 \\
c1.t5 & 2 & 2 & 20\% & 9 & 79 & 1.42 & 5755 & 3003 & 11 & 95 \\
\hline c2.t6 & 1 & 2 & 40\% & 6 & 68 & 1.07 & 24484 & 6523 & 98 & 831 \\
c2.t6 & 2 & 3 & 40\% & 12 & 68 & 1.07 & 5556 & 2730 & 9 & 225 \\
c2.t6 & 3 & 4 & 40\% & 16 & 68 & 1.07 & 4267 & 2002 & 74 & 509 \\
\hline c3.t7 & 1 & 1 & 30\% & 7 & 85 & 1.24 & 35709 & 7821 & 37 & 221110 \\
c3.t7 & 2 & 3 & 30\% & 13 & 87 & 1.26 & 7755 & 2961 & 215 & 24271 \\
c3.t7 & 3 & 3 & 30\% & 18 & 84 & 1.23 & 6824 & 2768 & 2859 & 17586 \\
\hline c4.t8 & 1 & 1 & 40\% & 8 & 80 & 1.09 & 50807 & 8982 & 698 & 41074 \\
c4.t8 & 2 & 2 & 40\% & 16 & 79 & 1.06 & 7976 & 3582 & 17 & 21350 \\
c4.t8 & 3 & 2 & 40\% & 16 & 79 & 1.07 & 7069 & 3050 & 58 & 3999 \\
c4.t8 & 4 & 3 & 40\% & 22 & 77 & 1.04 & 6590 & 2056 & 587 & 23027 \\
\hline c5.t4 & 1 & 1 & 20\% & 4 & 65 & 1.36 & 8546 & 4304 & 0.4 & 9 \\
c5.t4 & 2 & 2 & 20\% & 7 & 65 & 1.36 & 233 & 1515 & 0.1 & 6 \\
\hline
\end{tabular}
\end{center}
\caption{Resumo dos resultados com TWA.}
\label{tab:result.twa}
\end{table}


Os resultados obtidos para TIF das sub-redes mostra que o processo de busca iniciado com o genético, onde os nós foram agrupados por proximidade, gerou uma
solução final de boa qualidade, visto que foi possível utilizar fatores de qualidade ($TIFgap$) em todos os casos. Destaca-se o resultado da TIF para o
\textit{backbone} ($0.54$), sendo muito inferior à TIF de referência ($1.82$). O pior resultado foi obtido para $c1.t5$, onde a TIF obtida foi de $1.42$.

Para duas instâncias, $c1.t5$ e $c3.t7$, ambas com grau lógico $1$, mesmo com um $TIFgap$ reduzido a $0.0\%$ não foi possível encontrar solução viável.
Então
relaxamos os limitantes superiores para congestionamento e tráfego retransmitido, reduzindo em $0.5$ o número de desvios padrão abaixo da média para ambos,
nas
duas instâncias. Os valores mostrados na tabela \ref{tab:ubs} foram apresentados
com essas exceções.

Os experimentos mostraram que o custo físico não possui relação evidente com o grau lógico. Isso fica claro pois para cada sub-rede o valor de $TIFgap$ para o
qual foi possível obter soluções viáveis foi o mesmo, independente do grau lógico. Além disso, pode-se notar por exemplo que entre o \textit{backbone} e o
\textit{cluster}
$1$, ambos com $5$ nós, o $TIFgap$ teve uma variação de $50\%$. Essas características cumprem o objetivo proposto na definição da $TIF$ de ser um parâmetro
independente do grau lógico e do número de nós
da rede.


\begin{figure}[!htb]
\includegraphics[angle=270,scale=.63]{./figs/twa.ftnet.eps}
\label{fig:traf.acces}
\caption{Resultados para tráfego retransmitido e de acesso ao \textit{backbone}.}
\end{figure}


A figura $6.7$ mostra o comportamento do tráfego retransmitido em cada sub-rede de acordo com o grau lógico. Além disso, para evidenciar a
solução global da rede em hierarquia, ela destaca o tráfego de acesso ao \textit{backbone} que foi calculado na etapa inicial, quando o genético fez a escolha
das sub-redes.

Na versão do modelo TWA aqui utilizada, o grau lógico foi representado como uma restrição no número total de transceptores na rede. Como se trata de uma
limitação, existem casos onde não são utilizados todos os transceptores permitidos pelo grau lógico definido. Na coluna $TTranc$ da tabela
\ref{tab:result.twa}, nota-se que para grau lógico $1$ o número de transceptores ficou igual ao número de nós, configurando anéis, que é a única topologia
conexa de grau lógico $1$ possível. Fora estes casos, somente para o grau lógico $2$, em algumas sub-redes, foi necessário utilizar todos os transceptores
permitidos.

% As três colunas que seguem, $CFis$, $TRetr$ e $Cong$, trazem os resultados obtidos para custo físico, tráfego retransmitido e congestionamento,
% respectivamente.

As últimas colunas da tabela \ref{tab:result.twa}, mostram os tempos de execução do processo de busca. Como o modelo TWA foi utilizado de forma iterativa,
conforme descrito no pseudo código \ref{pseudocod:TWA}, variando os parâmetros de limitação ou qualidade para as restrições, são apresentados dois tempos para
cada instância. A coluna $Tt(s)$ mostra o tempo total, que contempla todas as tentativas de utilização do \textit{solver}, devido às alterações em $W$ e
$TIFgap$. Além disso, para os casos de exceção citados acima, onde foi necessário folgar os limitantes superiores de tráfego e congestionamento, também foi
contabilizado o tempo das tentativas com os valores originais de desvios padrão abaixo da média ($CongDs$ e $TRetrDs$).  Este fato explica os elevados
valores de $Tt(s)$ para as instâncias $c1.t5$ e $c3.t7$, com grau lógico $1$.

A coluna $Ti(s)$ mostra o tempo 
relativo apenas à última tentativa de resolução, ou seja, aquela que retornou uma solução viável. Como pode-se notar, na maioria dos casos esse último tempo
foi de apenas alguns segundos. O tempo total para resolução de todas as instâncias, somatório da coluna $Tt(s)$, foi de $121$ horas. Cabe ressaltar que se a
tolerância de tempo para o \textit{solver} retornar uma solução viável fosse reduzida para $10^3$ segundos, ao invés de $10^4$, o tempo total para resolução
de todas as instâncias seria reduzido consideravelmente, sem se observar uma perda de qualidade relevante. Nesta situação, apenas uma instância teria seu
resultado piorado em função da menor tolerância de tempo, seria $c3.t7$ com grau lógico $3$, sendo que este foi o único caso em que o tempo $Ti(s)$ para
encontrar uma solução viável superou $10^3$ segundos.



