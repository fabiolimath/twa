
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Resultados
%% Copyright 2009 Marcelo de Oliveira Lima.
%% Este documento é distribuído nos termos da licença 
%% GNU General Public License v2.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Resultados}
\label{resultados}

Com o objetivo de demonstrar experimentalmente o funcionamento da metodologia proposta para o projeto de uma WRON em malhas hierárquicas, foram realizados
testes computacionais. Serão apresentados os detalhes dos testes realizados com uma rede de $30$ nós. As matrizes de tráfego e distâncias, dados de entrada do
problema, foram geradas de forma aleatória, com entradas uniformemente distribuídas. A matriz de tráfego possui valores entre $0$ e $100$. A
matriz de distâncias, obedecendo a \textit{desigualdade triangular} \cite{cormen02}, teve o posicionamento dos pontos sorteado sobre o quadrante do plano
cartesiano com ordenadas e abscissas também entre $0$ e $100$.

O computador onde foram executados os experimentos possui a seguinte configuração: \textit{Intel Pentium\rr $4$ CPU $3.00GHz$} de $2$ núcleos, com $2048
KB$ de \textit{cache}, $1.5GB$ de RAM, executando o sistema operacional \textit{Kubuntu 9.04}. Na resolução dos modelos de programação linear e programação
linear inteira mista, citados ao longo deste capítulo, a precisão nos cálculos adotada foi de $10^{-6}$.

Para facilitar o entendimento das etapas do procedimento, elas serão apresentadas e discutidas em sequência, demonstrando a aplicação da metodologia
apresentada no capítulo anterior. A primeira mostra como os nós da rede foram
divididos nas sub-redes em hierarquia a partir do método heurístico desenvolvido. Na segunda etapa, são apresentados os resultados das estatísticas de
congestionamento e tráfego retransmitido para cada sub-rede. Por fim, na última etapa são mostrados os resultados da resolução do modelo TWA para todas as
sub-redes.


\section{Composição das Sub-Redes}
\label{resultados:sec:hierarquia}

Na separação dos nós em \textit{clusters}, feita através do algoritmo genético implementado, definimos $M_i = 3$, o número mínimo de \textit{clusters}. E
como foi convencionado na seção \ref{sec:EstruturaHierarquica}, $M_i$ também equivale ao tamanho mínimo admitido para formar um \textit{cluster}, além de
definir o tamanho máximo e número máximo de \textit{clusters} na hierarquia $M_a = \lfloor n/M_i\rfloor = 30/3 = 10$.

Dentro do genético existem pesos que podem ser atribuídos às distâncias dentro e fora do \textit{backbone} e para o tráfego de acesso. Esses pesos dependem
do caso concreto em que se deseja analisar. Nestes testes esses pesos foram todos deixados como $1$. Contudo, existe um parâmetro de calibragem que deve ser
definido para deixar tráfego e distâncias com a mesma ordem de grandeza na função objetivo. Pois nela, o tráfego entra como uma soma simples e as distâncias
como uma média, além disso, ambos são calculados sobre valores da mesma ordem de grandeza, valores entre $0$ e $100$. 

Para estabelecer o parâmetro de calibragem ($C_a$), foi feito um teste piloto gerando aleatoriamente indivíduos para o genético, com redes de diversos
tamanhos, variando entre $10$ e $100$ nós. Empiricamente, estimamos que a esperança para o tráfego de acesso médio das populações ($E_t$) é razoavelmente
interpolada pela curva:

\[ E_t(n) = \frac{2}{3}\cdot A_t\cdot(n^2 - n) \] 

Onde $A_t = 100$ e equivale à amplitude do intervalo de onde foram retiradas as entradas da matriz de demandas, neste caso $100$.
Além disso, estimamos que a esperança da distância média das populações ($E_d$) é satisfatoriamente aproximada por $E_d = A_d/3$. Onde $A_d = 100$ pode ser
visto como a média geométrica entre as amplitudes dos intervalos dos eixos cartesianos aonde foram posicionados os pontos da matriz de distâncias.
Como $A_t = A_d$, o parâmetro de calibragem fica definido por:

\[ C_a = 2\cdot(n^2 - n) \]

Assim, na rede de $30$ em estudo, o fator de calibragem adotado foi $C_a = 1740$. Mas vale ressaltar que estas estimativas devem ser revistas para redes
com mais que $100$ nós, ou no caso de matrizes de demandas ou distâncias diferentes. 

Para os operadores genéticos da \textit{GAlib}, as probabilidades de mutação, crossover e substituição foram mantidas em seus valores \textit{default}. O
tamanho da população e o número de populações paralelas foram definidos como $100$. A estagnação máxima adotada foi $500$, ou seja, o genético é
interrompido se ficar $500$ gerações sem haver melhora.

O tempo de execução do genético foi de $30.76$ minutos. A estagnação definida foi alcançada na geração $5473$, tendo o genético visitado mais de $13.7$
milhões de soluções. A figura \ref{fig:ga.stat} mostra a evolução do processo de busca. Como pode ser visto, até por volta da geração número 2400 obteve-se uma
evolução acentuada para a solução global, a partir daí os avanços foram menos significativos. Destaca-se que a variação no valor da função objetivo do genético
foi superior a $50\%$, evidenciando a variabilidade das soluções possíveis e a relevância de um bom método para a escolha da estrutura hierárquica da rede.


\begin{figure}[!htb]
\begin{center}
 \includegraphics[angle=270,scale=.63]{./figs/ga.stat.eps}
 \caption{Evolução do processo de busca do genético.}
 \label{fig:ga.stat}
\end{center}
\end{figure}


A hierarquia obtida, que representa a melhor solução visitada pelo genético, está representada na tabela \ref{tab:hierarquia}. A hierarquia
escolhida para a rede de $30$ nós é composta de $5$ \textit{clusters}, de tamanho variando entre $4$ e $8$ nós.

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|rcccccccc|}
\hline Tamanhos:  & $ 5 $ & $ 6 $ & $ 7 $ & $ 8 $ & $ 4  $ &&& \\
\textit{Clusters}: &&&&&&&& \\
$1$ - & $\mathbf{7 }$ & $ 9  $ & $ 16 $ & $ 26 $ & $ 27 $ & && \\
$2$ - & $\mathbf{28}$ & $ 11 $ & $ 24 $ & $ 25 $ & $ 4  $ & $ 20 $ && \\
$3$ - & $\mathbf{10}$ & $ 19 $ & $ 3  $ & $ 22 $ & $ 30 $ & $ 17 $ & $ 18 $ & \\
$4$ - & $\mathbf{15}$ & $ 1  $ & $ 14 $ & $ 23 $ & $ 12 $ & $ 21 $ & $ 29 $ & $ 6  $ \\
$5$ - & $\mathbf{13}$ & $ 5  $ & $ 8  $ & $ 2  $ &&&& \\
%  & ${\,\,\,\,\,\,\drsh}$ & \multicolumn{3}{l}{\textit{Backbone}} \\
\hline
\end{tabular}
\caption{Estrutura hierárquica para a rede de $30$ nós. Em negrito, os nós do \textit{backbone}.}
\label{tab:hierarquia}
\end{center}
\end{table}

Para a solução escolhida, a soma das distâncias, antes de calcular a média, para o \textit{backbone} foi $TDist_{bk} = 276.91$, e para os \textit{clusters} foi
$TDist_{cl} = 1920.23$. Os pesos para a distância dentro e fora do \textit{backbone} foram definidos como iguais a $1$,  de forma que no cálculo da média das
distâncias o melhor indivíduo possui $M = 24.4$. O total de tráfego de acesso ao \textit{backbone} foi $T = TrafAcesso = 51579.5$, sendo que não foi
utilizado peso para o tráfego. Assim, considerando os pesos unitários e o fator de calibragem $C_a$, o \textit{fitness} do melhor indivíduo foi $94057.6$.

As figuras \ref{fig:hist.dist} e \ref{fig:hist.traf} mostram os histogramas das soluções visitadas pelo genético durante a sua execução. A figura
\ref{fig:hist.dist}, mostra a variedade da soma das distâncias entre os nós do \textit{backbone} e dos \textit{clusters}, considerando as possíveis
configurações de hierarquia para a rede. Fica evidente que o melhor indivíduo retornado pelo algoritmo, com $M = 24.4$, possui uma excelente configuração com
relação ao custo físico da rede. \textbf{\underline{ESSE HISTOGRAMA TEM QUE SER DA DISTANCIA MÉDIA!!!}}


\begin{figure}[!htb]
\begin{center}
\includegraphics[angle=0,scale=.5]{./figs/30.I1.s1.individuos-c4.DistT.eps}
 % hist.dist.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \caption{Histograma da soma das distâncias médias relativas às soluções visitadas pelo genético.}
 \label{fig:hist.dist}
\end{center}
\end{figure}


\begin{figure}[!htb]
\begin{center}
 \includegraphics[angle=0,scale=.5]{./figs/30.I1.s1.individuos-c4.TrafR_.eps}
 % hist.dist.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \caption{Histograma do tráfego de acesso relativo às soluções visitadas pelo genético.}
 \label{fig:hist.traf}
\end{center}
\end{figure}

A figura \ref{fig:hist.traf} ilustra a variação do tráfego de acesso entre as diversas configurações possíveis para a rede em hierarquia. Como pode ser
visto, a solução global retornada pelo genético, com $T = 51579.5$, está situada entre os indivíduos que representam as melhores soluções visitadas
para o tráfego de acesso.

De acordo com o critério de projeto, o posicionamento relativo da distância e do tráfego entre as possíveis estruturas hierárquicas, poderia ser modificada a
partir de uma alteração na ponderação entre tráfego de acesso e as distâncias no cálculo da função objetivo.

\underline{Em comparação com os resultados observados para distância, o tráfego de acesso possui uma variação menor com as modificações na configuração da rede.
Para a distância a diferença entre a pior e a melhor solução visitada foi de $XXX63\%$, enquanto para o tráfego essa diferença foi de apenas $XXX20\%$.}


\section{Estatísticas de Congestionamento e Tráfego Retransmitido}
\label{resultados:sec:estatisticas}

Para cada sub-rede, \textit{clusters} e \textit{backbone}, as instâncias a serem analisadas são definidas pelo grau lógico. Para uma sub-rede $k$ de
tamanho $t_k$, os graus lógicos considerados são $1$, $2$, ..., $\lfloor t_k/2\rfloor$. Para cada instância foram estimados a média e o desvio padrão, ambos
com confiança de $99\%$ e margem de erro de $1\%$.
%onde o \textit{backbone} é a sub-rede com $k=0$,
%$1$, $2$, $\cdot$, $\lfloor t_k/2\rfloor$

A partir de testes piloto, estimou-se que as estatísticas atingiam estabilidade a partir de $10^3$ amostras, para a confiança e o erro adotados. Portanto,
esse valor foi utilizado como
tamanho mínimo para as amostras. 

Deste modo, para cada grau lógico geramos aleatoriamente uma amostra de soluções para a topologia lógica da rede. Dois modelos de programação linear foram
implementados em \textit{AMPL} \cite{ampl} para distribuir o tráfego da rede sobre cada topologia lógica, através do solver \textit{GLPK} (\textit{GNU
Linear Programming Kit} - gnu.org/software/glpk). Obtendo, para cada topologia lógica gerada, a distribuição de tráfego ótima para o congestionamento da
rede e também para o total do tráfego retransmitido \cite{Renato06}. Dessas amostras estimamos a média e o desvio padrão das populações para o congestionamento
e para o tráfego retransmitido, garantindo a representatividade de cada amostra.

No decorrer deste capítulo, quando se fizer referência às sub-redes em estudo, a codificação que está apresentada na tabela \ref{tab:cod.id} será adotada para
identificação do \textit{backbone} e dos \textit{clusters}.

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline           Sub-rede & Tamanho & Identificação (ID) \\
\hline \textit{Backbone}  & $ 5 $  & bk.t5 \\
\hline \textit{Cluster} 1 & $ 5 $  & cl1.t5 \\
\hline \textit{Cluster} 2 & $ 6 $  & cl2.t6 \\
\hline \textit{Cluster} 3 & $ 7 $  & cl3.t7 \\
\hline \textit{Cluster} 4 & $ 8 $  & cl4.t8 \\
\hline \textit{Cluster} 5 & $ 4 $  & cl5.t4 \\
\hline
\end{tabular}
\end{center}
\caption{Identificação das sub-redes.}
\label{tab:cod.id}
\end{table}


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|ccc|}
\hline
GL & $=$ & Grau lógico \\
ID & $=$ & Identificação da sub-rede \\
LB & $=$ & \textit{Lower bound} \\
HLDA & $=$ & \textit{Heurística HLDA} \\
Min & $=$ & Mínimo amostral \\
Max & $=$ & Máximo amostral \\
MED & $=$ & Média amostral \\
DP & $=$ & Desvio padrão amostral \\
MEDn & $=$ & Tamanho da amostra para média \\
DPn & $=$ & Tamanho da amostra para desvio padrão \\
t(s) & $=$ & Tempo de execução em segundos \\
UBTRetr & $=$ & \textit{Upper bound} para tráfego retransmitido \\
Am\_UB & $=$ & Proporção de amostras situadas até o \textit{upper bound} \\
\hline
\end{tabular}
\end{center}
\caption{Legenda para as tabelas \ref{tab:result.est.cong} e \ref{tab:result.est.traf}}.
\label{tab:cod.legenda}
\end{table}


A tabela \ref{tab:cod.legenda} apresenta as legendas para as tabelas \ref{tab:result.est.cong} e \ref{tab:result.est.traf}, que serão
utilizadas na apresentação dos resultados obtidos para as estatísticas de congestionamento e tráfego retransmitido nas sub-redes. Cada linha dessas tabelas
representa uma instância do processo de estimação, sendo definida por uma sub-rede e um grau lógico.


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|cccccc|cc|c|}
\hline GL & ID & LB & HLDA & Min & Max & MED & DP & MEDn & DPn & t(s) \\
\hline 1 & c5.t4 & 4196 & 3\% & 3\% & 4\% & 3\% & 0.3\% & 1000 & 1000 & 1 \\
1 & bk.t5 & 8897 & 98\% & 97\% & 110\% & 100\% & 3.1\% & 1000 & 1000 & 3 \\
1 & c1.t5 & 5563 & 7\% & 5\% & 8\% & 7\% & 0.8\% & 1000 & 1000 & 3 \\
1 & c2.t6 & 5928 & 17\% & 10\% & 18\% & 13\% & 2.6\% & 1000 & 1000 & 8 \\
1 & c3.t7 & 7264 & 10\% & 7\% & 14\% & 10\% & 1.4\% & 1000 & 1000 & 19 \\
1 & c4.t8 & 8150 & 13\% & 10\% & 17\% & 13\% & 1.4\% & 1000 & 1000 & 42 \\
\hline 2 & c5.t4 & 2098 & 0\% & 0\% & 110\% & 35\% & 46.0\% & 13912 & 6927 & 33 \\
2 & bk.t5 & 4448 & 59\% & 21\% & 230\% & 71\% & 52.0\% & 17924 & 8888 & 89 \\
2 & c1.t5 & 2782 & 4\% & 0\% & 110\% & 16\% & 35.0\% & 8262 & 4123 & 38 \\
2 & c2.t6 & 2964 & 0\% & 0\% & 120\% & 13\% & 31.0\% & 6457 & 3450 & 67 \\
2 & c3.t7 & 3632 & 100\% & 0\% & 120\% & 9\% & 25.0\% & 3994 & 2170 & 86 \\
2 & c4.t8 & 4075 & 0\% & 0\% & 120\% & 8\% & 24.0\% & 3655 & 1895 & 186 \\
\hline 3 & c2.t6 & 1976 & 16\% & 0\% & 220\% & 24\% & 46.0\% & 13759 & 6606 & 148 \\
3 & c3.t7 & 2421 & 200\% & 0\% & 210\% & 14\% & 35.0\% & 7830 & 3857 & 174 \\
3 & c4.t8 & 2717 & 0\% & 0\% & 210\% & 13\% & 34.0\% & 7905 & 3773 & 416 \\
\hline 4 & c4.t8 & 2037 & 0\% & 0\% & 320\% & 18\% & 34.0\% & 7587 & 3712 & 404 \\
\hline
\end{tabular}
\end{center}
\caption{Resultado das estatísticas para o congestionamento.}
\label{tab:result.est.cong}
\end{table}


Nas tabelas \ref{tab:result.est.cong} e \ref{tab:result.est.traf}, a coluna LB representa um \textit{lower bound} para congestionamento e tráfego
retransmitido, respectivamente. As quatro colunas que a seguem, são apresentadas em valores percentuais relativamente ao \textit{lower bound}, mais
especificamente, quantos por cento acima do mesmo. Como \textit{lower bound} para o congestionamento foi utilizado o MTB (\textit{Minimun Traffic Bound}),
enquanto para o tráfego retransmitido utilizou-se o FTB (\textit{Forwarded Traffic Bound}). Ambos os métodos para cálculo de \textit{lower bounds}, foram
apresentados em \cite{dissertFabio}.


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|cccccc|cc|c|}
\hline GL & ID & LB & HLDA & Min & Max & MED & DP & MEDn & DPn & t(s) \\
\hline 1 & c5.t4 & 4500 & 92\% & 92\% & 94\% & 93\% & 1.1\% & 1000 & 1000 & 1 \\
1 & bk.t5 & 44000 & 16\% & 15\% & 22\% & 18\% & 2.3\% & 1000 & 1000 & 3 \\
1 & c1.t5 & 8500 & 100\% & 95\% & 110\% & 100\% & 4.2\% & 1000 & 1000 & 3 \\
1 & c2.t6 & 13000 & 110\% & 88\% & 110\% & 99\% & 5.6\% & 1000 & 1000 & 8 \\
1 & c3.t7 & 19000 & 95\% & 82\% & 100\% & 94\% & 5.7\% & 1000 & 1000 & 19 \\
1 & c4.t8 & 27000 & 100\% & 90\% & 110\% & 100\% & 4.1\% & 1000 & 1000 & 42 \\
\hline 2 & c5.t4 & 1400 & 100\% & 89\% & 290\% & 140\% & 66.0\% & 28994 & 14406 & 69 \\
2 & bk.t5 & 14000 & 58\% & 17\% & 100\% & 37\% & 21.0\% & 2964 & 1495 & 15 \\
2 & c1.t5 & 2700 & 170\% & 93\% & 330\% & 140\% & 57.0\% & 21766 & 11025 & 100 \\
2 & c2.t6 & 3900 & 120\% & 81\% & 320\% & 150\% & 45.0\% & 13389 & 6648 & 140 \\
2 & c3.t7 & 5300 & 270\% & 82\% & 350\% & 160\% & 40.0\% & 10736 & 5335 & 230 \\
2 & c4.t8 & 7700 & 150\% & 91\% & 370\% & 150\% & 35.0\% & 7946 & 3855 & 400 \\
\hline 3 & c2.t6 & 2400 & 150\% & 86\% & 460\% & 150\% & 56.0\% & 20890 & 10186 & 230 \\
3 & c3.t7 & 3700 & 360\% & 84\% & 410\% & 130\% & 40.0\% & 10798 & 5450 & 240 \\
3 & c4.t8 & 5000 & 98\% & 91\% & 400\% & 140\% & 36.0\% & 8729 & 4238 & 460 \\
\hline 4 & c4.t8 & 3500 & 110\% & 97\% & 530\% & 140\% & 38.0\% & 9595 & 4647 & 510 \\
\hline
\end{tabular}
\end{center}
\caption{Resultado das estatísticas para o tráfego retransmitido.}
\label{tab:result.est.traf}
\end{table}


As figuras \ref{fig:cong.lb} e \ref{fig:traf.lb} apresentam graficamente as variações dos \textit{lower bounds} de congestionamento e tráfego retransmitido,
respectivamente. Nelas é possível observar o comportamento dos mesmos em função do grau lógico em cada sub-rede.


\begin{figure}[!htb]
\includegraphics[angle=270,scale=.63]{./figs/cong.lb.eps}
 % cong.lb.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \caption{\textit{Lower bounds} para o congestionamento.}
 \label{fig:cong.lb} 
\end{figure}

\begin{figure}[!htb]
 \includegraphics[angle=270,scale=.63]{./figs/traf.lb.eps}
 % traf.lb.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \caption{\textit{Lower bounds} para o tráfego retransmitido.}
 \label{fig:traf.lb} 
\end{figure}


A variação dos máximos e mínimos amostrais para o tráfego retransmitido, de acordo com o grau lógico nas sub-redes, está apresentada na figura
\ref{fig:traf.mm}.  Destaca-se a pequena diferença entre máximo e mínimo para o caso de grau lógico 1. Ainda para o tráfego, a figura \ref{fig:traf.md.dp},
mostra o comportamento da média e desvio padrão. Mais uma vez observa-se a pouca variação no caso de grau lógico 1, que é indicada pelo pequeno desvio padrão.


% \begin{figure}[htb!]
%  \includegraphics[angle=270,scale=.63]{./figs/traf.max.min.eps}
%  % traf.gl1.max.min.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
%  \caption{Máximo e mínimo amostrais para o tráfego retransmitido.}
%  \label{fig:traf.mm}
% \end{figure}
% 
% \begin{figure}[htb!]
% \includegraphics[angle=270,scale=.63]{./figs/traf.md.dp.eps}
% \caption{Média e desvio padrão amostrais para o tráfego retransmitido.}
% \label{fig:traf.md.dp}
% \end{figure}

Conforme mencionado no capítulo anterior, o resultado principal dessa etapa de estimação de estatísticas para congestionamento e tráfego retransmitido é a
definição de \textit{upper bounds} para os mesmos. A partir das estatísticas obtidas pode-se definir uma regra para esses \textit{upper bounds} que
represente valores de boa qualidade para essas métricas. Os valores de \textit{upper bounds} definidos em função das estatísticas serão repassados para o
modelo TWA na etapa final do processo de resolução.

Com base nas estatísticas obtidas para o congestionamento, a regra adotada para seu \textit{upper bound} foi simplesmente a média amostral. Isso se deve a
pouca variabilidade das amostras. \underline{\textbf{Após nova rodada de testes explicar melhor.}}


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|cc|cc|}
\hline ID & GL & HmaxDs & UBHmax & TRetrDs & UBTRetr \\
\hline bk.t5 & 1 & 1.0 & 17636 & 1.0 & 51437 \\
bk.t5 & 2 & 0.5 & 6434 & 0.5 & 18088 \\
\hline c1.t5 & 1 & 1.0 & 5883 & 1.0 & 16835 \\
c1.t5 & 2 & 0.0 & 3224 & 0.5 & 5774 \\
\hline c2.t6 & 1 & 1.0 & 6558 & 1.5 & 24601 \\
c2.t6 & 2 & 0.0 & 3359 & 1.5 & 7092 \\
c2.t6 & 3 & 0.5 & 2002 & 1.0 & 4569 \\
\hline c3.t7 & 1 & 1.5 & 7836 & 1.5 & 35938 \\
c3.t7 & 2 & 0.0 & 3950 & 2.0 & 9625 \\
c3.t7 & 3 & 0.0 & 2768 & 1.0 & 6872 \\
\hline c4.t8 & 1 & 2.0 & 8984 & 2.5 & 51115 \\
c4.t8 & 2 & 0.0 & 4379 & 1.5 & 15137 \\
c4.t8 & 3 & 0.0 & 3071 & 1.0 & 9981 \\
c4.t8 & 4 & 0.5 & 2056 & 1.0 & 7194 \\
\hline c5.t4 & 1 & 1.5 & 4306 & 1.0 & 8555 \\
c5.t4 & 2 & 0.5 & 2353 & 0.5 & 2991 \\
\hline
\end{tabular}
\end{center}
\caption{\textit{Upper bounds} calculados para congestionamento e tráfego retransmitido.}
\label{tab:ubs}
\end{table}

Os \textit{upper bounds} foram definidos como a média menos uma quantidade de desvios padrão, tanto para o congestionamento ($HmDs$) quanto para o tráfego
retransmitido ($TrDs$). Ambos são um múltiplo de $1/2$ e foram definidos como o maior possível, desde que o \textit{upper bound} resultante não ultrapasse o
mínimo amostral.

Para o tráfego retransmitido, a regra definida foi a média amostral menos um desvio padrão amostral. 

A tabela \ref{tab:ubs} mostra os valores resultantes
desta regra. Na terceira coluna, estão os valores de \textit{upper bounds}, calculados em termos percentuais acima do respectivo \textit{lower bound}. A
última coluna apresenta a proporção de soluções visitadas ao longo do processo de estimação das estatísticas, que apresentaram tráfego retransmitido menor ou
igual ao \textit{upper bound}. Como pode-se notar, para grau lógico 1, uma proporção maior de soluções atenderiam à regra. Outra constatação é de que a medida
que o grau lógico aumenta, essa proporção é menor, independentemente do tamanho da sub-rede. Percebe-se também que no caso de malhas, grau lógico superior a 1,
a regra definida localiza o \textit{upper bound} em valores bastante restritivos já que no pior caso somente $11\%$ das soluções visitadas atenderiam ao mesmo.
Para grau lógico 1, caso particular onde a topologia virtual se resume a um anel, os valores mais altos para as proporções de soluções englobadas pelo
\textit{upper bound} podem ser explicados pelos resultados das estatísticas, onde se observa uma pequena variação entre o máximo e o mínimo amostral,
além de um pequeno desvio padrão.

Além dos parâmetros de controle que obtemos a partir das estatísticas, para garantir que a solução obtida para a topologia física não seja muito dependente
da instância, como foi comentado na Seção \ref{sec:subredes:custo_fisico}, calculamos a TIF para a rede NFSNET \cite{ram02}. O valor calculado foi $1.82$,
este será o valor de referência, sobre o qual ainda exigimos uma folga para baixo (\textit{TIFgap}), que variou entre $70\%$ e $20\%$. 


\section{Resolução das Sub-Redes com TWA}
\label{resultados:sec:twa}

Como iremos procurar soluções resolvendo um modelo de programação linear inteira, nestes testes, não estamos utilizando a capacidade de TWA de
produzir soluções com múltiplas ligações físicas, com o intuito de reduzir o número de variáveis binárias no modelo. Entretanto ainda são admitidas
soluções com múltiplas ligações lógicas, pois no TWA isso não interfere no número de variáveis. 

Iniciamos com um \textit{TIFgap} de $40\%$ pois em testes piloto este se mostrou promissor. Reduzimos \textit{TIFgap} nas situações em que não foi
possível encontrar solução viável. Adicionalmente, aumentamos o \textit{TIFgap} enquanto ainda fossem encontradas soluções, visando obter o melhor custo
físico possível que ainda atendesse as demais exigências.

Para cada \textit{TIFgap}, a estratégia adotada foi, partindo do menor grau lógico ($Gl=1$), fixar nos valores mínimos o número de comprimentos de onda, e
executar o modelo básico do TWA com as adições indicadas na Seção \ref{sec:subredes:restricoes}. Um \textit{solver} para problemas MILP é instanciado com
essa
configuração. Enquanto o solver retornar que o problema é insolúvel \cite{mukherjee}, $W$ será incrementado. 

Se o solver não encontrar uma solução viável dentro de $10^4$ segundos, então ele é abortado e é aplicado o mesmo precedimento de quando a
solução é insolúvel. Isso é feito com o objetivo de ``afrouxar'' as restrições de modo que o solver possa encontrar uma solução viável mais rapidamente, 
sacrificando um pouco a qualidade das restrições. Essas situações em que o modelo precisou ser calibrado, que
chamaremos de \textit{Instância Insolúvel} ($I$), fazem parte do método e são registradas conjuntamente com os resultados.

Se uma solução viável é encontrada, o \textit{solver} é interrompido,
a solução é registrada e o grau lógico é incrementado, dando continuidade ao processo. Vale relembrar que o \textit{solver} é interrompido pois todos os
parâmetros de interesse já estão limitados satisfatoriamente, portanto qualquer solução viável já atende o que foi exigido. Não sendo necessário perseguir
otimalidade neste ponto.

Como, nesta modelagem, $W$ está diretamente relacionado a quantidade de variáveis, é mais conveniente começar com $W=1$. Disso decorre a escolha 
de também começarmos com $Gl=1$. A maior prioridade para a incrementação é dada ao $Gl$, pois variando este temos instâncias diferentes. 
A menor precedência ficou para $W$, pois quanto menor ele for menores precisarão ser os custos de instalação da rede.

Utilizamos o \textit{solver} SCIP (\textit{Solving Constraint Integer Programs} - scip.zib.de) para encontrar as soluções viáveis. 

Além de calcular congestionamento e tráfego retransmitido para as estatísticas, como foi descrito acima na Seção \ref{sec:subredes:estatisticas}, o GLPK
também foi usado para interpretar o modelo AMPL, gerando a
entrada de dados para o SCIP. Vale observar que o SCIP e o GLPK são \textit{softwares} livres, de código fonte aberto e de distribuição gratuita.

A tabela \ref{tab:cod.legenda2} apresenta as legendas para a tabela \ref{tab:result.twa}, que será utilizada na apresentação dos
resultados obtidos para o projeto completo das sub-redes utilizando o modelo TWA.% e \ref{tab:result.var.twa}

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|ccc|}
\hline
GL & $=$ & Grau lógico \\
ID & $=$ & Identificação da sub-rede \\
W & $=$ & Número de comprimentos de onda \\
TTranc & $=$ & Total de transceptores \\
UBCong & $=$ & \textit{Upper bound} para congestionamento \\
UBTRetr & $=$ & \textit{Upper bound} para tráfego retransmitido \\ 
UBCFis & $=$ & \textit{Upper bound} para custo físico \\
Cong & $=$ & Congestionamento \\
TRetr & $=$ & Tráfego retransmitido \\
CFis & $=$ & Custo físico \\
t(s) & $=$ & Tempo de execução em segundos \\
Var\% & $=$ & Variação percentual \\
\hline
\end{tabular}
\end{center}
\caption{Legenda para a tabela \ref{tab:result.twa}.} % e \ref{tab:result.var.twa}
\label{tab:cod.legenda2}
\end{table}



\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|cc|ccccc|cc|}
\hline ID & GL & W & TIFgap & TTranc & CFis & TIF & Cong & TRetr & Ti(s)  & Tt(s) \\
\hline bk.t5 & 1 & 1 & 70\% & 5 & 51 & 0.54 & 51084 & 17526 & 0.1 & 5 \\
bk.t5 & 2 & 2 & 70\% & 10 & 51 & 0.54 & 17667 & 6434 & 0.4 & 15 \\
\hline c1.t5 & 1 & 1 & 20\% & 5 & 79 & 1.42 & 16635 & 5882 & 1 & 81842 \\
c1.t5 & 2 & 2 & 20\% & 9 & 79 & 1.42 & 5755 & 3003 & 11 & 95 \\
\hline c2.t6 & 1 & 2 & 40\% & 6 & 68 & 1.07 & 24484 & 6523 & 98 & 831 \\
c2.t6 & 2 & 3 & 40\% & 12 & 68 & 1.07 & 5556 & 2730 & 9 & 225 \\
c2.t6 & 3 & 4 & 40\% & 16 & 68 & 1.07 & 4267 & 2002 & 74 & 509 \\
\hline c3.t7 & 1 & 1 & 30\% & 7 & 85 & 1.24 & 35709 & 7821 & 37 & 221110 \\
c3.t7 & 2 & 3 & 30\% & 13 & 87 & 1.26 & 7755 & 2961 & 215 & 24271 \\
c3.t7 & 3 & 3 & 30\% & 18 & 84 & 1.23 & 6824 & 2768 & 2859 & 17586 \\
\hline c4.t8 & 1 & 1 & 40\% & 8 & 80 & 1.09 & 50807 & 8982 & 698 & 41074 \\
c4.t8 & 2 & 2 & 40\% & 16 & 79 & 1.06 & 7976 & 3582 & 17 & 21350 \\
c4.t8 & 3 & 2 & 40\% & 16 & 79 & 1.07 & 7069 & 3050 & 58 & 3999 \\
c4.t8 & 4 & 3 & 40\% & 22 & 77 & 1.04 & 6590 & 2056 & 587 & 23027 \\
\hline c5.t4 & 1 & 1 & 20\% & 4 & 65 & 1.36 & 8546 & 4304 & 0.4 & 9 \\
c5.t4 & 2 & 2 & 20\% & 7 & 65 & 1.36 & 233 & 1515 & 0.1 & 6 \\
\hline
\end{tabular}
\end{center}
\caption{Resumo dos resultados com TWA.}
\label{tab:result.twa}
\end{table}


A tabela \ref{tab:result.twa} apresenta os resultados obtidos com o TWA. Cada linha representa uma instância, composta por uma sub-rede e um grau lógico.

Nas instâncias onde o número de comprimentos de onda ($W$) necessário foi apenas $1$, significa que logo na primeira tentativa de resolução do modelo foi
possível encontrar uma solução viável que atendesse a todas as restrições impostas. Nos demais casos, foi necessário incrementar $W$ e executar novamente o
experimento, até encontrar uma solução viável.

No modelo TWA o grau lógico é representado como uma restrição no número total de transceptores na rede e em cada nó. Como se trata de uma limitação, existem
casos onde não são utilizados todos os transceptores permitidos pelo grau lógico definido. Como pode-se notar, além do grau lógico $1$ onde é óbvio que o
número de transceptores deve ser igual ao número de nós, somente para o grau lógico $2$ nas sub-redes de $5$ nós foi necessário utilizar todos os
transceptores permitidos, ou seja, o dobro do número de nós.

As colunas UBCong e UBTRetr representam os \textit{upper bounds} calculados a partir das estatísticas de média e desvio padrão para congestionamento e tráfego
retransmitido, conforme apresentado na seção anterior.

Conforme descrito no início desta seção, a limitação de custo físico foi definida com base na TIF da rede real NFSNET. Os valores da coluna UBCFis, foram
calculados a partir desse valor de referência para a TIF, menos um percentual (\textit{TIFgap}), que representa uma tentativa de forçar uma boa qualidade no
resultado do projeto da rede física. 

As três colunas que seguem, Cong, TRetr e CFis, trazem os resultados obtidos para congestionamento, tráfego retransmitido e custo físico, respectivamente.

Apesar do custo físico não possuir relação evidente com o grau lógico, os experimentos mostraram que para grau lógico $1$, topologia virtual em anel, o
mesmo pode ser mais exigido. Sendo este fato identificado pela necessidade de realizar ajustes para baixo no valor do \textit{TIFgap} adotado na TIF de
algumas
sub-redes.

Para duas instâncias, $c3.t7.gl1$ e $c1.t5.gl1$, mesmo com um \textit{TIFgap} de $0.0\%$ não foi possível encontrar solução
viável. Então relaxamos os UBs para congestionamento e tráfego retransmitido, reduzindo em $1/2$ o número de desvios abaixo da média para ambos, nas duas
instâncias. 


\begin{figure}[!htb]
 \includegraphics[angle=270,scale=.63]{./figs/twa.ftnet.eps}
  \label{fig:twa.ftnet}
 \caption{Resultados para tráfego retransmitido e de acesso ao \textit{backbone}.}
\end{figure}

A figura \ref{fig:twa.ftnet} mostra o comportamento do tráfego retransmitido em cada sub-rede de acordo com o grau lógico. Além disso, para evidenciar a solução
global da rede em hierarquia, ela destaca o tráfego de acesso ao \textit{backbone} que foi calculado na etapa inicial, quando o Algoritmo Genético fez a escolha
das sub-redes.


% \begin{table}[!ht]
% \begin{center}
% \begin{tabular}{|cc|cc|cc|cc|}
% \hline ID & GL & Cong & Var\% & CFis & Var\% & TRetr & Var\% \\
% \hline t5.bk & $1$ & & & $43$ & - & $50252$ & - \\
% t5.bk & $2$ & & & $52$ & $21\%$ & $15938$ & $-68\%$ \\
% %\hline t3.cl3 & $1$ & $104$ & - & $2407$ & - \\
% \hline t5.cl5 & $1$ & & & $81$ & - & $16404$ & - \\
% t5.cl5 & $2$ & & & $62$ & $-23\%$ & $3097$ & $-81\%$ \\
% \hline t7.cl2 & $1$ & & & $87$ & - & $37553$ & - \\
% t7.cl2 & $2$ & & & $86$ & $-1\%$ & $8973$ & $-76\%$ \\
% t7.cl2 & $3$ & & & $89$ & $3\%$ & $3476$ & $-61\%$ \\
% \hline t7.cl4 & $1$ & & & $140$ & - & $37943$ & - \\
% t7.cl4 & $2$ & & & $140$ & $0\%$ & $11320$ & $-70\%$ \\
% t7.cl4 & $3$ & & & $140$ & $0\%$ & $7215$ & $-36\%$ \\
% \hline t8.cl1 & $1$ & & & $141$ & - & $51930$ & - \\
% t8.cl1 & $2$ & & & $131$ & $-7\%$ & $14529$ & $-72\%$ \\
% t8.cl1 & $3$ & & & $131$ & $0\%$ & $9391$ & $-35\%$ \\
% t8.cl1 & $4$ & & & $134$ & $2\%$ & $6640$ & $-29\%$ \\
% \hline
% \end{tabular}
% \end{center}
% \caption{Comparativo variação \% TWA.}
% \label{tab:result.var.twa}
% \end{table}
% 
% 
% Para evidenciar a variação dos resultados, a tabela \ref{tab:result.var.twa} mostra em valores percentuais as diferenças observadas para congestionamento,
% tráfego retransmitido e custo físico. Observa-se que, como já era de se esperar, não foi verificada correlação entre o custo fí­sico e o grau lógico, mas sim
% com o tamanho da sub-rede. Com relação ao tráfego retransmitido internamente nas sub-redes, observa-se que o mesmo decresce
% consideravelmente a medida que aumenta-se o grau lógico.
