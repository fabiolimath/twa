
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Resultados
%% Copyright 2009 Marcelo de Oliveira Lima.
%% Este documento é distribuído nos termos da licença 
%% GNU General Public License v2.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Resultados}
\label{resultados}

Com o objetivo de demonstrar experimentalmente o funcionamento da metodologia proposta para o projeto de uma WRON em malhas hierárquicas, foram realizados
testes computacionais. Serão apresentados os detalhes dos testes realizados com uma rede de $30$ nós. As matrizes de tráfego e distâncias, dados de entrada do
problema, foram geradas de forma aleatória, com entradas uniformemente distribuídas. A matriz de tráfego possui valores entre $0$ e $100$. Já a
matriz de distâncias, obedecendo a \textit{desigualdade triangular} \cite{cormen02}, teve o posicionamento dos pontos sorteado sobre o quadrante do plano
cartesiano com
ordenadas e abssisas também entre $0$ e $100$.

O computador onde foram executados os experimentos possui a seguinte configuração: \textit{Intel Pentium\rr $4$ CPU $3.00GHz$} de $2$ núcleos, com $2048
KB$ de \textit{cache}, $1.5GB$ de RAM, executando o sistema operacional \textit{Kubuntu 9.04}. Na resolução dos modelos de programação linear e programação
linear inteira mista, citados ao longo deste capítulo, a precisão nos cálculos adotada foi de $10^{-6}$.

Para facilitar o entendimento das etapas do procedimento, elas serão apresentadas e discutidas em sequência. A primeira mostra como os nós da rede foram
divididos nas sub-redes em hierarquia a partir do método heurístico desenvolvido. Na segunda etapa, são apresentados os resultados das estatísticas de
congestionamento e tráfego retransmitido para cada sub-rede. Por fim, na última etapa são mostrados os resultados da resolução do modelo TWA para todas as
sub-redes.


\section{Composição das Sub-Redes}
\label{resultados:sec:hierarquia}

Na separação dos nós em \textit{clusters}, feita através do algoritmo genético implementado, definimos $M_i = 3$, o número mínimo de \textit{clusters}. E
como foi convencinado na seção \ref{sec:EstruturaHierarquica}, $M_i$ também equivale ao tamanho mínimo admitido para formar um \textit{cluster}, além de definir
o tamanho máximo e número máximo de \textit{clusters} na hierarquia $M_a = \lfloor n/M_i\rfloor = 30/3 = 10$.

Dentro do genético existem pesos que podem ser atribuídos às distâncias dentro e fora do \textit{backbone} e para o tráfego de acesso. Esses pesos dependem
do caso concreto em que se deseja analisar. Nestes testes esses pesos foram todos deixados como $1$. Contudo, existe um parâmetro de calibragem que deve ser
definido para deixar tráfego e distâncias com a mesma ordem de grandeza na função objetivo. Pois nela, o tráfego entra como uma soma simples e as distâncias
como uma média, além disso, ambos são calculados sobre valores da mesma ordem de grandeza, valores entre $0$ e $100$. 

Para estabelecer o parâmetro de calibragem ($C_a$), foi feito um teste piloto gerando aleatoriamente indivíduos para o genético, com redes de diverços
tamanhos, variando entre $10$ e $100$ nós. Empiricamente, estimamos que a esperança para o tráfego de acesso médio das populações ($E_t$) é razoavelmente
interpoloda pela curva:

\[ E_t(n) = \frac{2}{3}\cdot A_t\cdot(n^2 - n) \] 

Onde $A_t = 100$ é a amplitude do intervalo de onde foram retiradas as entradas da matriz de demandas, neste caso $100$, e $n$ é tamanho da rede. Além
disso, estimamos que a esperança da distância média das populações ($E_d$) é satisfatoriamente aproximada por $E_t = A_d/3$. Onde $A_d = 100$ pode ser
visto como a média geométrica entre as amplitudes dos intervalos dos eixos cartesianos aonde foram posicinados os pontos da matriz de distâncias.
Como $A_t = A_d$, o parâmetro de calibragem fica definido por:

\[ C_a = 2\cdot(n^2 - n) \]

Assim, na rede de $30$ em estudo, o fator de calibragem adotado foi $C_a = 1740$. Mas vale resaltar que estas estimativas devem ser revistas caso as
definições de $A_t$ e $A_d$ sejam modificadas, ou no caso de redes com mais que $100$ nós. 

Para os operadores genéticos da \textit{GAlib}, as probabilidades de mutação, crossover e substituição foram mantidas em seus valores \textit{default}. O
tamanho da população e o número de populações paralelas foram definidos como $100$. A estagnação máxmima adotada foi $500$, ou seja, o genético é
interrompido se ficar $500$ gerações sem haver melhora.

O tempo de execução do genético foi de $1845.76$ segundos. A estagnação definida foi alcançada na geração $5473$, tendo o genético visitado mais de $10^7$
soluções. A hierarquia obtida, que representa a melhor solução visitada pelo genético, está representada na
tabela
\ref{tab:hierarquia}. A hierarquia escolhida para a rede de $30$ nós é composta de $5$ \textit{clusters}, de tamanho variando entre $4$ e $8$ nós.

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|rcccccccc|}
\hline Tamanhos:  & $ 5 $ & $ 6 $ & $ 7 $ & $ 8 $ & $ 4  $ &&& \\
\textit{Clusters}: &&&&&&&& \\
$1$ - & $\mathbf{7 }$ & $ 9  $ & $ 16 $ & $ 26 $ & $ 27 $ & && \\
$2$ - & $\mathbf{28}$ & $ 11 $ & $ 24 $ & $ 25 $ & $ 4  $ & $ 20 $ && \\
$3$ - & $\mathbf{10}$ & $ 19 $ & $ 3  $ & $ 22 $ & $ 30 $ & $ 17 $ & $ 18 $ & \\
$4$ - & $\mathbf{15}$ & $ 1  $ & $ 14 $ & $ 23 $ & $ 12 $ & $ 21 $ & $ 29 $ & $ 6  $ \\
$5$ - & $\mathbf{13}$ & $ 5  $ & $ 8  $ & $ 2  $ &&&& \\
%  & ${\,\,\,\,\,\,\drsh}$ & \multicolumn{3}{l}{\textit{Backbone}} \\
\hline
\end{tabular}
\caption{Estrutura hierárquica para a rede de $30$ nós. Em negrito, os nós do \textit{backbone}.}
\label{tab:hierarquia}
\end{center}
\end{table}

Para a solução escolhida, a soma das distâncias, antes de calcular a média, para o \textit{backbone} foi $276.91$, e para os \textit{clusters} foi
$1920.23$. Como os pesos para a distância dentro e fora do \textit{backbone} foram definidos como iguais, essa média deixa de ser ponderada, tornando-se uma
média simples. O total de tráfego de acesso ao \textit{backbone} foi de $51579.5$. Assim, considerando os pesos e o fator de calibragem, o \textit{fitness}
do melhor indivíduo foi $94057.6$.
  
As figuras \ref{fig:hist.dist} e \ref{fig:hist.traf} mostram os histogramas das soluções visitadas pelo genético durante a sua execução. A figura
\ref{fig:hist.dist}, mostra a variedade da soma das distâncias entre os nós do \textit{backbone} e dos \textit{clusters}, considerando as possíveis
configurações de hierarquia para a rede. Fica evidente que o melhor indivíduo retornado pelo algoritmo possui uma excelente configuração com relação ao custo
físico da rede.

\begin{figure}[!htb]
 \includegraphics[angle=270,scale=.63]{./figs/hist.dist.eps}
 % hist.dist.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \caption{Histograma das distâncias relativas às soluções visitadas pelo genético.}
 \label{fig:hist.dist}
\end{figure}


\begin{figure}[!htb]
\includegraphics[angle=270,scale=.63]{./figs/hist.traf.eps}
% hist.dist.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
\caption{Histograma do tráfego de acesso relativo às soluções visitadas pelo genético.}
\label{fig:hist.traf}
\end{figure}

A figura \ref{fig:hist.traf} ilustra a variação do tráfego de acesso entre as diversas configurações possíveis para a rede em hierarquia. Como pode ser
visto, apesar de a solução global retornada pelo genético para o melhor indivíduo, não estar situada entre os indivíduos que representam as melhores
soluções visitadas para o tráfego, ainda assim, visualizando o universo de soluções possíveis, fica claro que se trata de uma solução de boa qualidade.

O posicionamento relativo da distância e do tráfego entre as possíveis estruturas hierárquicas, poderia ser modificada a partir de uma alteração na
ponderação entre tráfego e as distâncias. 

% Em comparação com os resultados observados para distância, o
% tráfego de acesso possui uma variação menor com as modificações na configuração da rede. Para a distância a diferença entre a pior e a melhor solução
% visitada
% foi de $63\%$, enquanto para o tráfego essa diferença foi de apenas $20\%$.


\section{Estatísticas de Congestionamento e Tráfego Retransmitido}
\label{resultados:sec:estatisticas}

Para cada sub-rede, \textit{clusters} e \textit{backbone}, as instâncias a serem analisadas são definidas pelo grau lógico. Para uma sub-rede $k$ de
tamanho $t_k$, os graus lógicos considerados são $1$, $2$, ..., $\lfloor t_k/2\rfloor$. Para cada instância foram estimados a média e o desvio padrão, ambos
com confiança de $99\%$ e margem de erro de $1\%$.
%onde o \textit{backbone} é a sub-rede com $k=0$,
%$1$, $2$, $\cdot$, $\lfloor t_k/2\rfloor$

A partir de testes piloto, estimou-se que as estatísticas etingiam estatabilidade a partir de $10^3$ amostras. Portanto, esse valor foi utilizado como
tamanho mínimo para as amostras.

Deste modo, para cada grau lógico geramos aleatoriamente uma amostra de soluções para a topologia lógica da rede. Modelos de programação linear foram
implementados em \textit{AMPL} \cite{ampl} para distribuir o tráfego da rede sobre cada topologia lógica, através do solver \textit{GLPK} (\textit{GNU
Linear Programming Kit} - gnu.org/software/glpk). Obtendo, para cada topologia lógica gerada, a distribuição de tráfego ótima para o congestionamento da
rede e também para o total do tráfego retransmitido \cite{Renato06}. Dessas amostras estimamos a média e o desvio padrão das populações para o congestionamento
e para o tráfego retransmitido, garantindo a representaividade de cada amostra.

No decorrer deste capítulo, quando se fizer referência às sub-redes em estudo, a codificação que está apresentada na tabela \ref{tab:cod.id} será adotada para
identificação do \textit{backbone} e dos \textit{clusters}.

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline           Sub-rede & Tamanho & Identificação (ID) \\
\hline \textit{Backbone}  & $ 5 $   & t5.bk \\
\hline \textit{Cluster} 1 & $ 5 $   & t5.cl1 \\
\hline \textit{Cluster} 2 & $ 6 $   & t6.cl2  \\
\hline \textit{Cluster} 3 & $ 7 $   & t7.cl3  \\
\hline \textit{Cluster} 4 & $ 8 $   & t8.cl4  \\
\hline \textit{Cluster} 5 & $ 4 $   & t4.cl5  \\
\hline
\end{tabular}
\end{center}
\caption{Identificação das sub-redes.}
\label{tab:cod.id}
\end{table}


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|ccc|}
\hline
GL & $=$ & Grau lógico \\
ID & $=$ & Identificação da sub-rede \\
LB & $=$ & \textit{Lower bound} \\
Min & $=$ & Mínimo amostral \\
Max & $=$ & Máximo amostral \\
MED & $=$ & Média amostral \\
DP & $=$ & Desvio padrão amostral \\
MEDn & $=$ & Tamanho da amostra para média \\
DPn & $=$ & Tamanho da amostra para desvio padrão \\
t(s) & $=$ & Tempo de execução em segundos \\
UBTRetr & $=$ & \textit{Upper bound} para tráfego retransmitido \\
Am\_UB & $=$ & Proporção de amostras situadas até o \textit{upper bound} \\
\hline
\end{tabular}
\end{center}
\caption{Legenda para as tabelas \ref{tab:result.est.cong}, \ref{tab:result.est.traf} e \ref{tab:ub.traf}}.
\label{tab:cod.legenda}
\end{table}


A tabela \ref{tab:cod.legenda} apresenta as legendas para as tabelas \ref{tab:result.est.cong}, \ref{tab:result.est.traf} e \ref{tab:ub.traf}, que serão
utilizadas na apresentação dos resultados obtidos para as estatísticas de congestionamento e tráfego retransmitido nas sub-redes. Cada linha dessas tabelas
representa uma instância do processo de estimação, sendo definida por uma sub-rede e um grau lógico.


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|ccccc|cc|c|}
\hline GL & ID & LB & Min & Max & MED & DP & MEDn & DPn & t(s) \\
\hline 1 & t8.cl1 & 1.8E+04 & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 1000 & 1000 & 1.1 \\
1 & t7.cl2 & 1.5E+04 & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 1000 & 1000 & 0.7 \\
1 & t7.cl4 & 1.6E+04 & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 1000 & 1000 & 0.7 \\
1 & t5.cl5 & 1.1E+04 & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 1000 & 1000 & 0.3 \\
1 & t5.bk & 3.4E+04 & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 1000 & 1000 & 0.3 \\
1 & t3.cl3 & 5.0E+03 & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 1000 & 1000 & 0.1 \\
\hline 2 & t8.cl1 & 9.0E+03 & 0.0\% & 0.1\% & 0.0\% & 0.0\% & 1000 & 1000 & 1.7 \\
2 & t7.cl2 & 7.7E+03 & 0.0\% & 1.7\% & 0.0\% & 0.1\% & 1000 & 1000 & 1.2 \\
2 & t7.cl4 & 7.9E+03 & 0.0\% & 1.9\% & 0.0\% & 0.1\% & 1000 & 1000 & 1.2 \\
2 & t5.cl5 & 5.7E+03 & 0.0\% & 1.3\% & 0.0\% & 0.1\% & 1000 & 1000 & 0.5 \\
2 & t5.bk & 1.7E+04 & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 1000 & 1000 & 0.5 \\
\hline 3 & t8.cl1 & 6.0E+03 & 0.0\% & 42.1\% & 0.7\% & 4.9\% & 1000 & 1000 & 1.9 \\
3 & t7.cl2 & 5.1E+03 & 0.0\% & 48.3\% & 1.5\% & 7.8\% & 1000 & 1000 & 1.3 \\
3 & t7.cl4 & 5.3E+03 & 0.0\% & 46.7\% & 1.5\% & 7.7\% & 1000 & 1000 & 1.3 \\
\hline 4 & t8.cl1 & 4.5E+03 & 0.0\% & 85.5\% & 0.1\% & 2.7\% & 1000 & 1000 & 2.0 \\
\hline
\end{tabular}
\end{center}
\caption{Resultado das estatísticas para o congestionamento.}
\label{tab:result.est.cong}
\end{table}


Nas tabelas \ref{tab:result.est.cong} e \ref{tab:result.est.traf}, a coluna LB representa um \textit{lower bound} para congestionamento e tráfego
retransmitido, respectivamente. As quatro colunas que a seguem, são apresentadas em valores percentuais relativamente ao \textit{lower bound}, mais
especificamente, quantos pontecento acima do mesmo. Como \textit{lower bound} para o congestionamento foi utilizado o MTB (\textit{Minimun Traffic Bound}),
enquanto para o tráfego retransmitido utilizou-se o FTB (\textit{Forwarded Traffic Bound}). Ambos os métodos para cálculo de \textit{lower bounds}, foram
apresentados em \cite{dissertFabio}.


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|ccccc|cc|c|}
\hline GL & ID & LB & MIN & Max & MED & DP & MEDn & DPn & t (s) \\
\hline 1 & t8.cl1 & 2.7E+04 & 86\% & 111\% & 98\% & 5\% & 1000 & 1000 & 1.2 \\
1 & t7.cl2 & 2.1E+04 & 81\% & 92\% & 86\% & 2\% & 1000 & 1000 & 0.8 \\
1 & t7.cl4 & 2.1E+04 & 78\% & 97\% & 87\% & 4\% & 1000 & 1000 & 0.8 \\
1 & t5.cl5 & 8.5E+03 & 93\% & 111\% & 102\% & 6\% & 1000 & 1000 & 0.3 \\
1 & t5.bk & 3.9E+04 & 28\% & 33\% & 30\% & 1\% & 1000 & 1000 & 0.3 \\
1 & t3.cl3 & 1.2E+03 & 100\% & 114\% & 107\% & 7\% & 1000 & 1000 & 0.1 \\
\hline 2 & t8.cl1 & 7.8E+03 & 90\% & 379\% & 148\% & 34\% & 7752 & 3743 & 15.9 \\
2 & t7.cl2 & 5.6E+03 & 80\% & 348\% & 153\% & 38\% & 9707 & 4818 & 14.4 \\
2 & t7.cl4 & 5.7E+03 & 77\% & 353\% & 156\% & 39\% & 10178 & 5034 & 15.4 \\
2 & t5.cl5 & 2.8E+03 & 90\% & 315\% & 134\% & 55\% & 20154 & 10185 & 19.5 \\
2 & t5.bk & 1.2E+04 & 27\% & 133\% & 57\% & 26\% & 4659 & 2315 & 3.1 \\
\hline 3 & t8.cl1 & 5.1E+03 & 85\% & 375\% & 132\% & 35\% & 8075 & 3922 & 16.5 \\
3 & t7.cl2 & 4.0E+03 & 82\% & 374\% & 115\% & 38\% & 9489 & 4791 & 14.0 \\
3 & t7.cl4 & 4.1E+03 & 78\% & 378\% & 117\% & 39\% & 9841 & 4960 & 14.7 \\
\hline 4 & t8.cl1 & 3.6E+03 & 89\% & 502\% & 136\% & 37\% & 8958 & 4293 & 17.8 \\
\hline
\end{tabular}
\end{center}
\caption{Resultado das estatísticas para o tráfego retransmitido.}
\label{tab:result.est.traf}
\end{table}


As figuras \ref{fig:cong.lb} e \ref{fig:traf.lb} apresentam graficamente as variações dos \textit{lower bounds} de congestionamento e tráfego retransmitido,
respectivamente. Nelas é possível observar o comportamento dos mesmos em função do grau lógico em cada sub-rede.


\begin{figure}[!htb]
\includegraphics[angle=270,scale=.63]{./figs/cong.lb.eps}
 % cong.lb.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \caption{\textit{Lower bounds} para o congestionamento.}
 \label{fig:cong.lb} 
\end{figure}

\begin{figure}[!htb]
 \includegraphics[angle=270,scale=.63]{./figs/traf.lb.eps}
 % traf.lb.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \caption{\textit{Lower bounds} para o tráfego retransmitido.}
 \label{fig:traf.lb} 
\end{figure}


A variação dos máximos e mínimos amostrais para o tráfego retransmitido, de acordo com o grau lógico nas sub-redes, está apresentada na figura
\ref{fig:traf.mm}.  Destaca-se a pequena diferença entre máximo e mínimo para o caso de grau lógico 1. Ainda para o tráfego, a figura \ref{fig:traf.md.dp},
mostra o comportamento da média e desvio padrão. Mais uma vez observa-se a pouca variação no caso de grau lógico 1, que é indicada pelo pequeno desvio padrão.


\begin{figure}[htb!]
 \includegraphics[angle=270,scale=.63]{./figs/traf.max.min.eps}
 % traf.gl1.max.min.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \caption{Máximo e mínimo amostrais para o tráfego retransmitido.}
 \label{fig:traf.mm}
\end{figure}

\begin{figure}[htb!]
\includegraphics[angle=270,scale=.63]{./figs/traf.md.dp.eps}
\caption{Média e desvio padrão amostrais para o tráfego retransmitido.}
\label{fig:traf.md.dp}
\end{figure}

Conforme mencionado no capítulo anterior, o resultado principal dessa etapa de estimação de estatísticas para congestionamento e tráfego retransmitido é a
definição de \textit{upper bounds} para os mesmos. A partir das estatísticas obtidas pode-se definir uma regra para esses \textit{upper bounds} que
represente valores de boa qualidade para essas métricas. Os valores de \textit{upper bounds} definidos em função das estatísticas serão repassados para o
modelo TWA na etapa final do processo de resolução.

% Com base nas estatísticas obtidas para o congestionamento, a regra adotada para seu \textit{upper bound} foi simplesmente a média amostral. Isso se deve a
% pouca variabilidade das amostras. \underline{\textbf{Após nova rodada de testes explicar melhor.}}


\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|cc|}
\hline GL & ID & UBTRetr & Am\_UB \\
\hline 1 & t8.cl1 & 93\% & 17\% \\
1 & t7.cl2 & 84\% & 17\% \\
1 & t7.cl4 & 83\% & 21\% \\
1 & t5.cl5 & 96\% & 23\% \\
1 & t5.bk & 29\% & 24\% \\
1 & t3.cl3 & 100\% & 0\% \\
\hline 2 & t8.cl1 & 114\% & 10\% \\
2 & t7.cl2 & 115\% & 11\% \\
2 & t7.cl4 & 117\% & 10\% \\
2 & t5.cl5 & 79\% & 0\% \\
2 & t5.bk & 31\% & 2\% \\
\hline 3 & t8.cl1 & 97\% & 4\% \\
3 & t7.cl2 & 77\% & 0\% \\
3 & t7.cl4 & 78\% & 0\% \\
\hline 4 & t8.cl1 & 100\% & 1\% \\
\hline
\end{tabular}
\end{center}
\caption{Upper Bound para o tráfego retransmitido e percentual de amostras que o atenderam.}
\label{tab:ub.traf}
\end{table}

Os \textit{upper bounds} foram definidos como a média menos uma quantiade de desvios padrão, para tanto o congestionamento ($HmDs$) quanto para o tráfego
retransmitido ($TrDs$). Ambos são um múltiplo de $1/2$ e foram definidos como o máior possível, desde que o \textit{upper bound} resultante não ultrapasse o
mínimo amostral.

% Para o tráfego retransmitido, a regra definida foi a média amostral menos um desvio padrão amostral. 
A tabela \ref{tab:ub.traf} mostra os valores resultantes
desta regra. Na terceira coluna, estão os valores de \textit{upper bounds}, calculados em termos percentuais acima do respectivo \textit{lower bound}. A
última coluna apresenta a proporção de soluções visitadas ao longo do processo de estimação das estatísticas, que apresentaram tráfego retransmitido menor ou
igual ao \textit{upper bound}. Como pode-se notar, para grau lógico 1, uma proporção maior de soluções atenderiam à regra. Outra constatação é de que a medida
que o grau lógico aumenta, essa proporção é menor, independentemente do tamanho da sub-rede. Percebe-se também que no caso de malhas, grau lógico superior a 1,
a regra definida localiza o \textit{upper bound} em valores bastante restritivos já que no pior caso somente $11\%$ das soluções visitadas atenderiam ao mesmo.
Para grau lógico 1, caso particular onde a topologia virtual se resume a um anel, os valores mais altos para as proporções de soluções englobadas pelo
\textit{upper bound} podem ser explicados pelos resultados das estatísticas, onde se observa uma pequena variação entre o máximo e o mínimo amostral,
além de um pequeno desvio padrão.



\section{Resolução das Sub-Redes com TWA}
\label{resultados:sec:twa}

Além dos parâmetros de controle que obtemos a partir das estatísticas, para garantir que a solução obtida para a topologia física não seja muito dependente
da instância, como foi comentado na Seção \ref{sec:subredes:custo_fisico}, calculamos a TIF para a rede NFSNET \cite{ram02}. O valor calculado foi $1.82$,
este será o valor de referência, sobre o qual ainda exigimos uma folga para baixo (\textit{TIFgap}), que variou entre $70\%$ e
$20\%$. Como iremos procurar soluções resolvendo um modelo de programação linear inteira, nestes testes, não estamos utilizando a capacidade de TWA de
produzir soluções com multiplas ligações físicas, com o intuito de reduzir o número de variáveis binárias no modelo. 

Iniciamos com um \textit{TIFgap} de $40\%$ pois em testes piloto este se mostrou promissor. O \textit{TIFgap} foi reduzido nas situações em que não foi
possível
encontrar solução viável, e aumentado enquando ainda fossem encontradas soluções.

Para cada \textit{TIFgap}, a estratégia adotada foi, partindo do menor grau lógico ($Gl=1$), fixar nos valores mínimos o número de comprimentos de onda, e
executar o modelo básico do TWA, com as adições indicadas na Seção \ref{sec:subredes:restricoes}. Um solver para problemas MILP é instanciado com essa
configuração. Enquanto o solver retornar que o problema é insolúvel \cite{mukherjee}, $W$ será incrementado. 

Se o solver não encontrar uma solução viável dentro de $10^4$ segundos, então ele é abortado e é aplicado o mesmo precedimento de quando a
solução é insolúvel. Isso é feito com o objetivo de ``afrouxar'' as restrições de modo que o solver possa encontrar uma solução viável mais rapidamente, 
sacrificando um pouco a qualidade das restrições. Essas situações em que o modelo precisou ser calibrado, que
chamaremos de \textit{Instância Insolúvel} ($I$), fazem parte do método e são registradas conjuntamente com os resultados.

Se uma solução viável é encontrada, o solver é interrompido,
a solução é registrada e o grau lógico é incrementado, dando continuidade ao processo.

Como, nesta modelagem, $W$ está diretamente relacionado a quantidade de variáveis, é mais conveniente começar com $W=1$. Disso decorre a escolha 
de também começarmos com $Gl=1$. A maior prioridade para a incrementação é dada ao $Gl$, pois variando este temos instâncias diferentes. 
A menor precedência ficou para $W$, pois quanto menor ele for menores precisarão ser os custos de instalação da rede.

Utilizamos o \textit{solver} SCIP (\textit{Solving Constraint Integer Programs} - scip.zib.de) para encontrar as soluções viáveis. Além de
calcular a capacidade dos canais ópticos ($Cap$), como foi descrito acima, o GLPK também foi usado para interpretar o modelo AMPL, gerando a
entrada de dados para o SCIP. Vale observar que o SCIP e o GLPK são \textit{softwares} livres, de código fonte aberto e de distribuição gratuita.

A tabela \ref{tab:cod.legenda2} apresenta as legendas para a tabela \ref{tab:result.twa}, que será utilizada na apresentação dos
resultados obtidos para o projeto completo das sub-redes utilizando o modelo TWA.% e \ref{tab:result.var.twa}

\begin{table}[!ht]
\begin{center}
\begin{tabular}{|ccc|}
\hline
GL & $=$ & Grau lógico \\
ID & $=$ & Identificação da sub-rede \\
W & $=$ & Número de comprimentos de onda \\
TTranc & $=$ & Total de tranceptores \\
UBCong & $=$ & \textit{Upper bound} para congestionamento \\
UBTRetr & $=$ & \textit{Upper bound} para tráfego retransmitido \\ 
UBCFis & $=$ & \textit{Upper bound} para custo físico \\
Cong & $=$ & Congestionamento \\
TRetr & $=$ & Tráfego retransmitido \\
CFis & $=$ & Custo físico \\
t(s) & $=$ & Tempo de execução em segundos \\
Var\% & $=$ & Variação percentual \\
\hline
\end{tabular}
\end{center}
\caption{Legenda para as tabelas \ref{tab:result.twa}.} % e \ref{tab:result.var.twa}
\label{tab:cod.legenda2}
\end{table}



\begin{table}[!ht]
\begin{center}
\begin{tabular}{|cc|cc|ccc|ccc|c|}
\hline ID & GL & W & TTranc & UBCong & UBTRetr & UBCFis & Cong & TRetr & CFis & t(s)** \\
\hline t5.bk & 1 & 1 & 5 & 34140 & 50609 & 55 & & 50252 & 43 & 5 \\
t5.bk & 2 & 1 & 10 & 17070 & 15973 & 55 & & 15938 & 52 & 2 \\
\hline t3.cl3 & 1 & 1 & 3 & 4980 & 2406 & $\mathbf{106}$ & & 2406 & 104 & 0.02 \\
\hline t5.cl5 & 1 & 1 & 5 & 11443 & 16674 & $\mathbf{86}$ & & 16404 & 81 & 5 \\
t5.cl5 & 2 & 3 & 10 & 5723 & 5003 & 64 & & 3097 & 62 & 6 \\
\hline t7.cl2 & 1 & 1 & 7 & 15384 & 38016 & 89 & & 37553 & 87 & 16 \\
t7.cl2 & 2 & 1 & 11 & 7692 & 12067 & 89 & & 8973 & 86 & 4 \\
t7.cl2 & 3 & 2 & 16 & 5207 & 7057 & 89 & & 3476 & 89 & 9 \\
\hline t7.cl4 & 1 & 1 & 7 & 15776 & 38489 & 141 & & 37943 & 140 & 65 \\
t7.cl4 & 2 & 1 & 12 & 7888 & 12346 & 141 & & 11320 & 140 & 3 \\
t7.cl4 & 3 & 2 & 12 & 5338 & 7222 & 141 & & 7215 & 140 & 41 \\
\hline t8.cl1 & 1 & 1 & 8 & 18051 & 52733 & $\mathbf{157}$ & & 51930 & 141 & 1313 \\
t8.cl1 & 2 & 2 & 13 & 9025 & 16605 & 134 & & 14529 & 131 & 322 \\
t8.cl1 & 3 & 3 & 18 & 6058 & 10072 & 134 & & 9391 & 131 & 2349 \\
t8.cl1 & 4 & 4 & 19 & 4517 & 7260 & 134 & & 6640 & 134 & 141 \\
\hline
\end{tabular}
\end{center}
\caption{Resumo resultados TWA.}
\label{tab:result.twa}
\end{table}


A tabela \ref{tab:result.twa} apresenta os resultados obtidos com o TWA. Cada linha representa uma instância, composta por uma sub-rede e um grau lógico.

Nas instâncias onde o número de comprimentos de onda ($W$) necessário foi apenas $1$, significa que logo na primeira tentativa de resolução do modelo foi
possível encontrar uma solução viável que atendesse a todas as restrições impostas. Nos demais casos, foi necessário incrementar $W$ e executar novamente o
experimento, até encontrar uma solução viável.

No modelo TWA o grau lógico é representado como uma restrição no número total de tranceptores na rede e em cada nó. Como se trata de uma limitação, existem
casos onde não são utilizados todos os tranceptores permitidos pelo grau lógico definido. Como pode-se notar, além do grau lógico $1$ onde é óbvio que o
número de tranceptores deve ser igual ao número de nós, somente para o grau lógico $2$ nas sub-redes de $5$ nós foi necessário utilizar todos os
tranceptores permitidos, ou seja, o dobro do número de nós.

As colunas UBCong e UBTRetr representam os \textit{upper bounds} calculados a partir das estatísticas de média e desvio padrão para congestionamento e tráfego
retransmitido, conforme apresentado na seção anterior.

Conforme descrito no início desta seção, a limitação de custo físico foi definida com base na TIF da rede real NFSNET. Os valores da coluna UBCFis, foram
calculados a partir desse valor de referência para a TIF, menos um percentual (\textit{TIFgap}), que representa uma tentativa de forçar uma boa qualidade no
resultado do projeto da rede física. 

As três colunas que seguem, Cong, TRetr e CFis, trazem os resultados obtidos para congestionamento, tráfego retransmitido e custo físico, respectivamente.

Apesar do custo físico não possuir relação evidente com o grau lógico, os experimentos mostraram que para grau lógico $1$, topologia virtual em anel, o
mesmo pode ser mais exigido. Sendo este fato identificado pela necessidade de realizar ajustes para baixo no valor do \textit{TIFgap} adotado na TIF de
algumas
sub-redes.

Para duas instâncias, $c3.t7.gl1$ e $c1.t5.gl1$, mesmo com um \textit{TIFgap} de $0.0\%$ não foi possível encontrar solução
viável. Então relaxamos os UBs para congestionamento e tráfego retransmitido, reduzindo em $1/2$ o número de desvios abaixo da média para ambos, nas duas
instâncias. 


\begin{figure}[!htb]
 \includegraphics[angle=270,scale=.63]{./figs/twa.traf.eps}
 % twa.traf.eps: 595x842 pixel, 72dpi, 20.99x29.70 cm, bb=0 0 595 842
 \label{fig:twa.traf}
 \caption{Resultados para tráfego retransmitido e de acesso ao \textit{backbone}.}
\end{figure}

A figura \ref{fig:twa.traf} mostra o comportamento do tráfego retransmitido em cada sub-rede de acordo com o grau lógico. Além disso, para evidenciar a solução
global da rede em hierarquia, ela destaca o tráfego de acesso ao \textit{backbone} que foi calculado na etapa inicial, quando o Algoritmo Genético fez a escolha
das sub-redes.


% \begin{table}[!ht]
% \begin{center}
% \begin{tabular}{|cc|cc|cc|cc|}
% \hline ID & GL & Cong & Var\% & CFis & Var\% & TRetr & Var\% \\
% \hline t5.bk & $1$ & & & $43$ & - & $50252$ & - \\
% t5.bk & $2$ & & & $52$ & $21\%$ & $15938$ & $-68\%$ \\
% %\hline t3.cl3 & $1$ & $104$ & - & $2407$ & - \\
% \hline t5.cl5 & $1$ & & & $81$ & - & $16404$ & - \\
% t5.cl5 & $2$ & & & $62$ & $-23\%$ & $3097$ & $-81\%$ \\
% \hline t7.cl2 & $1$ & & & $87$ & - & $37553$ & - \\
% t7.cl2 & $2$ & & & $86$ & $-1\%$ & $8973$ & $-76\%$ \\
% t7.cl2 & $3$ & & & $89$ & $3\%$ & $3476$ & $-61\%$ \\
% \hline t7.cl4 & $1$ & & & $140$ & - & $37943$ & - \\
% t7.cl4 & $2$ & & & $140$ & $0\%$ & $11320$ & $-70\%$ \\
% t7.cl4 & $3$ & & & $140$ & $0\%$ & $7215$ & $-36\%$ \\
% \hline t8.cl1 & $1$ & & & $141$ & - & $51930$ & - \\
% t8.cl1 & $2$ & & & $131$ & $-7\%$ & $14529$ & $-72\%$ \\
% t8.cl1 & $3$ & & & $131$ & $0\%$ & $9391$ & $-35\%$ \\
% t8.cl1 & $4$ & & & $134$ & $2\%$ & $6640$ & $-29\%$ \\
% \hline
% \end{tabular}
% \end{center}
% \caption{Comparativo variação \% TWA.}
% \label{tab:result.var.twa}
% \end{table}
% 
% 
% Para evidenciar a variação dos resultados, a tabela \ref{tab:result.var.twa} mostra em valores percentuais as diferenças observadas para congestionamento,
% tráfego retransmitido e custo físico. Observa-se que, como já era de se esperar, não foi verificada correlação entre o custo fí­sico e o grau lógico, mas sim
% com o tamanho da sub-rede. Com relação ao tráfego retransmitido internamente nas sub-redes, observa-se que o mesmo decresce
% consideravelmente a medida que aumenta-se o grau lógico.
