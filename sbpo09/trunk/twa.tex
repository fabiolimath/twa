
\section{Modelagem TWA}
\label{Basic}

A seguir será apresentada a forma básica do modelo TWA. A função objetivo aqui considerada é o número de saltos físicos na 
rede \cite{Karcius04}, e implicitamente também é controlado o número de comprimentos de onda \cite{Zang00}. Será considerada 
a restrição de conservação dos comprimentos de onda ao longo do caminho óptico \cite{Zang00}, ou seja, não trabalharemos com 
a hipótese de conversão de comprimentos de onda. A seguir, no conjunto de Dados \ref{Cons}, listamos as constantes que 
definem uma instância para o modelo.

\zz
\begin{notation}
Os índices $m,n,s,d,i,j\in \{1,..,N\}$ representam os nós da rede, onde os pares ordenados $(m,n)$, $(s,d)$ e $(i,j)$ indicam 
respectivamente ligações físicas, demandas de tráfego e ligações lógicas, com $m\neq n$, $s\neq d$ e $i\neq j$. O índice $w 
\in \{1,..,W\}$ representa os comprimentos de onda disponíveis.
\end{notation}

\zz
\begin{proposition}
\label{Cons}
Uma instância para o modelo TWA é definida por:

\begin{enumerate}
\item $N$ $=$ Número de nós da rede.
\item $W$ $=$ Número máximo de comprimentos de onda admitido por fibra.
\item $H$ $=$ Grau físico máximo de entrada e saída de cada nó.
\item $K$ $=$ Multiplicidade física máxima admitida entre os pares de nós.
\item $Cap$ $=$ Capacidade de tráfego de cada canal lógico.
\item $C_{m,n}$ $=$ Custo associado a uma ligação física orientada entre o par de nós $(m,n)$.
\item $T$ $=$ Custo por unidade de fluxo.
\item $P_{s,d}$ $=$ Demanda de tráfego, com origem $s$ e destino $d$.
\end{enumerate}
\end{proposition}

Para simplificar a notação das restrições do modelo, adota-se a constante $A_s = \sum_d P_{s,d}$, que é a soma de todas 
as demandas de tráfego com origem em $s$, pois o tráfego será agregado em relação à origem \cite{ram02}. Outro detalhe importante é que, como esta modelagem suporta multi-fibras e multi-caminhos, os pares $(m,n)$ e $(s,d)$ representam conjuntos de possíveis ligações físicas e lógicas, respectivamente. Esses conjuntos não serão explicitamente controlados, sendo esse um dos motivos da eficiência do modelo.

% \subsection{Topologia Generalizada}
% \label{Top}

A variável central do modelo, a partir da qual todas as demais serão definidas, chamada de \textit{componente da Topologia 
Generalizada} (ou simplesmente \textit{componente topológica}), é representada graficamente na Figura \ref{fig:B} e 
formalmente definida na Variável \ref{comp}. Ela sozinha representa as topologias lógica e física, o trajeto físico das 
ligações lógicas e o comprimento de onda utilizado. 

\zz
\begin{theorem}
\label{comp}
 Seja $B_{i,m,n,w} \in \{0,..,K\}$ uma componente topológica, com $i\neq n$, $\forall (i,m,n)$.
\end{theorem}

\begin{figure}[hb]
 \centering
\includegraphics[bb=36 739 246 805, scale=0.7]{figs/B.eps}
% B.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=36 739 246 805
 \caption{Representação gráfica de uma componente topológica.}
 \label{fig:B}
\end{figure}

% \begin{equation}
% s\neq j\quad \text{ e }\quad i\neq j\quad \forall (s,i,j).
% \label{Nules}
% \end{equation}

%A princípio, o número de variáveis do tipo descrito aqui seria $N^3\cdot W$, mas devemos excluir algumas que são 
% trivialmente nulas: $s\neq j$ pois $s$ é origem da ligação lógica e $j$ é destino da ligação física; e $i\neq j$ pois não são 
% aceitos \textit{autoloops} \cite{cormen02}.

\begin{figure}[hb]
 \centering
\includegraphics[bb=39 455 511 811, scale=0.6]{figs/topologias.eps}
 % topologias.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=30 375 511 801
 \caption{Exemplo da interpretação das componentes topológicas.}
 \label{fig:Tops}
\end{figure}
%\clearpage

Numa componente da topologia generalizada $B_{i,m,n,w} = k$, o índice $i$ representa o nó de origem das $k$ ligações lógicas 
que, passando por uma das ligações físicas iniciadas em $m$ e incidentes em $n$, usa o comprimento de onda $w$. Em outras 
palavras, \textit{uma componente topológica $B_{i,m,n,w} = k$ é iniciada em $m$, incidente em $n$, com origem $i$, 
comprimento de onda $w$ e valor $k$}. Esse vocabulário será usado no restante do texto.

 Na Figura \ref{fig:Tops}, temos um exemplo de interpretação das componentes topológicas, todas com origem no nó $i$ e com o 
mesmo comprimento de onda $w_1$. No item $d)$ desta figura, o valor $2$ da componente que liga os nós $(i,m)$ é interpretado 
como duas ligações físicas entre esses nós, representadas no item $a)$. No item $b)$, vemos uma ligação lógica dupla entre os 
nós $(i,n)$, onde uma delas passa de forma transparente pelo nó $m$, como indicado no item $c)$. Note ainda que, no item 
$d)$, dois caminhos lógicos incidentes em $m$ mas apenas um iniciado. Isso indica que uma ligação lógica termina em $m$, 
enquanto a outra segue adiante.

A definição das componentes topológicas não deixa claro aonde terminam as ligações lógicas. Sua finalização será garantida 
implicitamente pelas restrições do modelo. Isso reflete a agregação do roteamento dos comprimentos de onda, similar a trabalhos encontradas na literatura \cite{Jaumard04}.

 Se $B_{i,m,n,w}=0$, na ligação física $(m,n)$ (que pode então não existir), não 
existem ligações lógicas iniciadas em $i$, passando por $(m,n)$, usando o comprimento de onda $w$. Por outro lado, se 
$B_{i,m,n,w}=k$, para algum $k \in \{0,..,K\}$, existem $k$ ligações lógicas originadas em $i$ no 
comprimento de onda $w$, passando por $k$ ligações físicas distintas entre o par de nós $(m,n)$ (que agora obrigatoriamente 
existem). Note que $K$ limita apenas a multiplicidade dos enlaces físicos. Mesmo que $K=1$ ( $B_{i,m,n,w}$ será uma variável 
binária), as  ligações lógicas entre um par $(i,j)$ poderão usar múltiplos trajetos físicos, ou inda, mais de um comprimento 
de onda em uma mesma fibra.

% A multiplicidade das ligações lógicas pode ser controlada por uma restrição própria, que será mostrada na Seção 
% \ref{ControlMl}.

%  Na versão mais enxuta, com a topologia física fixada (veja a Seção \ref{Fis}, adiante) do modelo é adicionada apenas a 
% variável de distribuição de fluxo agregado. Dependendo do caso de uso, outras variáveis podem ser necessárias (como será 
% visto na Seção \ref{cases}), mas nenhuma supera o número de componentes da topologia generalizada, que define portanto a 
% ordem de grandeza do número de variáveis desta modelagem.

% \subsection{Conservação do Percurso Lógico}
% \label{ConservLogS}

\zz
\begin{theorem}
\label{FisVar}
 Seja $D_{m,n} \in \{0,..,K\}$ o número de ligações físicas entre o par de nós $(m,n)$. 
\end{theorem}

\zz
\begin{theorem}
 \label{FlowVar}
 Seja $q_{s,i,j} \in [0,1]$ a fração de fluxo agregado do nó $s$, passando pela ligação lógica $(i,j)$, com $s\neq j$. 
\end{theorem}

\begin{equation}
 \sum_n B_{i,n,m,w} \geq \sum_n B_{i,m,n,w} ,\quad \forall (i,m,w) \text{, com } i\neq m.
\label{ConservLog}
\end{equation} 

\begin{equation}
\sum_i B_{i,m,n,w} \leq D_{m,n},\quad \forall (m,n,w).
\label{DefFis}
\end{equation} 

\begin{equation}
\sum_n D_{m,n} \leq H,\quad \forall m \qquad \text{e} \qquad \sum_m D_{m,n} \leq H,\quad \forall n.
\label{ConservGFis}
\end{equation} 

\begin{equation}
\sum_{s} q_{s,i,j}\cdot A_s \leq Cap\cdot (\sum_{m,w} B_{i,m,j,w} - \sum_{n,w} B_{i,j,n,w}),\quad \forall (i,j).
\label{DefCapFlow}
\end{equation} 

\begin{equation}
\sum_j q_{s,s,j} = 1,\, \forall s \quad \text{e} \quad 
\sum_i q_{s,i,d} - \sum_j q_{s,d,j} = \frac{P_{s,d}}{A_s},\, \forall (s,d).
\label{ConservFlow}
\end{equation} 

\begin{equation}
 \label{ObjB}
 \text{Minimize: } \sum_{i,m,n,w} B_{i,m,n,w}.
\end{equation}

A Restrição (\ref{ConservLog}) garante a continuidade dos percursos e a conservação dos comprimentos de onda. Se o número de 
componentes de topológicas incidentes em $m$ for maior que o número de iniciadas, não originadas nele, essa diferença é 
o número de ligações lógicas que terminam em $m$. É deste modo que a finalização das ligações lógicas pode ser mapeada. Isso 
assegura a rastreabilidade de uma componente da topologia generalizada até a origem da ligação lógica.

%Esta restrição garante que se há ligações lógicas saindo de um nó $m$, iniciadas em $i$ no comprimento de onda $w$, mas não 
% originadas nele ($i\neq m$), então deverá haver (pelo menos) em igual número ligações lógicas incidentes em $m$, com a 
% mesma origem e no mesmo comprimento de onda.

% \begin{figure}[htb]
%  \centering
%  \includegraphics[bb=70 210 533 771, scale=0.5]{figs/unsolved.eps}
%  % unsolved.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=70 210 533 771
%  \caption{Duas possibilidades de interpretação das componentes topológicas.}
%  \label{fig:Unsolved}
% \end{figure}
% 
% Isto é suficiente para a modelagem, embora na implementação real de múltiplas rotas físicas entre um mesmo par de nós 
% $(i,j)$, alguns detalhes ainda carecem ser decididos, pois podem haver mais de uma maneira de configura-los. Um exemplo disso 
% é dado na Figura \ref{fig:Unsolved}, onde o conjunto de componentes topológicas dado permite duas possibilidades de 
% configuração dos percursos lógicos. Essas situações podem ser tratadas considerando outros fatores, como a distância entre os 
% nós. Mas são questões de menor complexidade, se a topologia generalizada já estiver decidida, e podem ser resolvidas na fase 
% de configuração da rede. Como isso não influencia na modelagem e portanto não será tratado aqui.
% 
% Não é evitado explicitamente a ocorrência de ciclos no percurso dos caminhos ópticos, mas isso é indiretamente controlado 
% pela função objetivo, seja ela de minimização de custos, de congestionamento (Seção \ref{Cong}) ou número de comprimentos de 
% onda utilizados (Seção \ref{CtrlW}). E mesmo que apareçam ciclos, eles não invalidam o resultado.
% 
% \subsection{Topologia Física}
% \label{Fis}

Apesar da topologia física ser determinada pelas componentes da topologia generalizada, para fins de controle do grau físico, 
é necessário uma variável adicional, que é definida na Variável \ref{FisVar}. Se $D_{m,n}=0$, não há ligações físicas entre o 
par $(m,n)$, mas se $D_{m,n}=k$, para algum $k \in \{0,..,K\}$, existem $k$ ligações físicas entre o par $(m,n)$. Se a 
topologia física for fixada, isto é, informada como um dado de entrada, as componentes da topologia generalizada 
$B_{i,m,n,w}$, com $D_{m,n}=0$, devem ser retiradas da modelagem. Isto deve ser considerado em todo o modelo e daqui por 
diante toma-se como subentendido. 

Quando $D_{m,n}$ é fixa, a Restrição (\ref{DefFis}) limita a multiplicidade física das componentes, por outro lado, quando a 
$D_{m,n}$  é variável, ela apenas registra em $D_{m,n}$ a multiplicidade física alcançada pelas componentes da topologia 
generalizada. Se a topologia física é livre, a Restrição (\ref{ConservGFis}) é necessária para o controle do grau físico de 
saída e entrada em cada nó, caso contrário esta restrição pode ser desconsiderada.

%Quando a topologia física é livre, não é controlada a existência de $D_{i,j}\neq 0$, com $B_{s,i,j,w}=0$, $\forall (s,w)$. 
% Dependendo do caso de uso, isso ou não influencia no resultado, ou pode ser controlado indiretamente pela função objetivo, 
% por exemplo, por meio do custo de instalação. Opcionalmente poderia-se usar para este fim uma restrição da forma $\sum_{s,w} 
% B_{s,i,j,w} \geq D_{i,j}$, para todo $(i,j)$, mas essa hipótese é por hora desconsiderada.

% \subsection{Controle de Fluxo}
% \label{Flow}

Para a distribuição do tráfego são usadas as variáveis de fração de fluxo agregado definidas na Variável \ref{FlowVar} e 
determinadas pela Restrição (\ref{DefCapFlow}). Como podem haver múltiplos canais lógicos entre um par $(i,j)$, o tráfego 
entre um par de nós é limitado pela capacidade de um canal lógico multiplicada pelo número de ligações lógicas em questão. 
Esse número é obtido da quantidade de componentes topológicas originadas em $i$ e incidentes em $j$, diminuído do número de 
componentes topológicas iniciadas em $j$ e originadas em $i$. 

A conservação de fluxo é assegurada pela Restrição (\ref{ConservFlow}), que também garante o envio e a entrega das demandas 
de tráfego. As aquações da Restrição (\ref{ConservFlow}) são semelhantes, em sua forma, às encontradas na modelagem agregada 
para o VTD \cite{ram02}. todavia, sua interpretação é sutilmente diferente, pois aqui uma fração de fluxo pode representar 
vários canais ópticos entre o par $(i,j)$.

% \subsection{Saltos Físicos}

Uma métrica importante para o projeto de redes ópticas é o número de saltos físicos da topologia\cite{Karcius04}. Este valor 
é minimizado na Função Objetivo (\ref{ObjB}), através da soma de todas as componentes topológicas, pois cada componente 
topológica representa um salto físico. Uma propriedade importante desta abordagem, é que ela controla o aparecimento de 
ciclos na topologia generalizada. Opcionalmente essa soma poderia ser apenas limitada por um valor, através de uma restrição, 
se outra função for mais apropriada.

Quando a topologia física é um parâmetro, o número de pares $(m,n)$ válidos é da ordem de $N\cdot H$. Assim o número de 
componentes da topologia generalizada será da ordem de $N²\cdot H\cdot W$, semelhante aos modelos mais enxutos para RWA 
\cite{Jaumard04}. Considerando $H$ e $W$ constantes, a ordem de grandeza do número de variáveis deste modelo será $N²$, 
similar a de modelos que resolvem apenas o VTD \cite{ram02}.


\subsection{Ligações Lógicas em cada Fibra e Grau Lógico}

Dada a abrangência do modelo básico, diverças métricas poderiam ser controladas ou diretamente minimizadas, conforme a aplicação.
Apresentamos agora como podem ser incluídos dois parâmetros de 
controle bem conhecidos e que serão utilizados nos experimentos computacinais da Seção \ref{testes}.

No modelo TWA o número de ligações lógicas é implicitamente limitado pela capacidade física do nó $m$ de realizar ligações lógicas, que é a capacidade do \textit{Optical switch} de receber ou originar conexões \cite{Zang00}. Todavia, o número de receptores ou 
transmissores em um nó, pode ser menor que essa capacidade \cite{Zang00,ram02}. Assumimos que todos os nós tem o mesmo número 
de receptores e transmissores, que é chamado de grau lógico ($Gl$), que também passa a ser um dado de entrada. Para controlar 
o grau lógico de saída e entrada em cada nó, é necessária a Restrição \ref{ConservGl}, que deve ser adicionada ao modelo básico. 

Outro controle muito usado nas modelagens de RWA  \cite{Zang00,Jaumard04}, é o número máximo de 
ligações lógicas por fibra  $L$ (Dados \ref{adicionais}). Ele pode ser usada para limitar cada ligação física, como é feito pela 
Restrição (\ref{L}).

\zz
\begin{proposition}
Constantes adicionais:
\begin{enumerate}
 \item $Gl$ $=$ Grau Lógico.
 \item $L$ $=$ Número máximo de ligações lógicas em cada fibra.
\end{enumerate}
\label{adicionais}
\end{proposition}

\begin{equation}
\sum_{w,n} B_{m,m,n,w} \leq Gl,\quad \text{e}\quad 
\sum_{i,n,w} B_{i,n,m,w} - \sum_{i,n,w} B_{i,m,n,w} \leq Gl,\quad \forall m \text{, com } i\neq m.
\label{ConservGl}
\end{equation} 

\begin{equation}
 \label{L}
\sum_{i,w} B_{i,m,n,w}\leq L,\quad \forall (m,n).
\end{equation}


