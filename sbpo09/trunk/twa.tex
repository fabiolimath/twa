
\section{Modelagem TWA}
\label{Basic}

Nesta seção será apresentada a forma básica do modelo TWA, começando pela notação designada aos nós e as constantes que definem uma instância de
problema para o modelo. Em seguida serão definidas as variáveis utilizadas para compor as restrições e a função objetivo do modelo, passando-se
então à sua descrição. Como os experimentos realizados neste trabalho objetivaram primariamente a comparação da eficiência do TWA com resultados
previamente publicados, para efeitos de compatibilidade: o número de saltos físicos na rede foi tomado como função objetivo \cite{Karcius04}; o
número de comprimentos de onda foi controlado de maneira implícita \cite{Zang00}; e foi considerada a restrição de conservação dos comprimentos de
onda ao longo do caminho óptico \cite{Zang00}, ou seja, não se admite a conversão de comprimentos de onda na camada óptica da rede.

\zz
\begin{notation}
Os índices $m,n,s,d,i,j\in \{1,..,N\}$ representam os nós da rede, e os pares ordenados $(m,n)$, $(s,d)$ e $(i,j)$ indicam 
respectivamente ligações físicas, demandas de tráfego e ligações lógicas, com $m\neq n$, $s\neq d$ e $i\neq j$. O índice $w 
\in \{1,..,W\}$ representa os comprimentos de onda disponíveis.
\end{notation}

% Para simplificar a notação das restrições do modelo, adota-se a constante $A_s = \sum_d P_{s,d}$, que é a soma de todas 
% as demandas de tráfego com origem em $s$, pois o tráfego será agregado em relação à origem \cite{ram02}.

A Figura \ref{fig:Indices} ilustra os diferentes escopos dos índices associados aos nós da rede, com relação aos enlaces físicos $(m,n)$, lógicos
$(i,j)$ e demandas de tráfego $(s,d)$. Esta notação segue a convenção comumente utilizada em trabalhos anteriores \cite{mukherjee, ram02}. É
importante dizer que, como esta modelagem suporta múltiplas fibras e caminhos ópticos entre cada par de nós, os pares $(m,n)$ e $(s,d)$ representam
conjuntos de possíveis ligações físicas e lógicas, respectivamente. Esses conjuntos não serão explicitamente controlados, sendo esse um dos motivos
da eficiência do modelo.

\begin{figure}[hb]
\centering
% \includegraphics[bb=0 0 612 170, scale=0.7]{figs/TanA.JPG}
% TanA.JPG: 816x227 pixel, 96dpi, 21.59x6.01 cm, bb=0 0 612 170
\includegraphics[bb=50 656 565 798, scale=0.8]{figs/indices.eps}
% indices.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=50 656 565 798
\caption{Representação gráfica da notação associada aos nós da rede.}
\label{fig:Indices}
\end{figure}
% \clearpage

% \subsection{Topologia Generalizada}
% \label{Top}

\zz
\begin{proposition}
\label{Cons}
Uma instância para o modelo TWA é definida por:

\begin{enumerate}
\item $N$ $=$ Número de nós da rede.
\item $W$ $=$ Número máximo de comprimentos de onda admitido por fibra.
% \item $H$ $=$ Grau físico máximo de entrada e saída de cada nó.
\item $K$ $=$ Multiplicidade física máxima admitida entre os pares de nós.
\item $Cap$ $=$ Capacidade de tráfego de cada canal lógico.
% \item $C_{m,n}$ $=$ Custo associado a uma ligação física orientada entre o par de nós $(m,n)$.
% \item $T$ $=$ Custo por unidade de fluxo.
\item $P_{s,d}$ $=$ Demanda de tráfego, com origem $s$ e destino $d$, com $A_s = \sum_d P_{s,d}$.
% \item $A_s = \sum_d P_{s,d}$ $=$ Soma de todas as demandas de tráfego, com origem $s$.
\end{enumerate}
\end{proposition}

A variável central do modelo, a partir da qual todas as demais serão definidas, chamada de \textit{componente da Topologia 
Generalizada} (ou simplesmente \textit{componente topológica}), é representada graficamente na Figura \ref{fig:B} e 
formalmente definida na Variável \ref{comp}. Ela sozinha representa as topologias lógica e física, o trajeto físico das 
ligações lógicas e o comprimento de onda utilizado. Conforme a terminologia utilizada
neste trabalho daqui por diante, \textit{uma componente topológica $B_{i,m,n,w} = k$ é iniciada em $m$, incidente em $n$, com origem $i$,
comprimento de onda $w$ e valor $k$}.


\zz
\begin{theorem}
\label{comp}
 Seja $B_{i,m,n,w} = k\in \{0,..,K\}$, com $i\neq n$, uma componente do conjunto das ligações lógicas com origem $i$ e comprimento de onda $w$,
que utilizam $k$ ligações físicas entre os nós $m$ e $n$.
\end{theorem}

Considerando que $B_{i,m,n,w}=k$ para algum $k \in \{0,..,K\}$, existem $k$ ligações lógicas originadas em $i$ no comprimento de onda $w$, passando
por $k$ enlaces físicos distintos entre o par de nós $(m,n)$. Neste caso, cada um desses $k$ enlaces físicos terá que ser uma fibra óptica distinta
interligando o mesmo par de nós $(m,n)$, pois haveria interferência se houvessem dois sinais ópticos originados por fluxos de tráfego diferentes se
propagando no mesmo sentido, na mesma fibra, com o mesmo comprimento de onda. Note que $K$ limita apenas a multiplicidade dos enlaces físicos, ou
seja, o número de fibras ópticas dispostas em paralelo entre dois nós $(m,n)$. Mesmo que $K=1$, o que torna $B_{i,m,n,w}$ uma variável binária, as
diversas ligações lógicas entre um par $(i,j)$ poderão usar múltiplos trajetos físicos, ou ainda, mais de um comprimento de onda em uma mesma
fibra. Se ,$\forall i$ , $k=0$ para qualquer $w$, então nenhum enlace físico entre o par de nós $(m,n)$ é utilizado, ou seja $B_{i,m,n,w}=0$, $\forall (i,w)$.

\begin{figure}[hb]
 \centering
\includegraphics[bb=36 739 246 805, scale=0.7]{figs/B.eps}
% B.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=36 739 246 805
 \caption{Representação gráfica de uma componente topológica.}
 \label{fig:B}
\end{figure}

% \begin{equation}
% s\neq j\quad \text{ e }\quad i\neq j\quad \forall (s,i,j).
% \label{Nules}
% \end{equation}

%A princípio, o número de variáveis do tipo descrito aqui seria $N^3\cdot W$, mas devemos excluir algumas que são 
% trivialmente nulas: $s\neq j$ pois $s$ é origem da ligação lógica e $j$ é destino da ligação física; e $i\neq j$ pois não são 
% aceitos \textit{autoloops} \cite{cormen02}.

% Numa componente da topologia generalizada $B_{i,m,n,w} = k$, o índice $i$ representa o nó de origem das $k$ ligações lógicas 
% que, passando por uma das ligações físicas iniciadas em $m$ e incidentes em $n$, usa o comprimento de onda $w$.

% \clearpage
\begin{figure}[hb]
 \centering
\includegraphics[bb=39 455 511 811, scale=0.6]{figs/topologias.eps}
 % topologias.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=30 375 511 801
 \caption{Exemplo da interpretação das componentes topológicas.}
 \label{fig:Tops}
\end{figure}
% \clearpage

 Na Figura \ref{fig:Tops}, temos um exemplo de interpretação das componentes topológicas, todas com origem no nó $i$ e com o 
mesmo comprimento de onda $w_1$. No item $d)$ desta figura, o valor $2$ da componente que liga os nós $(i,m)$ é interpretado 
como duas ligações físicas entre esses nós, representadas no item $a)$. No item $b)$, vemos uma ligação lógica dupla entre os 
nós $(i,n)$, onde uma delas passa de forma transparente pelo nó $m$, como indicado no item $c)$. Note ainda que, no item 
$d)$, há dois caminhos lógicos incidentes em $m$ mas apenas um iniciando. Isso indica que uma ligação lógica termina em $m$, 
enquanto a outra segue adiante.

% A definição das componentes topológicas não deixa claro aonde terminam as ligações lógicas. Sua finalização será garantida 
% implicitamente pelas restrições do modelo. Isso reflete a agregação do roteamento dos comprimentos de onda, similar a trabalhos encontradas na
% literatura \cite{Jaumard04}.

A indexação atribuída às variáveis $B_{i,m,n,w}$ especificam apenas o nó $i$ onde se iniciam os enlaces lógicos representados. Isto
significa que estas variáveis agregam todas as ligações lógicas originadas em $i$ que utilizam o enlace físico $(m,n)$ e o comprimento de onda $w$,
independente do nó $j$ em que terminam estas ligações lógicas. Esta técnica consiste em uma abordagem bastante conhecida para a representação de
variáveis em problemas de distribuição de fluxo em redes. Em \cite{Tornatore07}, este conceito de agregação de tráfego é aplicado como meio de
simplificação do modelo, reduzindo substancialmente o número de variáveis dos problemas resultantes. No TWA, esta agregação cumpre o mesmo papel de
simplificação, cabendo às restrições do modelo garantir implicitamente a terminação correta destas ligações lógicas agregadas nas variáveis
$B_{i,m,n,w} $.

%  Se $B_{i,m,n,w}=0$, na ligação física $(m,n)$ (que pode então não existir), não 
% existem ligações lógicas iniciadas em $i$, passando por $(m,n)$, usando o comprimento de onda $w$. Por outro lado, se 
% $B_{i,m,n,w}=k$, para algum $k \in \{0,..,K\}$, existem $k$ ligações lógicas originadas em $i$ no 
% comprimento de onda $w$, passando por $k$ ligações físicas distintas entre o par de nós $(m,n)$ (que agora obrigatoriamente 
% existem). Note que $K$ limita apenas a multiplicidade dos enlaces físicos. Mesmo que $K=1$ ( $B_{i,m,n,w}$ será uma variável 
% binária), as  ligações lógicas entre um par $(i,j)$ poderão usar múltiplos trajetos físicos, ou inda, mais de um comprimento 
% de onda em uma mesma fibra.

% A multiplicidade das ligações lógicas pode ser controlada por uma restrição própria, que será mostrada na Seção 
% \ref{ControlMl}.

%  Na versão mais enxuta, com a topologia física fixada (veja a Seção \ref{Fis}, adiante) do modelo é adicionada apenas a 
% variável de distribuição de fluxo agregado. Dependendo do caso de uso, outras variáveis podem ser necessárias (como será 
% visto na Seção \ref{cases}), mas nenhuma supera o número de componentes da topologia generalizada, que define portanto a 
% ordem de grandeza do número de variáveis desta modelagem.

% \subsection{Conservação do Percurso Lógico}
% \label{ConservLogS}

As Variáveis \ref{FisVar} e \ref{FlowVar} completam as definições necessárias para apresentarmos a forma básica do modelo TWA, expresso nas
equações de (\ref{ConservLog}) à (\ref{ObjB}).

\zz
\begin{theorem}
\label{FisVar}
 Seja $D_{m,n} \in \{0,..,K\}$ o número de ligações físicas entre o par de nós $(m,n)$. 
\end{theorem}

\zz
\begin{theorem}
 \label{FlowVar}
 Seja $q_{s,i,j} \in [0,1]$ a fração de fluxo originado em $s$, passando pelas ligações lógicas entre o par $(i,j)$, com $s\neq j$. 
\end{theorem}

\begin{equation}
 \sum_n B_{i,n,m,w} \geq \sum_n B_{i,m,n,w} ,\quad \forall (i,m,w) \text{, com } i\neq m.
\label{ConservLog}
\end{equation} 

\begin{equation}
\sum_i B_{i,m,n,w} \leq D_{m,n},\quad \forall (m,n,w).
\label{DefFis}
\end{equation} 

% \begin{equation}
% \sum_n D_{m,n} \leq H,\quad \forall m \qquad \text{e} \qquad \sum_m D_{m,n} \leq H,\quad \forall n.
% \label{ConservGFis}
% \end{equation} 

\begin{equation}
\sum_{s} q_{s,i,j}\cdot A_s \leq Cap\cdot (\sum_{m,w} B_{i,m,j,w} - \sum_{n,w} B_{i,j,n,w}),\quad \forall (i,j).
\label{DefCapFlow}
\end{equation} 

\begin{equation}
\sum_j q_{s,s,j} = 1,\, \forall s \quad \text{e} \quad 
\sum_i q_{s,i,d} - \sum_j q_{s,d,j} = \frac{P_{s,d}}{A_s},\, \forall (s,d).
\label{ConservFlow}
\end{equation} 

\begin{equation}
 \label{ObjB}
 \text{Minimize: } \sum_{i,m,n,w} B_{i,m,n,w}.
\end{equation}

A Restrição (\ref{ConservLog}) garante a continuidade dos percursos e a conservação dos comprimentos de onda. Se o número de 
componentes topológicas incidentes em $m$ for maior que o número de iniciadas, não originadas nele, essa diferença é 
o número de ligações lógicas que terminam em $m$. É deste modo que a finalização das ligações lógicas pode ser mapeada. Isso 
assegura a rastreabilidade das ligações lógicas desde sua origem, a partir das componentes topológicas agregadas.

%Esta restrição garante que se há ligações lógicas saindo de um nó $m$, iniciadas em $i$ no comprimento de onda $w$, mas não 
% originadas nele ($i\neq m$), então deverá haver (pelo menos) em igual número ligações lógicas incidentes em $m$, com a 
% mesma origem e no mesmo comprimento de onda.

% \begin{figure}[htb]
%  \centering
%  \includegraphics[bb=70 210 533 771, scale=0.5]{figs/unsolved.eps}
%  % unsolved.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=70 210 533 771
%  \caption{Duas possibilidades de interpretação das componentes topológicas.}
%  \label{fig:Unsolved}
% \end{figure}
% 
% Isto é suficiente para a modelagem, embora na implementação real de múltiplas rotas físicas entre um mesmo par de nós 
% $(i,j)$, alguns detalhes ainda carecem ser decididos, pois podem haver mais de uma maneira de configura-los. Um exemplo disso 
% é dado na Figura \ref{fig:Unsolved}, onde o conjunto de componentes topológicas dado permite duas possibilidades de 
% configuração dos percursos lógicos. Essas situações podem ser tratadas considerando outros fatores, como a distância entre os 
% nós. Mas são questões de menor complexidade, se a topologia generalizada já estiver decidida, e podem ser resolvidas na fase 
% de configuração da rede. Como isso não influencia na modelagem e portanto não será tratado aqui.
% 
% Não é evitado explicitamente a ocorrência de ciclos no percurso dos caminhos ópticos, mas isso é indiretamente controlado 
% pela função objetivo, seja ela de minimização de custos, de congestionamento (Seção \ref{Cong}) ou número de comprimentos de 
% onda utilizados (Seção \ref{CtrlW}). E mesmo que apareçam ciclos, eles não invalidam o resultado.
% 
% \subsection{Topologia Física}
% \label{Fis}

Apesar da topologia física ser determinada pelas componentes da topologia generalizada, para fins de controle do custo de instalação da rede física, 
são necessárias novas incógnitas. Para este fim, é definida a Variável \ref{FisVar}, que registra em $D_{m,n}$ a multiplicidade física alcançada pelas
componentes topológicas. Se $D_{m,n}=0$, não há ligações físicas entre o 
par $(m,n)$, mas se $D_{m,n}=k$, para algum $k \in \{0,..,K\}$, existem $k$ ligações físicas entre o par $(m,n)$. Pela forma como $D_{m,n}$ é
calculada na Restrição \ref{FisVar}, a rigor, seu valor poderia ser maior do que é determinado pelas componentes topológicas. Mas isso não ocorre pois o número
de ligações físicas será minimizado na função objetivo.

Se $D_{m,n}$ for dado de entrada do problema, a Restrição (\ref{DefFis}) limita a multiplicidade física das componentes topológicas 
$B_{i,m,n,w}$. Ainda neste caso, se $D_{m,n}=0$ para um certo par $(m,n)$, devem ser retiradas da modelagem as variáveis $B_{i,m,n,w}$ correspondentes. Isto deve
ser considerado em todo o modelo e daqui por diante toma-se como subentendido.

% Se a topologia física é livre, a Restrição (\ref{ConservGFis}) é necessária para o controle do grau físico de 
% saída e entrada em cada nó, caso contrário esta restrição pode ser desconsiderada.

%Quando a topologia física é livre, não é controlada a existência de $D_{i,j}\neq 0$, com $B_{s,i,j,w}=0$, $\forall (s,w)$. 
% Dependendo do caso de uso, isso ou não influencia no resultado, ou pode ser controlado indiretamente pela função objetivo, 
% por exemplo, por meio do custo de instalação. Opcionalmente poderia-se usar para este fim uma restrição da forma $\sum_{s,w} 
% B_{s,i,j,w} \geq D_{i,j}$, para todo $(i,j)$, mas essa hipótese é por hora desconsiderada.

% \subsection{Controle de Fluxo}
% \label{Flow}

Para resolver o sub-problema de roteamento de tráfego, são definidas as variáveis de fração de fluxo agregado (Variável \ref{FlowVar}), utilizadas
na Restrição (\ref{DefCapFlow}). Como podem haver múltiplas ligações lógicas entre um par $(i,j)$, o tráfego 
entre um par de nós deverá ser limitado pela capacidade de uma ligação lógica multiplicada pelo número de ligações lógicas em questão. Na
Restrição \ref{DefCapFlow}, este número é representado, para as ligações lógicas entre o par $(i,j)$, como a
quantidade de componentes topológicas incidentes em $j$ ({\footnotesize$\sum_{m,w}B_{i,m,j,w}$}), diminuído do número de componentes
topológicas iniciadas em $j$ ({\footnotesize$\sum_{n,w}B_{i,j,n,w}$}).

% Esse número, na Restrição \ref{DefCapFlow}, é obtido da quantidade de componentes topológicas originadas em $i$ e incidentes em $j$, diminuído do
% número de componentes topológicas iniciadas em $j$ e originadas em $i$. 

A conservação de fluxo é assegurada pela Restrição (\ref{ConservFlow}), que também garante o envio e a entrega das demandas 
de tráfego. As equações da Restrição (\ref{ConservFlow}) são semelhantes, em sua forma, às encontradas na modelagem agregada 
para o VTD \cite{ram02}. Todavia, sua interpretação é sutilmente diferente, pois aqui uma determinada fração de fluxo de tráfego pode ser subdividida e
transportada simultaneamente por mais de uma ligação lógica entre o par $(i,j)$. Por exemplo, em comprimentos de onda diferentes em um mesmo enlace
físico $(m,n)$ que interliga diretamente $(i,j)$, ou por rotas físicas disjuntas entre os nós $(i,j)$, neste último caso, independente do
comprimento de onda.

% \subsection{Saltos Físicos}

Uma métrica importante para o projeto de redes ópticas é o número de saltos físicos da topologia \cite{Zang00}. Este valor 
é minimizado na Função Objetivo (\ref{ObjB}), através da soma de todas as componentes topológicas, pois cada componente 
topológica representa um salto físico. Uma propriedade importante desta abordagem é que ela evita o aparecimento de 
ciclos na topologia generalizada. O ideal seria minimizar a distância percorrida por cada enlace lógico, o que controlaria a degradação do sinal óptico.
Minimizar o número total de saltos foi adotado por uma questão de compatibilidade com os resultados encontrados em \cite{Karcius04}, que serão usados na
comparação dos experimentos computacionais da Seção \ref{testes}.

Como o número de componentes topológicas é $N³\cdotp W$ e o número de restrições é $\Theta(N²\cdotp W)$, o número de variáveis do modelo é da ordem de
$\Theta(N³\cdotp W)$. Quando a topologia física é um dado de entrada, sendo $H$ o número total de ligações físicas da rede, então o número de 
componentes da topologia generalizada será $N\cdotp H\cdotp W$, portanto, o número de variáveis do modelo será $\Theta(N\cdotp H\cdotp W)$, semelhante aos modelos
mais enxutos para resolver apenas o RWA \cite{Jaumard04}.


\subsection{Ligações Lógicas em cada Fibra e Grau Lógico}

Dada a abrangência do modelo básico, diversas métricas poderiam ser controladas ou diretamente minimizadas, conforme a aplicação.
Apresentamos agora como podem ser incluídos dois parâmetros de 
controle bem conhecidos e que serão utilizados nos experimentos computacionais da Seção \ref{testes}.

No modelo TWA o número de ligações lógicas é implicitamente limitado pela capacidade física do nó $m$ de realizar ligações lógicas, que é a
capacidade do \textit{Optical switch} de receber ou originar conexões \cite{Zang00}. Todavia, o número de transceptores em um nó, pode ser menor
que essa capacidade \cite{Zang00,ram02}. Assumimos que todos os nós tem o mesmo número 
de transceptores, que é chamado de grau lógico ($Gl$), que também passa a ser um dado de entrada. Para controlar 
o grau lógico de saída e entrada em cada nó, é necessária a Restrição \ref{ConservGl}, que deve ser adicionada ao modelo básico. 

Outro controle muito usado nas modelagens de RWA , é o número máximo de 
ligações lógicas por fibra  $L$ (Dados \ref{adicionais}) \cite{Zang00,Jaumard04}. Este parâmetro limita a densidade da multiplexação de
comprimentos de onda por enlace físico, um importante aspecto de Redes Ópticas WDM. Este limite é implementado pela Restrição (\ref{L}).

\zz
\begin{proposition}
Constantes adicionais:
\begin{enumerate}
 \item $Gl$ $=$ Grau Lógico.
 \item $L$ $=$ Número máximo de ligações lógicas em cada fibra.
\end{enumerate}
\label{adicionais}
\end{proposition}

\begin{equation}
\sum_{w,n} B_{m,m,n,w} \leq Gl,\quad \text{e}\quad 
\sum_{i,n,w} B_{i,n,m,w} - \sum_{i,n,w} B_{i,m,n,w} \leq Gl,\quad \forall m \text{, com } i\neq m.
\label{ConservGl}
\end{equation} 

\begin{equation}
 \label{L}
\sum_{i,w} B_{i,m,n,w}\leq L,\quad \forall (m,n).
\end{equation}


