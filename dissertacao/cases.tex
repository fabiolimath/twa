
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Adaptações do Modelo Básico
%% Copyright 2009 Fabio de Oliveira Lima.
%% Este documento é distribuído nos termos da licença 
%% GNU General Public License v2.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Extensões ao Modelo Básico}
\label{cases}

Neste capítulo são apresentados outros casos de uso da modelagem TWA. Dada a abrangência da modelagem diversas métricas podem ser controladas ou
diretamente minimizadas, conforme a aplicação. Apresentamos agora como podem ser incluídos parâmetros de controle bem conhecidos, sendo que alguns deles
serão utilizados
nos experimentos computacionais das Seções \ref{cap:testes-sec:CompKarcius} e \ref{cap:testes-sec:CompSivarajan}.


Veremos, por exemplo, como incluir as restrições de controle do grau lógico dos nós e como usar o congestionamento como função objetivo, duas considerações
comuns das modelagens de VTD \cite{ram02}. Serão mostradas também formas de controlar ou otimizar o número de comprimentos de onda, entre outras métricas
normalmente vistas em modelos de RWA
\cite{Zang00}.

% Algumas vezes ao longo desta seção será necessário considerar a capacidade física do nó $m$ de realizar ligações lógicas 
% (Dados \ref{CapLogi}), que é a capacidade do \textit{Optical switch} de receber ou originar ligações \cite{Zang00}. 
% 
% \zz
% \begin{dados}
% Se a topologia física é uma variável do modelo ($D_{mn}$), o grau físico de entrada e saída $H$ é considerado uniforme para 
% a rede e $CapLog_m = H\cdot W$. Caso seja de interesse fixar a topologia física, passando a mesma como parâmetro do modelo, 
% $CapLog_m = \sum_n D_{m,n}\cdot W$.\label{CapLogi}
% \end{dados}

\section{Topologia Física}
\label{cap:cases-sec:fis}

A topologia física pode ser um dos dados de entrada do problema, fixando em $D_{mn}$ os valores da rede existente, neste caso, diz-se que a topologia física
é fixa, caso contrário, diz-se que a topologia física é variável. 
Neste caso, a função da restrição de controle da topologia física no modelo básico (\ref{rest:DefFis}) seria limitar a multiplicidade física dos componentes
topológicos $B_{iw}^{mn}$. Neste caso, se $D_{mn}=0$ para um certo par $(m,n)$, devem ser retiradas da instância do problema as variáveis $B_{iw}^{mn}$
correspondentes. Isto deve ser considerado em todas as variáveis e restrições do modelo. Para facilitar a leitura desta seção, a
Restrição \ref{rest:DefFis} é repetida na equação \ref{eq:cases:DefFis}.

\begin{equation}
\sum_i B_{iw}^{mn} \leqslant D_{mn} \Forall{(m,n,w)}
\label{eq:cases:DefFis}
\end{equation} 

Quando a topologia física é um dado de entrada, sendo $H$ o número total de ligações físicas da rede, o número de variáveis binárias associadas aos  
componentes topológicos será $\Theta(N\cdotp H\cdotp W \cdotp K)$. Pois o fator $N^2$ correspondente aos pares $(m,n)$ é substituído por $H$. Supondo uma
topologia física conexa, temos $H>N$, pois a topologia física conexa
com o menor número de ligações físicas possível é um anel, que possui exatamente $N$ nós \cite{cormen02}.  Entretanto, é razoável
supor que $H<N^2$, pois $N^2 - N$ é o número de ligações em um grafo completo, e as redes na prática não chegam nem perto disso. Assim, o número de
variáveis binárias do modelo TWA para uma topologia física como dado de entrada é $O(N^3\cdotp W \cdotp K)$ e $o(N^2\cdotp W \cdotp K)$, em notação
assintótica.

Se a topologia física é variável, como foi comentado na Seção \ref{cap:twa-sec:limitacoes}, a Restrição \ref{rest:DefFis} permite que haja excessos na
variável de topologia física $D_{mn}$, que são indiretamente controlados pela função objetivo do modelo básico. Se a variável de topologia física $D_{m,n}$
não for minimizada direta ou indiretamente na função objetivo, pode-se usar a equação \ref{eq:CtrlFis} para anular as ligações físicas não utilizadas.
Entretanto, quando houverem ligações físicas utilizadas entre o par $(m,n)$, ainda seria possível que $D_{mn}$ registre valores maiores que o necessário
para atender aos componentes topológicos, conforme foi comentado na Seção \ref{cap:twa-sec:limitacoes} a respeito da Restrição \ref{rest:DefFis}. Mas, se
$D_{mn}$ não influencia na função objetivo, esse excesso poderá ser retirado analisando a solução obtida. Portanto, não seria necessário utilizar e equação
\ref{eq:CtrlFis} para manter a integridade da modelagem.

\begin{equation}
	\sum_{i,w} B_{iw}^{mn} \geqslant D_{mn} \Forall{(m,n)}
	\label{eq:CtrlFis}
\end{equation}

\section{Grau Lógico e Multiplicidade de Ligações Lógicas}
\label{ConservGl}

No modelo básico do TWA o número de ligações lógicas não é limitado, mas é controlado indiretamente pelos custos de instalação e pelo número de
comprimentos de onda por ligação física, ou ainda, caso a topologia física seja um dado de entrada, pelo número de ligações físicas existentes. 
Caso se queira fazer esse controle diretamente, serão considerados os dados de entrada $Gout_v$ e $Gin_v$ que representam, respectivamente, os graus
lógicos de saída e entrada do nó $v$.  

A fim de controlar o grau lógico, são necessárias duas restrições que devem ser adicionadas ao modelo básico: a Restrição \ref{cases:rest:GLout}
que controla o grau lógico de saída; e a Restrição \ref{cases:rest:GLin} que controla o grau lógico de entrada. A Restrição \ref{cases:rest:Ml} acrescenta a
limitação da multiplicidade das ligações lógicas ($Ml$) ao modelo TWA, que é 
indiretamente limitada pelo grau lógico. Outra alternativa é controlar a multiplicidade das ligações lógicas por plano lógico ($PMl$), o que é feito pela
Restrição \ref{cases:rest:PMl}. Essas restrições são aqui incluídas para oferecer compatibilidade com modelagens para o VTD, onde é usual
fazer o controle do grau lógico e da multiplicidade de ligações \cite{ram96}.

% \zz
\begin{dados} Constantes adicionais: 
 \begin{enumerate}
\item $Gout_v$ $=$ Grau Lógico de saída do nó $v$.
\item $Gin_v$ $=$ Grau Lógico de entrada do nó $v$.
\item $Ml$ $=$ Multiplicidade das Ligações Lógicas.                                              
\item $PMl$ $=$ Multiplicidade das Ligações Lógicas por Plano Lógico.                                              
\end{enumerate}
\label{Gl-Ml}
\end{dados}

\textbf{Restrições}

\begin{itemize}
	\item Controle do Grau lógico:

\begin{equation}
\sum_{wn} B_{vw}^{vn} \leqslant Gin_v\Forall{v}
\label{cases:rest:GLout}
\end{equation} 

\begin{equation}
\sum_{iwm} B_{iw}^{mv} - \sum_{iwn} B_{iw}^{vn} \leqslant Gout_v\Forall{v},\, \mbox{\small$i\neq v$} 
\label{cases:rest:GLin}
\end{equation} 

	\item Multiplicidade de Ligações Lógicas:

\begin{equation}
\sum_{wm} B_{iw}^{mv} - \sum_{wn} B_{iw}^{vn} \leqslant Ml\Forall{(i,v)},\, \mbox{\small$i\neq v$}
\label{cases:rest:Ml}
\end{equation}

\begin{equation}
\sum_{m} B_{iw}^{mv} - \sum_{n} B_{iw}^{vn} \leqslant PMl\Forall{(i,v,w)},\, \mbox{\small$i\neq v$}
\label{cases:rest:PMl}
\end{equation}

	
\end{itemize}

Cada ligação lógica partindo de um nó $v$ está diretamente associada a um componente topológico em particular, no qual, o nó de origem das ligações lógicas
($i$) coincide como o nó de início do componente ($m$), ou seja, $i=m=v$. Para contabilizar a quantidade de ligações lógicas deixando o nó $v$, a restrição
\ref{cases:rest:GLout} soma todos os componentes topológicos com essa característica, em todos os planos lógicos.

Como o roteamento das ligações lógicas é agregado em relação à origem, determinar a quantidade de ligações lógicas incidentes em $v$ é mais complexo. Na
Seção \ref{cap:twa-sec:Bconserv_Cap}, a equação \ref{eq:ConserBdif} define o valor $LL_{iv}^w$, que é reescrito em \ref{eq:Diffivw}; ele representa o
número de ligações lógicas entre o par $(i,v)$ no plano $w$. Para controlar o total de ligações que terminam em $v$ vindas de qualquer $i$, em todos os
planos lógicos, a Restrição \ref{cases:rest:GLin} equivale à equação \ref{eq:Diffv}, que limita a soma de $LL_{iv}^w$, para todo $i$ e $w$, pelo grau lógico
de
entrada.

\begin{equation}
  LL_{iv}^w = \sum_{m} B_{iw}^{mv} - \sum_{n} B_{iw}^{vn} \geqslant 0 \Forall{(i,v,w)}
   \label{eq:Diffivw}
\end{equation}

\begin{equation}
  \sum_{iw}LL_{iv}^w \leqslant  Gout_v\Forall{v},\, \mbox{\small$i\neq v$} 
   \label{eq:Diffv}
\end{equation}

\begin{equation}
  \sum_{w}LL_{iv}^w \leqslant Ml \Forall{(i,v)},\, \mbox{\small$i\neq v$} 
   \label{eq:Diffiv}
\end{equation}

De modo similar ao que foi feito para controlar o grau lógico de entrada, mas desta vez fixando a origem $i$, a equação \ref{eq:Diffiv} é equivalente à
Restrição \ref{cases:rest:Ml}. Ela representa a soma $LL_{iv}^w$ em relação à $w$, ou seja, as ligações lógicas entre o par $(i,v)$ em todos os
planos lógicos. Para que não haja multiplicidade nas ligações lógicas, basta fazer $Ml=1$. Analogamente, a Restrição \ref{cases:rest:PMl} apenas limita
$LL_{iv}^w$, controlando a multiplicidade de ligações em cada plano lógico.

\begin{figure}[htb]
	\centering
	\includegraphics[bb=110 613 432 747,scale=0.7]{./figs/B_GL_Multi.eps}
	% B_GL_Multi.eps: 0x0 pixel, 300dpi, 0.00x0.00 cm, bb=110 613 432 747
	\caption{Exemplo com Grau Lógico de Entrada e Saída iguais.}
	\label{fig:B_GL}
\end{figure}

Na Figura \ref{fig:B_GL} está um exemplo onde o nó $v$ tem grau lógico de entrada e saída iguais a $2$. Dentre os componentes que partem de $v$, um deles
compõe uma ligação lógica iniciada em $i_2$, que não está representado na figura, bem como o destino desta ligação, que passa transparentemente por $v$.
Apenas um componente com valor $2$ inicia ligações lógicas em $v$, por isso $Gout_v = 2$. Por sua vez, $2$ componentes incidem em $v$ trasportando
ligações lógicas iniciadas em $i_1$ e $i_2$, cuja soma é $3$, mas como uma passa transparentemente vindo de $i_2$, então $Gin_v = 2$. Os componentes que
incidem em $v$ pertencem a dois planos lógicos ($w_1$ e $w_2$), assim como os que nele se iniciam. Mas $v$ possui duas ligações lógicas de entrada em planos
distintos, e as de saída todas no plano $w_1$. Ainda nesta figura, a multiplicidade de ligações lógicas  ($Ml$) entre o par $(i_1,v)$ é $1$, e entre o par
$(i_2,v)$ também. Consequentemente, a multiplicidade por plano desses pares ($PMl$) também é $1$

\section{Minimização do Congestionamento}
\label{Cong}

O caso de uso apresentado nesta seção, mostra que é possível minimizar diretamente o congestionamento nesta modelagem, pois 
esta é uma bem conhecida métrica para o VTD. Todavia, uma abordagem mais eficiente é a simples limitação do congestionamento, 
minimizando outra métrica, de modo a deixar o modelo mais tratável \cite{Renato06}, como foi usado na forma básica do modelo 
TWA.

\subsection{Mantendo a Multiplicidade de Ligações Lógicas}
\label{cap:cases-sec:CongMulti}

Como foi comentado na Seção \ref{Basic}, a multiplicidade das ligações lógicas fica implícita nas variáveis de 
distribuição de tráfego ($q_{sw}^{ij}$). Deste modo, não é possível minimizar diretamente o tráfego em cada ligação lógica, o congestionamento. Para
minimizá-lo mantendo esta multiplicidade, são necessárias novas variáveis para contabilizar o tráfego em cada canal. 
Para enumerar as ligações lógicas
entre um par $(i,j)$ são definidos a seguir o índice $r$ e as variáveis de fração de tráfego $f_{ij}^r$ e ligação lógica $F_{ij}^r$.

\begin{notation}
O índice $r\in\{1,\cdots,CapLog_{ij}\}$ enumera os possíveis múltiplos canais lógicos entre par o $(i,j)$, onde $CapLog_{ij}$ 
é o menor valor entre $Gout_i$ e $Gin_j$. 
\label{indice:r}
\end{notation}

% \zz
\begin{var}
Fração de Tráfego $=$ $f_{ij}^r \in [0,1]$: variável contínua.
 \label{f}
\end{var}

% \zz
\begin{var}
Ligação Lógica $=$ $F_{ij}^r \in \{0,1\}$: variável binária.
 \label{F}
\end{var}

% \zz
\begin{var}
 \label{FmaxVar}
$F_{max}$ $=$ Congestionamento, fração de tráfego na ligação lógica mais carregada da rede.
\end{var}

A aqui optou-se por limitar o índice $r$ em função do grau lógico, pois este é um controle comum nos trabalhos que tratam do congestionamento
\cite{Sivarajan01, ram02}. Consequentemente, para controlar o grau
lógico, também serão necessárias as Restrições \ref{cases:rest:GLin} e \ref{cases:rest:GLout} da seção anterior. O congestionamento é definido na variável
$F_{max}$ (Variável \ref{FmaxVar}). Supondo que $Gout_v = Gin_v = G$ para todo $v$, ou seja, a rede possui grau lógico uniforme, o número de variáveis
binárias adicionadas ao modelo seria $N^2\cdot G$, idem para variáveis contínuas. Supondo ainda que $G < N$, o que é bem razoável, não haveria alteração
no número de variáveis do modelo básico, assintoticamente.

Todavia, no lugar do grau lógico, outro controle poderia ser usado se for conveniente, como a multiplicidade de
ligações lógicas ($Ml$), definida na seção anterior. Mas deve-se tomar cuidado nessa escolha, pois o controle usado influencia diretamente na quantidade e
variáveis que serão adicionadas ao modelo, podendo ultrapassar a ordem de grandeza do número de variáveis na forma básica do TWA.

A seguir estão relacionadas as restrições necessárias para o controle do congestionamento, que é feito pela Função Objetivo abaixo:

\textbf{Função Objetivo}

\begin{itemize}

\item Minimizar o Congestionamento

\begin{equation} 
     F_{max}
\label{cases:fo:Hmax}
\end{equation}

\end{itemize}

\textbf{Restrições}

\begin{itemize}
	\item Ligações Lógicas

\begin{equation}
 \sum_{wm} B_{iw}^{mv} - \sum_{wn} B_{iw}^{vn} = \sum_r F_{iv}^r\Forall{(i,v)} \text{, com } i\neq v.
\label{cases:rest:Hmax_Log}
\end{equation}

	\item Controle do Tráfego em cada Ligação Lógica

\begin{equation}
F_{ij}^r \geqslant f_{ij}^r \Forall{(i,j,r)}.
\label{cases:rest:Hmax_Flow}
\end{equation}

\begin{equation}
\sum_{sw} q_{sw}^{ij}\cdot A_s = Cap\cdot \left(\sum_r f_{ij}^r \right) \Forall{(i,j)}.
\label{cases:rest:Hmax_Eq_Flow}
\end{equation}

	\item Congestionamento

\begin{equation}
F_{max} \geqslant f_{ij}^r\Forall{(i,j,r)}.
\label{cases:rest:Hmax}
\end{equation}

\end{itemize}

A Restrição \ref{cases:rest:Hmax_Log} determina as ligações lógicas $F_{ij}^r$ em termos dos componentes topológicos. Semelhante à Restrição
\ref{cases:rest:Ml} da seção anterior, que limita a multiplicidade de ligações lógicas entre o pares $(i,v)$, a Restrição \ref{cases:rest:Hmax_Log} iguala
esse valor à soma das variáveis binárias $F_{ij}^r$ associadas a esse par. Deste modo haverá $F_{ij}^r \neq 0$ em quantidade igual a multiplicidade de
ligações entre o par $(i,v)$. Assim, a Restrição \ref{cases:rest:Hmax_Log} é equivalente à equação \ref{eq:DiffivLog}. A forma desta equação é uma maneira
conhecida de se associar números inteiros à variáveis binárias \cite{cormen02}.

\begin{equation}
  \sum_{w}LL_{iv}^w = \sum_r F_{iv}^r \Forall{(i,v)},\, \mbox{\small$i\neq v$} 
   \label{eq:DiffivLog}
\end{equation}


A fração de tráfego $f_{ij}^r$ (Variável \ref{f}) é semelhante a Variável \ref{FlowVar} (fração de fluxo - $q_{sw}^{ij}$), com a diferença 
de que a Variável \ref{f} separa o fluxo por canal, e a outra considerava todos como um único caminho.
Para associar tráfego às ligações lógicas, a Restrição \ref{cases:rest:Hmax_Flow} define a fração do tráfego em cada ligação, limitada pela
existência do canal. Se não não há uma ligação associada a um determinado índice $r$, não haverá tráfego nessa ligação.

A Restrição \ref{cases:rest:Hmax_Eq_Flow}, em conjunto com a a restrição de limitação de capacidade do modelo básico do TWA
(Restrição \ref{rest:DefCapFlow}), garante equivalência entre o tráfego que é alocado nas variáveis $q_{sw}^{ij}$ e o é que distribuído nas variáveis
$f_{ij}^r$. A Restrição \ref{rest:DefCapFlow} é repetida na equação \ref{eq:DefCapFlowBasic} para facilitar a compreeção desse relacionamento. As variáveis
$q_{sw}^{ij}$ é quem de fato fazem o roteamento do tráfego pela rede, levando as demandas de tráfego da origem até seu destino. As variáveis $f_{ij}^r$
apenas separam o tráfego nas múltiplas ligações lógicas entre o par $(i,j)$, sem informação sobre origem ou destino. Essa função não é exercida pelas
variáveis $q_{sw}^{ij}$, mas é indispensável para o controle do congestionamento. A Restrição \ref{cases:rest:Hmax_Eq_Flow} apenas garante que todo o
tráfego roteado pela rede foi distribuído nas ligações lógicas independentemente, e vice-verça.

Como a variável $f_{ij}^r$ é limitada pela existência da ligação lógica $F_{iv}^r$ na Restrição \ref{cases:rest:Hmax_Flow}, o tráfego separado nas ligações
lógicas entre o par $(i,v)$ também é limitado pela multiplicidade de ligações entre esse par. Isso é mostrado na equação \ref{eq:DiffivLogM}. Portanto,
esse tráfego também é limitado pela capacidade combinada dessas ligações, como mostra a equação \ref{eq:DiffivLogCap}, cujo lado direito da desigualdade é
igual ao da Restrição de limitação de capacidade do modelo básico do TWA (Restrição \ref{rest:DefCapFlow}).

\begin{equation}
\sum_{s} q_{sw}^{iv}\cdot A_s \leqslant Cap\cdot \left(\sum_{m} B_{iw}^{mv} - \sum_{n} B_{iw}^{vn}\right) \Forall{(i,v,w)} \mbox{, com $i\neq v$}
\label{eq:DefCapFlowBasic}
\end{equation} 
 
\begin{equation}
  \sum_{w}LL_{iv}^w \geqslant \sum_r f_{iv}^r \Forall{(i,v)},\, \mbox{\small$i\neq v$} 
   \label{eq:DiffivLogM}
\end{equation}
 
\begin{equation}
Cap\cdot \left(\sum_r f_{ij}^r \right) \leqslant Cap\cdot \left(\sum_{w}LL_{iv}^w \right) \Forall{(i,v)},\, \mbox{\small$i\neq v$} 
   \label{eq:DiffivLogCap}
\end{equation}

Por fim, o congestionamento ($F_{max}$) é definido na Restrição \ref{cases:rest:Hmax} em termos das frações de tráfego $f_{iv}^r$,
como o tráfego na ligação lógica mais carregada. Deste modo, a Função Objetivo \ref{cases:fo:Hmax} agora consiste em minimizar $F_{max}$, substituindo a
função objetivo do modelo básico. 

\subsection{Perdendo Multiplicidade de Ligações Lógicas}

Uma forma alternativa, e bem mais simples, para se minimizar diretamente o congestionamento é adotando a Restrição
\ref{cases:rest:Ml}, de controle da multiplicidade de ligações, com $Ml=1$. Todavia, perde-se assim a capacidade de se obter
soluções com ligações lógicas múltiplas. 
Mas, a vantagem é que pode-se minimizar o congestionamento adotando apenas a Restrição \ref{Hmax} a seguir, além da Variável \ref{FmaxVar} e a Função
Objetivo
\ref{cases:fo:Hmax}, definidas acima.

A Restrição \ref{Hmax} define o congestionamento da mesma forma que a restrição \ref{cases:rest:Hmax} o fez acima. Mas desta vez isto é feito diretamente
sobre as frações de fluxo $q_{sw}^{ij}$, somando todo o tráfego passando pela ligação lógica $(i,j)$, onde agora não há multiplicidade. Deste modo, o
tráfego em cada $(i,j)$ estará apenas em um plano lógico.

\textbf{Restrição}
\begin{itemize}
 \item Congestionamento:
\begin{equation}
F_{max} \geqslant \sum_{sw} q_{sw}^{ij}\cdot A_s \Forall{(i,j)}
\label{Hmax} 
\end{equation}
\end{itemize}

Uma terceira forma para se poder controlar diretamente o congestionamento é adotando a Restrição
\ref{cases:rest:PMl}, de controle da multiplicidade de ligações por plano lógico, com $PMl=1$. Deste modo perde-se apenas a multiplicidade de ligações em
cada plano, mas ainda pode haver $W$ ligações múltiplas para cada par $(i,j)$. Assim, pode-se minimizar o congestionamento adotando apenas a Restrição
\ref{HmaxW} a seguir, além da Variável \ref{FmaxVar} e a Função
Objetivo
\ref{cases:fo:Hmax}, definidas acima. 

\textbf{Restrição}

\begin{itemize}

 \item Congestionamento:

\begin{equation}
F_{max} \geqslant \sum_{s} q_{sw}^{ij}\cdot A_s \Forall{(i,j,w)}
\label{HmaxW} 
\end{equation}

\end{itemize}

A Restrição \ref{HmaxW} define o congestionamento da mesma forma que a restrição \ref{Hmax} o fez. Mas desta vez, o tráfego é separado por comprimento de
onda, como na Restrição \ref{rest:DefCapFlow} de limitação de capacidade no modelo básico. Deste modo, o tráfego em cada $(i,j)$ poderá estar em
todos os planos lógicos, mas sem multiplicidade em cada um.

\section{Máximo de Rotas em cada Ligação Física}
\label{LimW}

Um controle muito usado nas modelagens de RWA  \cite{Zang00,Jaumard04}, é o número máximo de 
ligações lógicas passando por cada ligação física ($L$ - Variável \ref{LimWd}). Ele limita a densidade da multiplexação de
comprimentos de onda por ligação física, um importante aspecto de Redes Ópticas WDM \cite{ramamurthy99}. Portanto, $L \leqslant W$, pois cada ligação
lógica corresponde a um comprimento de onda em uma ligação física.

A variável $L$ pode ser minimizada diretamente na
Função Objetivo \ref{cases:fo:L} ou, caso seja fixada, ela pode ser usada como limite superior em cada ligação física. Neste caso, se não há multiplicidade
de ligações na topopologia física, a limitação do número de ligações é feita pela Restrição \ref{L}. Caso contrário, a Restrição \ref{Lm} pode ser usada,
mas essa limitação não afetará cada ligação física independentemente, pois será apenas uma limitação da capacidade combinada das múltiplas ligações físicas
entre o par
$m,n$. 

Estas restrições limitam  indiretamente a capacidade dos nós realizarem ligações lógicas. Pois, dentre as ligações lógicas que chegam por uma ligação física
de entrada, por exemplo, uma parte irá passar transparentemente. Então, a quantidade de ligações lógicas incidentes por esta fibra também está limitada por
$L$. Analogamente, isso se estende para todas as ligações físicas de entrada e saída.


% \zz
\begin{var}
 \label{LimWd}
$L$ $=$ Número máximo de ligações lógicas em cada ligação física, $L \leqslant W$.
\end{var}

\textbf{Função Objetivo}

\begin{itemize}

\item Minimizar o Máximo de Ligações Lógicas em Cada Ligação Física

\begin{equation} 
     L
\label{cases:fo:L}
\end{equation}

\end{itemize}

\textbf{Restrição}

\begin{itemize}

 \item Ligações Lógicas em Cada Ligação Física:

\begin{equation}
 \label{L}
\sum_{iw} B_{iw}^{mn}\leqslant L \Forall{(m,n)} \mbox{,  com } K=1
\end{equation}

\begin{equation}
 \label{Lm}
\sum_{iw} B_{iw}^{mn}\leqslant L\cdot D_{mn} \Forall{(m,n)}
\end{equation}

\end{itemize}


\section{Número de Saltos Físicos}
\label{cap:cases-sec:LimB}

Uma métrica importante para o projeto de redes ópticas é o número de saltos físicos da topologia \cite{Zang00}. Este valor 
é minimizado na Função Objetivo \ref{cases:fo:B}, através da soma de todos os componentes topológicos, pois cada componente 
topológico representa um salto físico. Uma propriedade importante desta abordagem é que ela evita o aparecimento de 
ciclos na topologia. O ideal seria minimizar a distância percorrida por cada ligação lógica, o que promoveria um controle mais eficiente da degradação do
sinal óptico.
Minimizar o número total de saltos pode ser adotado por uma questão de compatibilidade com outros modelos, como os resultados encontrados em
\cite{Karcius04}, que
serão usados na comparação dos experimentos computacionais do Capítulo \ref{cap:testes-sec:CompKarcius}.

\textbf{Função Objetivo}

\begin{itemize}

\item Minimizar o Número de Saltos Físicos

\begin{equation} 
     \sum_{imnw} B_{iw}^{mn} = S
\label{cases:fo:B}
\end{equation}

\end{itemize}

% % % As variáveis de fração de fluxo agregado, definidas no modelo básico, são suficientes para modelar a distribuição do tráfego, embora na implementação
% real % de
% % % múltiplas rotas físicas entre um mesmo par de nós $(i,j)$, alguns detalhes ainda carecem ser decididos, pois podem haver mais de uma maneira de
% % configura-los. Um
% % % exemplo disso é dado na Figura \ref{fig:Unsolved}, onde o conjunto de componentes topológicos dado permite duas possibilidades de 
% % % configuração dos percursos lógicos. É garantida implicitamente a alocação de recursos suficientes, mas este sub-problema fica sem ser resolvido pelo
% % modelo. 
% % % Por essa razão, não é possível controlar a real distância percorrida pelas demandas de tráfego, sendo este um prejuízo da
% % % modelagem TWA.
% % % 
% % % Essas situações podem ser tratadas considerando outros fatores, como a distância entre os 
% % % nós. Mas são questões de menor complexidade, se a topologia já estiver decidida, e podem ser resolvidas na fase 
% % % de configuração da rede. Isso não influencia na modelagem dos recursos da rede e portanto não será tratado aqui.
% % % 
% % % \begin{figure}[htb]
% % %  \centering
% % %  \includegraphics[bb=71 267 541 759, scale=0.8]{figs/unsolved.eps}
% % %  % unsolved.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=70 210 533 771
% % %  \caption{Em $b)$ vemos duas possíveis de interpretações dos componentes topológicos em $a)$.}
% % %  \label{fig:Unsolved}
% % % \end{figure}


\section{Minimização do Número de Comprimentos de Onda}
\label{CtrlW}

Um objetivo comum nas modelagens do RWA é minimizar o número de comprimentos de onda utilizados na rede \cite{Zang00, 
Jaumard04}. Esse número, na forma básica do TWA, é um dos dados que definem uma instância do modelo, deixando uma quantidade $W$ de comprimentos de onda
disponíveis para serem usados. Nesta seção é introduzida a possibilidade de minimizar diretamente a quantidade que será utilizada. 

Abaixo estão as definições necessárias para o controle do número de comprimentos de onda e a Restrição \ref{cases:rest:Qw}, que deve ser adicionada ao
modelo básico para esse fim. A seguir, na Subseção \ref{CtrlWfis}, está uma adaptação da Restrição \ref{cases:rest:Qw} para o caso da topologia física ser
um dos dados de entrada do problema.

Mais uma vez, isso é feito para oferecer compatibilidade com outras modelagens da literatura \cite{Zang00}. Todavia, uma abordagem
diferente foi utilizada para o mesmo objetivo
nos experimentos computacionais do Capítulo \ref{cap:testes}.

\begin{var}
 \label{Cw}
Seja $Q_w\in\{0,1\}$, com $w \in \{1,..,W\}$. $Q_w = 1$ se o comprimento de onda $w$ é utilizado na rede e $Q_w = 0$ caso contrário.
\end{var}

\textbf{Função Objetivo}

\begin{itemize}

\item Minimizar o Número de Comprimentos de Onda:

\begin{equation} 
     \sum_w Q_w
\label{cases:fo:W}
\end{equation}

\end{itemize}

\textbf{Restrição}

\begin{itemize}

 \item Número de Comprimentos de Onda:

\begin{equation}
 \label{cases:rest:Qw} 
\sum_{vn} B_{vw}^{vn} \leqslant K\cdot (N^2 - N)\cdot Q_w \Forall{w}.
\end{equation}

\end{itemize}

Se em um plano lógico $w$ há uma rota física ou mais. Cada uma destas é facilmente associada ao primeiro componente
em seu percurso, dada a agregação utilizada no roteamento dos comprimentos de onda. Uma ligação lógica neste plano, iniciada em $v$, está
associada a um componente da forma $B_{vw}^{vn}$, para algum $n$. Ou seja, se algum desses componentes for não nulo, então o comprimento de onda $w$ foi
utilizado. Isso pode ser determinado pela soma desses componentes, como está expresso na equação \ref{eq:QwEQ}. 

\begin{equation}
	\sum_{vn} B_{vw}^{vn} \neq 0 \Longleftrightarrow Q_w = 1
	\label{eq:QwEQ}
\end{equation}

Para descrever essa situação na forma de uma
restrição linear, é necessário apenas garantir que $Q_w = 1$ quando $w$ for utilizado. Pois, como $Q_w$ será minimizado, casos em que $Q_w = 1$, sem nada
que o exija na modelagem, serão evitados pela função objetivo. Assim, é necessário modelar apenas a equação \ref{eq:QwVolta}. Isso é feito com uma
equação da forma \ref{eq:Qw}, onde $H$ pode ser qualquer fator positivo, que seja sempre maior ou igual ao somatório à esquerda da desigualdade. Um valor
mais adequado para o fator $H$ é o número máximo que o somatório pode assumir. Esse valor é $K\cdot (N^2 - N)$, pois existem $N^2 - N$ combinações
possíveis para o par $(v,n)$, e cada uma pode estar associada à $K$ ligações físicas paralelas. Em fim, substituindo $H$ na equação \ref{eq:Qw} chagamos à
Restrição \ref{cases:rest:Qw}.

\begin{equation}
	\sum_{vn} B_{vw}^{vn} \neq 0 \Longrightarrow Q_w = 1
	\label{eq:QwVolta}
\end{equation}

\begin{equation}
 \label{eq:Qw} 
\sum_{vn} B_{vw}^{vn} \leqslant H\cdot Q_w \Forall{w}.
\end{equation}

Para minimizar diretamente o número de comprimentos de onda utilizados na rede, basta usar a soma de todas as 
variáveis $Q_w$ (Variável \ref{Cw}) na Função Objetivo \ref{cases:fo:W}.

\subsection{Topologia Física Fixa}
\label{CtrlWfis}

Se a topologia física é fixa, há uma forma alternativa para se modelar
$Q_w$, que reaproveita uma das restrições do modelo TWA. Assim, evita-se acrescentar a Restrição \ref{cases:rest:Qw} ao modelo, deixando-o mais conciso. Se
a
variável de topologia física $D_{mn}$ (Seção \ref{cap:twa-sec:VarFis}) for fixada, podemos multiplicá-la por $Q_w$ na Restrição \ref{rest:DefFis} do modelo
básico, sem prejudicar a função original da restrição, e obter o mesmo efeito da Restrição \ref{cases:rest:Qw}. Com a diferença que agora está separada por
par $(m,n)$ e o fator $H$ foi substituído por $D_{mn}$. Deste modo, se a topologia física é um dado de entrada, a Restrição \ref{cases:rest:FisQw} deve
substituir a equação \ref{rest:DefFis} do modelo original, e a Restrição \ref{cases:rest:Qw} não será necessária.

\textbf{Restrição}

\begin{itemize}

 \item Número de Comprimentos de Onda:

\begin{equation}
\sum_i B_{iw}^{mn} \leqslant Q_w\cdot D_{mn}\Forall{(m,n,w)}.
\label{cases:rest:FisQw}
\end{equation} 

\end{itemize}


\section{Conversão entre Comprimentos de Onda}
\label{Conv}

Outro cenário comum nas modelagens para o RWA é a possibilidade de conversão do comprimento de onda ao longo da rota física. Há 
duas formas mais comuns de se tratar essa abordagem: ou um nó possui capacidade total de conversão \cite{Zang00, Jaumard04, Tornatore07} e todas 
as ligações lógicas passando por ele podem mudar de comprimento de onda; ou há uma quantidade limitada de conversões \cite{ram98, 
Karcius04}. O primeiro método é apenas um caso particular do segundo, mas será tratado aqui um caso mais geral, em que cada nó pode fazer uma
quantidade variável de conversões. Deste modo, será oferecida a possibilidade de controlar o número de conversões realizadas no projeto.

 A conversão entre comprimentos de onda também será feita de modo agregado, mas neste caso não será em relação à origem. As conversões serão agregadas
com relação ao comprimento de onda de destino na conversão. 

Na separação da topologia lógica por comprimento de onda, introduzida na Seção
\ref{cap:twa-sec:planos}, se uma rota física, que se iniciou em um plano $w_1$, for convertida para um comprimento de onda $w_2$ em um nó intermediário $v$,
seu percurso nesse plano será interrompido em $v$, continuando a partir dele no plano $w_2$. Todavia, da forma como será modelado, se uma rota sofrer
conversão entre comprimentos de onda, não será conhecido explicitamente em qual plano essa rota iniciou seu trajeto, pois será controlado apenas quantas
conversões cada plano lógico está recebendo. As restrições propostas é que deverão garantir que haja tal conservação do trajeto entre os planos. Portanto,
não será modelada a conversão diretamente, mas apenas o desvio da rota e a conservação dos percursos. Como cada desvio corresponde univocamente a uma
conversão entre comprimentos de onda, o número de desvios equivale a quantidade de conversões. 

No Conjunto de Dados \ref{dados:desvios} são definidas as
limitações que serão impostas às conversões, e na Variável \ref{x}, é definida a forma como serão registrados os desvios. Em seguida essas definições serão
justificadas. Depois são apresentadas as restrições que modelam as conversões.

\begin{dados}
Constantes adicionais:
\begin{itemize}

\item $TCON_v$ $=$ Máximo de conversões que podem ocorrer em $v$.

\item $CON_v$ $=$ Máximo de conversões que podem ocorrer em $v$ para um mesmo comprimento de onda. Se topologia física $D_{mn}$ é um dos dados de
entrada do problema, $CON_{v} \leqslant \sum_n D_{vn}$. Além disso, $CON_{v}$ não pode ultrapassar $TCON_v$.

\end{itemize}
\label{dados:desvios}
\end{dados}

\begin{var}
 \label{x}
Em um nó intermediário $v$, o número de rotas iniciadas em $i$ que são desviadas para o plano $w$ é $x_{iv}^w \in \{0, \cdots, CON_{v}\}$, com $i\neq v$. 
\end{var}

\begin{figure}[htb]
	\centering
	\includegraphics[bb=0 0 317 464,scale=0.7]{./figs/desvios.eps}
	% desvios.eps: 0x0 pixel, 300dpi, 0.00x0.00 cm, bb=0 0 596 843
	\caption{Possibilidades de desviar uma Rota}
	\label{fig:desvios}
\end{figure}

Em cada ligação física só pode passar uma ligação lógica utilizando cada comprimento de onda. Assim, em um nó $v$, o número de rotas que são desviadas
para o plano $w$ é limitado pela quantidade de ligações físicas saindo de $v$. Esse limite é chamado de grau físico de saída de $v$ ($GFout_v$), e definie
o escopo da Variável \ref{x} ($x_{iv}^w$). Ela guarda o número de desvios em $v$ destinados ao plano $w$, das rotas com origem $i$. Na Figura
\ref{fig:desvios} há uma representação gráfica de duas possibilidades para a configuração de uma conversão.

Como $x_{iv}^w$ é uma
variável inteira, para não prejudicar a eficiência do modelo, convém adotar um valor tão pequeno quanto possível para seu domínio. Pois quanto maior o
domínio de uma variável inteira, maior será o número de variáveis binárias associadas a ela. Por esse motivo, ao invés de definir o domínio de $x_{iv}^w$
pelo seu limite natural ($GFout_v$), adotou-se a constante $CON_v$, que pode ser menor que $GFout_v$. Se não for limitado, o limite teórico para $GFout_v$
é $K\cdot(N-1)$, o número de nós que podem ser destino de ligações físicas saindo de $v$ multiplicado pela multiplicidade física máxima $K$.

\textbf{Restrições}
\begin{itemize}

\item Continuidade e Desvio de Comprimentos de Onda:
\begin{equation}
 \label{cases:rest:Desvios}
 \sum_{m} B_{iw}^{mv} \geqslant \sum_{n} B_{iw}^{vn}  - x_{iv}^w \Forall{(i,v,w)}\text{, com } i\neq v
\end{equation}

\item Conservação Geral das Rotas Físicas e Tráfego:
\begin{equation}
 \label{cases:rest:ConservBgeral}
 \sum_{sw} q_{sw}^{iv}\cdot A_s \leqslant Cap\cdot\left( \sum_{mw} B_{iw}^{mv} - \sum_{nw} B_{iw}^{vn} \right) \Forall{(i,v)}\text{, com } i\neq v
\end{equation}

\item Controle das Conversões:
\begin{equation}
 \label{cases:rest:CtrlX}
\sum_i x_{iv}^w \leqslant \sum_n D_{vn}\Forall{(v,w)}
\end{equation}

\item Limitação das Conversões:
\begin{equation}
 \label{cases:rest:LimX}
\sum_{iw} x_{iv}^w \leqslant TCON_v \Forall{v}
\end{equation}

\begin{equation}
 \label{cases:rest:LimXw}
\sum_i x_{iv}^w \leqslant CON_v \Forall{(v,w)}
\end{equation}

\end{itemize}

A Restrição \ref{rest:DefCapFlow} do modelo básico é substituída, pelas restrições \ref{cases:rest:Desvios} e \ref{cases:rest:ConservBgeral} acima.
Dentre estas
duas, a primeira assume a função de conservação dos comprimentos de onda ao longo das rotas, além de controlar os desvios de plano, que correspondem às
conversões de comprimento de onda. A segunda assume as funções de conservação geral das rotas entre os pares $(i,v)$ e limitação da capacidade de tráfego. 

A restrição \ref{cases:rest:CtrlX} limita o número de desvios pelo que a topologia física é capaz de prover. Mas, como será visto a seguir, esta restrição
só é necessária quando a topologia física é variável. Pois se ela for fixa, a Restrição \ref{cases:rest:CtrlX} é satisfeita pela Restrição
\ref{cases:rest:LimXw}. As Restrições \ref{cases:rest:LimX} e \ref{cases:rest:LimXw} aplicam os limites $TCON_v$ e $CON_v$, sendo ambas opcionais;
dispensáveis à modelagem, se a topologia física é livre. Por exemplo, elas poderiam ser substituídas pela adição da soma de todas as conversões na função
objetivo do modelo básico. Pois a
quantidade de conversões também influencia no dimensionamento dos nós.

Como pode haver mais de uma maneira de se configurar as rotas físicas no TWA, analogamente, o mesmo se aplica às conversões. Mas isso também pode ser
decidido em fases posteriores do projeto, levando em consideração outros fatores, como a distância percorrida ou o fator BL. 

Quando a topologia física é variável, se não for necessário usar o controle provido por $CON_v$, a Restrição \ref{cases:rest:LimXw} pode ser omitida. Apesar
de $CON_v$ ser o limite de cada variável $x_{iv}^w$, esse limite é compartilhado por todas as rotas desviadas para $w$ em $v$, independente da origem
$i$. Por isso, a Restrição
\ref{cases:rest:LimXw}, agregando $x_{iv}^w$ pela origem $i$, atuaria apenas como um plano de corte para as variáveis $x_{iv}^w$. 

Na Restrição \ref{cases:rest:CtrlX}, o lado esquerdo da desigualdade é o mesmo da Restrição \ref{cases:rest:LimXw}, e o direito equivale à $GFout_v$.
Portanto sua função é fazer valer $GFout_v$, pois seria razoável permitir que ele pudesse ser menor que $CON_v$ em alguns nós. Pois $CON_v$ pode ser
definido com um valor uniforme para toda a rede. Mas se a topologia física for fixa, $GFout_v$ já é determinado ($GFout_v = \sum_n D_{vn}$). Portanto a
restrição \ref{cases:rest:CtrlX} é satisfeita pela Restrição \ref{cases:rest:LimXw}, que a substitui. Neste caso, a Restrição \ref{cases:rest:LimXw}
torna-se obrigatória.

Por sua vez, a Restrição \ref{cases:rest:LimX} controla o total de conversões em cada nó, independentemente. Ela não é necessária à modelagem, mas oferecer
o controle provido por ela é o objetivo desta seção.

Na Figura
\ref{fig:B_Desvios} está uma situação onde ocorre uma conversão. Pois o valor do componente topológico que deixa o nó $v$, roteando duas ligações lógicas
com origem em $i$, supera o valor dos componentes incidentes em $v$, com origem $i$ e o mesmo comprimento de onda $w_2$. Adicionalmente, há duas liga
lógicas também iniciadas em $i$, chegando em $v$ com comprimento de onda $w_1$, mas nenhuma seguindo adiante. Portanto, uma ligação
lógica chegando em $v$ pelo plano $w_1$ é convertida, seguindo seu percurso no plano $w_2$.

\begin{figure}[htb]
	\centering
	\includegraphics[bb=0 0 320 142,scale=0.7]{./figs/B_Desvios.eps}
	% B_Desvios.eps: 0x0 pixel, 300dpi, 0.00x0.00 cm, bb=0 0 320 142
	\caption{Continuidade das Rotas com Desvio}
	\label{fig:B_Desvios}
\end{figure}

Nesse exemplo, não há conservação das rotas físicas por comprimento de onda, pois não satisfaz a equação \ref{eq:ConserB} (repetida na equação
\ref{eq:ConserBDesvios}), cuja validade foi mostrada na Seção \ref{cap:twa-sec:Bconserv_Cap}. Todavia, se ao invés de manter a conservação separada nos
planos lógicos, essa equação fosse agregada para todos os valores de $w$, a conservação dos percursos com origem em $i$ estaria mantida, ignorando a
conservação dos comprimentos de onda. Essa forma agregada da conservação dos percursos é feita pela equação \ref{eq:ConserBGeral}, e permite que
qualquer rota física mude livremente de comprimento de onda ao longo do percurso. 


\begin{equation}
   \sum_{n} B_{iw}^{vn} \leqslant \sum_{m} B_{iw}^{mv}  \Forall{(i,v,w)}
   \label{eq:ConserBDesvios}
\end{equation}

\begin{equation}
   \sum_{nw} B_{iw}^{vn} \leqslant \sum_{mw} B_{iw}^{mv}  \Forall{(i,v)}
   \label{eq:ConserBGeral}
\end{equation}

Se o objetivo fosse dotar todos os nós com capacidade total de conversão, a equação \ref{eq:ConserBGeral} cumpriria esse papel, mas também seria necessário
agregar por comprimento de onda a Restrição \ref{rest:DefCapFlow} do modelo básico, para reunir o tráfego que é separado nos planos lógicos. A Restrição
\ref{cases:rest:ConservBgeral} corresponde a Restrição \ref{rest:DefCapFlow} agregada por comprimento de onda, assumindo suas funções, exceto no que diz
respeito a conservação do comprimento de onda ao longo da rota física. A Restrição \ref{cases:rest:ConservBgeral} substitui a versão do modelo básico, mas
exige que outra restrição cuide da conservação dos comprimentos de onda. O que é feito pela Restrição \ref{cases:rest:Desvios}. 

Com o tráfego agregado por
comprimento de onda, o fator $LL_{iv}^w$ (Seção \ref{cap:twa-sec:Bconserv_Cap}) perde seu significado. Agora só importa o número de ligações lógicas
entre o par $(i,v)$ considerando todos os comprimentos de onda. Pois a conservação dos percursos não é mais separada por plano lógico.

Voltando à equação \ref{eq:ConserBDesvios}, como foi comentado acima, ela pode não ser válida se ocorrerem desvios de plano em $v$. Portanto, é preciso
corrigi-la, pois ainda é necessário que haja conservação dos comprimentos de onda nas rotas que não são desviadas. Isso é feito retirando de
\ref{eq:ConserBDesvios} os componentes em excesso, partindo de $v$ . A soma dos componentes a serem retirados é igual ao número de desvios em $v$ para o
plano $w$, de rotas originadas em $i$, ou seja, exatamente $x_{iv}^w$. Para cancelar esses componentes em \ref{eq:ConserBDesvios}, basta subtrair
$x_{iv}^w$ no lado esquerdo da desigualdade, o que equivale a Restrição \ref{cases:rest:Desvios}. 




