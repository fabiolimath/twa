
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Modelagem TWA
%% Copyright 2009 Fabio de Oliveira Lima.
%% Este documento é distribuído nos termos da licença 
%% GNU General Public License v2.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Modelagem TWA}
\label{Basic}

Neste capítulo será apresentada a forma básica do modelo TWA, começando pela notação designada aos nós e as constantes que definem uma instância de
problema para o modelo. Em seguida serão definidas as variáveis utilizadas para compor as restrições e a função objetivo do modelo, passando-se
então à sua descrição. A função objetivo adotada na formulação básica é a minimização dos custos de instalação e operação da rede, valendo-se da capacidade do
modelo escolher também a topologia física da rede. Além disso, o número de comprimentos de onda foi controlado de maneira implícita \cite{Zang00}; e foi
considerada a restrição de conservação dos comprimentos de onda ao longo do caminho óptico \cite{Zang00}, ou seja, não se admite a conversão de comprimentos de
onda na camada óptica da rede.

\begin{notation}
Os índices $m,n,s,d,i,j\in \{1,..,N\}$ representam os nós da rede, e os pares ordenados $(m,n)$, $(s,d)$ e $(i,j)$ indicam 
respectivamente ligações físicas, demandas de tráfego e ligações lógicas, com $m\neq n$, $s\neq d$ e $i\neq j$. O índice $w 
\in \{1,..,W\}$ representa os comprimentos de onda disponíveis.
\end{notation}

\begin{figure}[hb]
\centering
\includegraphics[bb=131 654 523 824,scale=.9]{figs/indices.eps}
\caption{Representação gráfica da notação associada aos nós da rede.}
\label{fig:Indices}
\end{figure}

A Figura \ref{fig:Indices} ilustra os diferentes escopos dos índices associados aos nós da rede, com relação aos enlaces físicos $(m,n)$, lógicos
$(i,j)$ e demandas de tráfego $(s,d)$. Esta notação segue a convenção comumente utilizada em trabalhos anteriores \cite{mukherjee,ram02}. É
importante dizer que, como esta modelagem suporta múltiplas fibras e caminhos ópticos entre cada par de nós, os pares $(m,n)$ e $(s,d)$ representam
conjuntos de possíveis ligações físicas e lógicas, respectivamente. Esses conjuntos não serão explicitamente controlados, sendo esse um dos motivos
da eficiência do modelo.

\begin{dados}
\label{Cons}
Uma instância para o modelo TWA é definida por:

\begin{enumerate}
\item $N$ $=$ Número de nós da rede.
\item $W$ $=$ Máximo de comprimentos de onda por fibra.
% \item $H$ $=$ Grau físico máximo de entrada e saída de cada nó.
\item $K$ $=$ Multiplicidade física máxima entre os pares de nós.
\item $Cap$ $=$ Capacidade de tráfego de cada canal lógico.
\item $C_{mn}$ $=$ Custo de uma ligação física orientada $(m,n)$.
\item $T$ $=$ Custo por unidade de fluxo.
\item $P_{sd}$ $=$ Demanda de tráfego, com origem $s$ e destino $d$.
\item $A_s = \sum_d P_{sd}$ e $Q_{sd}=P_{sd}/A_s$.
\end{enumerate}
\end{dados}

% \clearpage

% \subsection{Topologia Generalizada}
% \label{Top}

A variável central do modelo, a partir da qual todas as demais serão definidas, chamada de \textit{componente da Topologia 
Generalizada} (ou simplesmente \textit{componente topológica}), é representada graficamente na Figura \ref{fig:B} e 
formalmente definida na Variável \ref{comp}. Ela sozinha representa as topologias lógica e física, o trajeto físico das 
ligações lógicas e o comprimento de onda utilizado.

\begin{var}
\label{comp}
 Seja $B_{iw}^{mn} = k\in \{0,..,K\}$, com $i\neq n$, uma componente do conjunto das ligações lógicas com origem $i$ e comprimento de onda $w$,
que utilizam $k$ ligações físicas entre os nós $m$ e $n$.
\end{var}

\begin{figure}[hb]
 \centering
\includegraphics[bb=36 739 246 805, scale=0.9]{figs/B.eps}
% B.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=36 739 246 805
 \caption{Representação gráfica de uma componente topológica.}
 \label{fig:B}
\end{figure}

% \begin{equation}
% s\neq j\quad \text{ e }\quad i\neq j\quad \forall (s,i,j).
% \label{Nules}
% \end{equation}

%A princípio, o número de variáveis do tipo descrito aqui seria $N^3\cdot W$, mas devemos excluir algumas que são 
% trivialmente nulas: $s\neq j$ pois $s$ é origem da ligação lógica e $j$ é destino da ligação física; e $i\neq j$ pois não são 
% aceitos \textit{autoloops} \cite{cormen02}.

Numa componente da topologia generalizada $B_{iw}^{mn} = k$, o índice $i$ representa o nó de origem das $k$ ligações lógicas 
que, passando por uma das ligações físicas iniciadas em $m$ e incidentes em $n$, usa o comprimento de onda $w$. Conforme a terminologia utilizada
neste trabalho daqui por diante, \textit{uma componente topológica $B_{iw}^{mn} = k$ é iniciada em $m$, incidente em $n$, com origem $i$,
comprimento de onda $w$ e valor $k$}.

Considerando que $B_{iw}^{mn}=k$ para algum $k \in \{0,..,K\}$, existem $k$ ligações lógicas originadas em $i$ no comprimento de onda $w$, passando
por $k$ enlaces físicos distintos entre o par de nós $(m,n)$. Neste caso, cada um desses $k$ enlaces físicos terá que ser uma fibra óptica distinta
interligando o mesmo par de nós $(m,n)$, pois haveria interferência se houvessem dois sinais ópticos originados por fluxos de tráfego diferentes se
propagando no mesmo sentido, na mesma fibra, com o mesmo comprimento de onda. Note que $K$ limita apenas a multiplicidade dos enlaces físicos, ou
seja, o número de fibras ópticas dispostas em paralelo entre dois nós $(m,n)$. Mesmo que $K=1$, o que torna $B_{iw}^{mn}$ uma variável binária, as
diversas ligações lógicas entre um par $(i,j)$ poderão usar múltiplos trajetos físicos, ou ainda, mais de um comprimento de onda em uma mesma
fibra. Se ,$\forall i$ , $k=0$ para qualquer $w$, então nenhum enlace físico entre o par de nós $(m,n)$ é utilizado, ou seja $B_{im}^{nw}=0$, $\forall (i,w)$.

 Na Figura \ref{fig:Tops}, temos um exemplo de interpretação das componentes topológicas, todas com origem no nó $i$ e com o 
mesmo comprimento de onda $w_1$. No item $d)$ desta figura, o valor $2$ da componente que liga os nós $(i,m)$ é interpretado 
como duas ligações físicas entre esses nós, representadas no item $a)$. No item $b)$, vemos uma ligação lógica dupla entre os 
nós $(i,n)$, onde uma delas passa de forma transparente pelo nó $m$, como indicado no item $c)$. Note ainda que, no item 
$d)$, há dois caminhos lógicos incidentes em $m$ mas apenas um iniciando. Isso indica que uma ligação lógica termina em $m$, 
enquanto a outra segue adiante.

% \clearpage
\begin{figure}[hbt]
 \centering
\includegraphics[width=0.8\textwidth]{figs/topologias-twa.eps}
% \includegraphics[bb=39 455 511 811, scale=0.4]{figs/topologias.eps}
 % topologias.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=30 375 511 801
 \caption{Exemplo da interpretação das componentes topológicas.}
 \label{fig:Tops}
\end{figure}
% \clearpage

A definição das componentes topológicas não deixa claro aonde terminam as ligações lógicas. Sua finalização será garantida 
implicitamente pelas restrições do modelo. Isso reflete a agregação do roteamento dos comprimentos de onda, similar a trabalhos encontradas na
literatura \cite{Jaumard04}.

A indexação atribuída às variáveis $B_{iw}^{mn}$ especificam apenas o nó $i$, que é onde se iniciam os enlaces lógicos representados. Isto
significa que estas variáveis agregam todas as ligações lógicas originadas em $i$ que utilizam o enlace físico $(m,n)$ e o comprimento de onda $w$,
independente do nó $j$ em que terminam estas ligações lógicas. Esta técnica consiste em uma abordagem bastante conhecida para a representação de
variáveis em problemas de distribuição de fluxo em redes. Em \cite{Tornatore07}, este conceito de agregação de tráfego é aplicado como meio de
simplificação do modelo, reduzindo substancialmente o número de variáveis dos problemas resultantes. No TWA, esta agregação cumpre o mesmo papel de
simplificação, cabendo às restrições do modelo garantir implicitamente a terminação correta destas ligações lógicas agregadas nas variáveis
$B_{iw}^{mn}$.

% A multiplicidade das ligações lógicas pode ser controlada por uma restrição própria, que será mostrada na Seção 
% \ref{ControlMl}.

%  Na versão mais enxuta, com a topologia física fixada (veja a Seção \ref{Fis}, adiante) do modelo é adicionada apenas a 
% variável de distribuição de fluxo agregado. Dependendo do caso de uso, outras variáveis podem ser necessárias (como será 
% visto na Seção \ref{cases}), mas nenhuma supera o número de componentes da topologia generalizada, que define portanto a 
% ordem de grandeza do número de variáveis desta modelagem.

% \subsection{Conservação do Percurso Lógico}
% \label{ConservLogS}

As Variáveis \ref{FisVar} e \ref{FlowVar} completam as definições necessárias para apresentarmos a forma básica do modelo TWA, expresso nas
Restrições de (\ref{DefCapFlow}) à (\ref{MinC}).

\begin{var}
\label{FisVar}
 Seja $D_{mn} \in \{0,..,K\}$ o número de ligações físicas entre o par de nós $(m,n)$. 
\end{var}

\begin{var}
 \label{FlowVar}
 Seja $q_{sw}^{ij} \in [0,1]$ a fração de fluxo originado em $s$, passando pelas ligações lógicas entre o par $(i,j)$, no comprimento de onda $w$,
com $s\neq j$. 
\end{var}

% \begin{equation}
%  \sum_n B_{i,n,m,w} \geq \sum_n B_{i,m,n,w} ,\quad \forall (i,m,w) \text{, com } i\neq m.
% \label{ConservLog}
% \end{equation} 

\begin{equation}
\sum_{s} q_{sw}^{ij}\cdot A_s \leqslant Cap\cdot \left(\sum_{m} B_{iw}^{mj} - \sum_{n} B_{iw}^{jn}\right) \Forall{(i,j,w)}
\label{DefCapFlow}
\end{equation} 

\begin{equation}
\sum_i B_{iw}^{mn} \leqslant D_{mn} \Forall{(m,n,w)}
\label{DefFis}
\end{equation} 
% 
% \begin{equation}
% \sum_n D_{mn} \leqslant H \Forall{m} \qquad \text{and} \qquad \sum_m D_{mn} \leqslant H \Forall{n}
% \label{ConservGFis}
% \end{equation} 
% \mathop{\mbox{$\sum$}}

\begin{equation}
\sum_{jw} q_{sw}^{sj} = 1 \Forall{s} \qquad \text{and} \qquad 
\sum_{iw} q_{sw}^{id} - \sum_{jw} q_{sw}^{dj} = Q_{sd} \Forall{(s,d)}
\label{ConservFlow}
\end{equation} 

\begin{equation}
 \text{\small Minimize:} \sum_{mn} C_{mn}\cdot D_{mn} + \sum_{sijw} T\cdot q_{sw}^{ij}\cdot A_s 
\label{MinC}
\end{equation}

A Restrição (\ref{DefCapFlow}) acumula múltiplas funções: garante a continuidade dos percursos lógicos e a conservação dos comprimentos de onda; controla a
capacidade de tráfego dos canais lógicos, que também pode ser um \textit{uper bound} para o congestionamento; e anula as frações de fluxo agregado nas ligações
lógicas não utilizadas.

Se o número de componentes topológicas incidentes em $m$ for maior que o número de iniciadas, não originadas nele, essa diferença é 
o número de ligações lógicas que terminam em $m$. É deste modo que a finalização das ligações lógicas pode ser mapeada. Isso 
assegura a rastreabilidade das ligações lógicas desde sua origem, a partir das componentes topológicas agregadas.

Para resolver o sub-problema de roteamento de tráfego, são definidas as variáveis de fração de fluxo agregado (Variável \ref{FlowVar}), utilizadas
na Restrição (\ref{DefCapFlow}). Como podem haver múltiplas ligações lógicas entre um par $(i,j)$, o tráfego 
entre um par de nós deverá ser limitado pela capacidade de uma ligação lógica multiplicada pelo número de ligações lógicas em questão. Na
Restrição \ref{DefCapFlow}, este número é representado, para as ligações lógicas entre o par $(i,j)$, como a
quantidade de componentes topológicas incidentes em $j$ ({\footnotesize$\sum_{mw}B_{iw}^{mj}$}), diminuído do número de componentes
topológicas iniciadas em $j$ ({\footnotesize$\sum_{nw}B_{iw}^{jn}$}).

Apesar da topologia física ser determinada pelas componentes da topologia generalizada, para fins de controle do custo de instalação da rede física,
é necessário novas incógnitas. Para este fim, é definida a Variável \ref{FisVar}, que registra em $D_{mn}$ a multiplicidade física alcançada pelas
componentes topológicas. Se $D_{mn}=0$, não há ligações físicas entre o 
par $(m,n)$, mas se $D_{mn}=k$, para algum $k \in \{0,..,K\}$, existem $k$ ligações físicas entre o par $(m,n)$.

Pela forma como $D_{mn}$ é calculada na Restrição \ref{FisVar}, a rigor, seu valor poderia ser maior do que é determinado pelas componentes topológicas. Mas isso
não ocorre quando o número de ligações físicas for minimizado na função objetivo.

Se $D_{mn}$ for dado de entrada do problema, a Restrição (\ref{DefFis}) limita a multiplicidade física das componentes topológicas 
$B_{im}^{nw}$. Ainda neste caso, se $D_{mn}=0$ para um certo par $(m,n)$, devem ser retiradas da modelagem as variáveis $B_{im}^{nw}$ correspondentes. Isto deve
ser considerado em todo o modelo e daqui por diante toma-se como subentendido.

% Se a topologia física é livre, a Restrição (\ref{ConservGFis}) é necessária para o controle do grau físico de 
% saída e entrada em cada nó, caso contrário esta restrição pode ser desconsiderada.

%Quando a topologia física é livre, não é controlada a existência de $D_{i,j}\neq 0$, com $B_{s,i,j,w}=0$, $\forall (s,w)$. 
% Dependendo do caso de uso, isso ou não influencia no resultado, ou pode ser controlado indiretamente pela função objetivo, 
% por exemplo, por meio do custo de instalação. Opcionalmente poderia-se usar para este fim uma restrição da forma $\sum_{s,w} 
% B_{s,i,j,w} \geq D_{i,j}$, para todo $(i,j)$, mas essa hipótese é por hora desconsiderada.

A conservação de fluxo é assegurada pela Restrição (\ref{ConservFlow}), que também garante o envio e a entrega das demandas 
de tráfego. As equações da Restrição (\ref{ConservFlow}) são semelhantes, em sua forma, às encontradas na modelagem agregada 
para o VTD \cite{ram02}. Todavia, sua interpretação é sutilmente diferente, pois aqui uma determinada fração de fluxo de tráfego pode ser
subdividida e transportada simultaneamente por mais de uma ligação lógica entre o par $(i,j)$. Por exemplo, em comprimentos de onda diferentes em um mesmo enlace
físico $(m,n)$ que interliga diretamente $(i,j)$, ou por rotas físicas disjuntas entre os nós $(i,j)$, neste último caso, independente do
comprimento de onda.

Uma métrica importante no projeto da redes ópticas é a minimização dos custos de instalação e operação \cite{mukherjee}. O 
custo de instalação $C_{mn}$ é o custo associado a uma ligação física orientada entre o par de nós $(m,n)$. O custo de 
operação $T$ é definido como o custo por unidade de fluxo($\sum_{sijw} T\cdot q_{sw}^{ij}\cdot A_s$). Este último pode ser dividido em
duas partes, uma constante ($Tc = \sum_{sd} T\cdot P_{sd}$), formada pelas demandas de tráfego (que necessariamente deverão ser roteadas), e outra variável 
($Tv = T,\, \mbox{\small$i\neq s$}$), composta pelo tráfego adicional que é gerado, ou seja, o tráfego 
retransmitido.

Por essa razão, minimizar o custo por unidade de fluxo é equivalente a minimizar o tráfego retransmitido na rede, o que por 
sua vez, equivale a minimizar o processamento eletrônico de tráfego dos nós da rede \cite{Renato06}. Soma-se a isso o fato de 
que é necessária nesta modelagem a Restrição (\ref{DefCapFlow}), de limitação da capacidade $Cap$ dos canais lógicos. Deste 
modo, limitando o congestionamento na rede e minimizando o processamento, temos uma abordagem mais eficiente, quanto ao custo 
computacional, para o projeto da topologia virtual em comparação com a minimização do congestionamento da rede 
\cite{Renato06,ram02}. 

Se não for necessário ponderar o custo por unidade de fluxo, basta fazer $T=1$, e se não for necessário considerar o custo 
total de instalação ($CI = \sum_{mn} C_{mn}\cdot D_{mn}$), basta fazer $C_{mn}=0$ para todo $(m,n)$. Deste modo seria 
simplesmente um modelo de minimização do processamento, com limitação do congestionamento \cite{Renato06}. A função objetivo, 
que é a minimização do custo total $R = CI + Tc + Tv$, é dada explicitamente pela Restrição \ref{MinC}.

Quando a topologia física é um dado de entrada, o número de pares $(m,n)$ válidos é da ordem de $N\cdot H$. Assim o número de 
componentes da topologia generalizada será da ordem de $N²\cdot H\cdot W$, semelhante aos modelos mais enxutos para RWA 
\cite{Jaumard04}. Considerando $H$ e $W$ constantes, a ordem de grandeza do número de variáveis deste modelo será $N²$, 
similar a de modelos que resolvem apenas o VTD \cite{ram02}.

Como o número de componentes topológicas é $N³\cdotp W$ e o número de restrições é $\Theta(N²\cdotp W)$, o número de variáveis do modelo é da ordem de
$\Theta(N³\cdotp W)$. Quando a topologia física é um dado de entrada, sendo $H$ o número total de ligações físicas da rede, então o número de 
componentes da topologia generalizada será $N\cdotp H\cdotp W$. Supondo uma topologia física conexa, temos $H>N$ \cite{cormen02}. Assim, o número de variáveis do
modelo será $\Theta(N\cdotp H\cdotp W)$, semelhante aos modelos
mais enxutos para resolver apenas o RWA \cite{Jaumard04}.


% \section{Adaptações do Modelo Básico}
% \label{cap:twa-sec:adapt}

% Dada a abrangência do modelo básico, diversas métricas poderiam ser controladas ou diretamente minimizadas, conforme a aplicação.
% Apresentamos agora como podem ser incluídos parâmetros de 
% controle bem conhecidos e que serão utilizados nos experimentos computacionais dos Capítulos \ref{cap:testes-sec:karcius} e \ref{cap:testes-sec:sivarajan}.

% Uma métrica importante para o projeto de redes ópticas é o número de saltos físicos da topologia \cite{Zang00}. Este valor 
% é minimizado na Função Objetivo (\ref{Obj:B}), através da soma de todas as componentes topológicas, pois cada componente 
% topológica representa um salto físico. Uma propriedade importante desta abordagem é que ela evita o aparecimento de 
% ciclos na topologia generalizada. O ideal seria minimizar a distância percorrida por cada enlace lógico, o que controlaria a degradação do sinal óptico.
% Minimizar o número total de saltos é adotado por uma questão de compatibilidade com os resultados encontrados em \cite{Karcius04}, que serão usados na
% comparação dos experimentos computacionais do Capítulo \ref{cap:testes-sec:karcius}.

% Outro controle muito usado nas modelagens de RWA , é o número máximo de 
% ligações lógicas por fibra  $L$ (Dados \ref{adicionais}) \cite{Zang00,Jaumard04}. Este parâmetro limita a densidade da multiplexação de
% comprimentos de onda por enlace físico, um importante aspecto de Redes Ópticas WDM. Este limite é implementado pela Restrição (\ref{L}).

% No modelo TWA o número de ligações lógicas é implicitamente limitado pela capacidade física do nó $m$ de realizar ligações lógicas, que é a
% capacidade do \textit{Optical switch} de receber ou originar conexões \cite{Zang00}. Todavia, o número de transceptores em um nó, pode ser menor
% que essa capacidade \cite{Zang00,ram02}. Assumimos que todos os nós tem o mesmo número 
% de transceptores, que é chamado de grau lógico ($Gl$), que também passa a ser um dado de entrada. Para controlar 
% o grau lógico de saída e entrada em cada nó, é necessária a Restrição \ref{ConservGl}, que deve ser adicionada ao modelo básico.
% 
% A Restrição (\ref{ConservMl}) acrescenta a limitação da multiplicidade das ligações lógicas ($Ml$) ao modelo TWA, que é 
% indiretamente limitada pelo grau lógico. Para não usar multiplicidade nas ligações lógicas, basta fazer 
% $Ml=1$. 

% Como a multiplicidade das ligações lógicas fica implícita para as variáveis de 
% distribuição de tráfego, não é possível minimizar diretamente o tráfego em cada canal. Portanto, para minimizar o 
% congestionamento, seriam necessárias novas variáveis para contabilizar o tráfego em cada ligação lógica. Isso pode ser contornado adotando a Restrição
% (\ref{ConservMl}), com $Ml=1$. Deste modo, pode-se minimizar o congestionamento através da Restrição (\ref{Hmax}), adicionando também ao modelo básico a
% Variável (\ref{var:Hmax}) e a Função Objetivo (\ref{Obj:Hmax}).

% \begin{dados}
% Constantes adicionais:
% \begin{enumerate}
%  \item $Gl$ $=$ Grau Lógico.
%  \item $L$ $=$ Número máximo de ligações lógicas em cada fibra.
%  \item $Ml$ $=$ Multiplicidade das Ligações Lógicas.
% \end{enumerate}
% \label{adicionais}
% \end{dados}

% \begin{var}
% Seja $\lambda_{max}$ o congestionamento da rede.
% \label{var:Hmax} 
% \end{var}

% \begin{equation}
%  \label{L}
% \sum_{iw} B_{iw}^{mn}\leq L,\quad \forall (m,n).
% \end{equation}

% \begin{equation}
% \sum_{wn} B_{mw}^{mn} \leq Gl\quad\mbox{and}\quad 
% \sum_{inw} B_{iw}^{nm} - \sum_{inw} B_{iw}^{mn} \leqslant Gl\Forall{m},\, \mbox{\small$i\neq m$} 
% \label{ConservGl}
% \end{equation} 
% 
% \begin{equation}
% \sum_{nw} B_{iw}^{nm} - \sum_{nw} B_{iw}^{mn} \leqslant Ml\Forall{(i,m)},\, \mbox{\small$i\neq m$}
% \label{ConservMl}
% \end{equation}

% \begin{equation}
% \lambda_{max} \geqslant \sum_{sw} q_{sw}^{ij}\cdot A_s\Forall{(i,j)} \text{, } Ml=1
% \label{Hmax} 
% \end{equation}

% \begin{equation}
%  \label{Obj:B}
%  \text{\small Minimize: } \sum_{imnw} B_{iw}^{mn}.
% \end{equation}

% \begin{equation}
% \text{\small Minimize: } \lambda_{max}
% \label{Obj:Hmax} 
% \end{equation}

