
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Modelagem TWA
%% Copyright 2009 Fabio de Oliveira Lima.
%% Este documento é distribuído nos termos da licença 
%% GNU General Public License v2.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{TWA - Modelo para o Projeto Completo de uma WRON }
\label{Basic}

Neste capítulo será apresentada a forma básica do modelo TWA (\textit{Traffic over Wavelength Assignment}), começando pela notação designada aos nós e as
constantes que definem uma instância de
problema para o modelo. Em seguida serão definidas as variáveis utilizadas para compor as restrições e a função objetivo do modelo, passando-se
então à sua descrição. A função objetivo adotada na formulação básica é a minimização dos custos de instalação e operação da rede, valendo-se da capacidade do
modelo escolher também a topologia física da rede. Além disso, foi
considerada a restrição de conservação dos comprimentos de onda ao longo do caminho óptico \cite{Zang00}, ou seja, não se admite a conversão de comprimentos de
onda na camada óptica da rede nesta formulação básica. Outros casos de uso e extensões ao modelo básico serão apresentados no Capítulo \ref{cases}.

\section{Dados de Entrada e Variáveis}

\begin{notation}
Para uma rede de $N$ nós, os pares ordenados $(m,n)$, $(s,d)$ e $(i,j)$ indicam respectivamente ligações físicas, demandas de tráfego e ligações lógicas,
com $m\neq n$, $s\neq d$ e $i\neq j$, onde $m,n,s,d,i,j\in \{1,..,N\}$. O índice $w \in \{1,..,W\}$ representa comprimentos de onda, onde $W$ é a quantidade
limite de comprimentos de onda que podem ser usados. O índice $v\in \{1,..,N\}$ representa os nós da rede.
\end{notation}

\begin{figure}[htb]
\centering
\includegraphics[bb=43 653 523 825,scale=.9]{figs/indices.eps}
\caption{Representação gráfica da notação associada aos nós da rede.}
\label{fig:Indices}
\end{figure}

A Figura \ref{fig:Indices} ilustra os diferentes escopos dos índices associados aos nós da rede, com relação às ligações físicas $(m,n)$, ligações lógicas
$(i,j)$ e demandas de tráfego $(s,d)$. Esta notação segue a convenção comumente utilizada em trabalhos anteriores \cite{mukherjee,ram02}. É
importante dizer que esta modelagem suporta múltiplas ligações físicas e lógicas entre cada par de nós, portanto, os pares $(m,n)$ e $(i,j)$ representam
conjuntos de possíveis ligações físicas e lógicas, respectivamente. Esses conjuntos não serão explicitamente controlados, sendo esse um dos motivos
da simplicidade do modelo.

\begin{dados}
\label{Cons}
Uma instância para o modelo TWA é definida por:

\begin{enumerate}
\item $N$ $=$ Número de nós da rede.
\item $W$ $=$ Máximo de comprimentos de onda em uma ligação física.
% \item $H$ $=$ Grau físico máximo de entrada e saída de cada nó.
\item $K$ $=$ Máxima multiplicidade de ligações físicas entre cada par $(m,n)$.
\item $Cap$ $=$ Capacidade de tráfego de cada ligação lógica.
\item $C_{mn}$ $=$ Custo de uma ligação física entre o par $(m,n)$.
\item $T$ $=$ Custo por unidade de fluxo.
\item $P_{sd}$ $=$ Demanda de tráfego, com origem $s$ e destino $d$.
\item $A_s = \sum_d P_{sd} =$ Tráfego agregado pela origem $s$. 
\item $Q_{sd}=P_{sd}/A_s =$ Fração de $A_s$ correspondente à Demanda de tráfego $P_{sd}$.
\end{enumerate}
\end{dados}

% \clearpage

 \subsection{Componentes Topológicos}
% \label{Top}

A variável central do modelo, a partir da qual todas as demais serão definidas, chamada de componente topológico, é representada graficamente na Figura
\ref{fig:B} e formalmente definida na Variável \ref{comp}. Ela sozinha representa as topologias lógica e física, as rotas físicas das 
ligações lógicas e os comprimentos de onda utilizados.

\begin{var}
\label{comp}
 Seja $B_{iw}^{mn} = k\in \{0,..,K\}$, com $i\neq n$, um componente do conjunto das ligações lógicas com origem $i$ e comprimento de onda $w$,
que utilizam $k$ ligações físicas entre os nós $m$ e $n$.
\end{var}

\begin{figure}[hbt]
 \centering
\includegraphics[bb=177 683 405 753, scale=0.9]{figs/B.eps}
% B.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=36 739 246 805
 \caption{Representação gráfica de um componente topológico.}
 \label{fig:B}
\end{figure}

Considerando que $B_{iw}^{mn}=k$ para algum $k \in \{0,..,K\}$, existem $k$ ligações lógicas originadas em $i$ no comprimento de onda $w$, passando
por $k$ ligações físicas distintas entre o par de nós $(m,n)$.  Conforme a terminologia utilizada
neste trabalho daqui por diante, \textit{um componente topológico $B_{iw}^{mn} = k$ é iniciado em $m$, incidente em $n$, com origem $i$,
comprimento de onda $w$ e valor $k$}.

Se $k>1$, então há multiplicidade de ligações físicas entre o par de nós $(m,n)$,
pois haveria interferência se houvessem duas ligações lógicas se propagando na mesma ligação física, com o mesmo comprimento de onda. Note
que $K$ limita apenas a multiplicidade das ligações físicas, pois se $K=1$, $B_{iw}^{mn}$ se torna uma variável binária, mas ainda podem haver múltiplas
ligações lógicas entre um par $(i,j)$, utilizando rotas físicas distintas, ou ainda, comprimentos de onda diferentes em uma mesma
rota física. Se $B_{iw}^{mn}=0$, $\forall\,(i,w)$, então nenhuma ligação física entre o par de nós $(m,n)$ é utilizada.

 Na Figura \ref{fig:Tops}, temos um exemplo de interpretação dos componentes topológicos, todos com origem no nó $v_1$ e com o 
mesmo comprimento de onda $w_1$. No item $d)$ desta figura, o valor $2$ do componente que liga os nós $(v_1,v_2)$ é interpretado 
como duas ligações físicas entre esses nós, representadas no item $a)$. No item $b)$, vemos uma ligação lógica dupla entre os 
nós $(v_1,v_3)$, onde uma delas passa de forma transparente pelo nó $v_2$, como indicado no item $c)$. Note ainda que, no item 
$d)$, há dois caminhos lógicos incidentes em $v_2$ mas apenas um iniciando. Isso indica que uma ligação lógica termina em $v_2$, 
enquanto a outra segue adiante.

% \clearpage
\begin{figure}[hbt]
 \centering
\includegraphics[width=0.8\textwidth]{figs/topologias-twa.eps}
% \includegraphics[bb=39 455 511 811, scale=0.4]{figs/topologias.eps}
 % topologias.eps: 1179666x1179666 pixel, 300dpi, 9987.84x9987.84 cm, bb=30 375 511 801
 \caption{Exemplo da interpretação dos componentes topológicos.}
 \label{fig:Tops}
\end{figure}
% \clearpage

A indexação atribuída às variáveis $B_{iw}^{mn}$ especificam apenas o nó $i$ onde se iniciam as ligações lógicas representadas, sem deixar claro
aonde elas terminam. Isto significa que estas variáveis agregam todas as ligações lógicas originadas em $i$ com comprimento de onda $w$, que utilizam as
ligações físicas entre o par $(m,n)$, independente do nó $j$ em que terminam estas ligações lógicas. Esta técnica consiste em uma abordagem bastante
conhecida para a representação de variáveis em problemas de distribuição de fluxo em redes. Em \cite{Tornatore07}, este conceito de agregação de tráfego é
aplicado como meio de simplificação do modelo, reduzindo substancialmente o número de variáveis dos problemas resultantes. No TWA, esta agregação cumpre o
mesmo papel de simplificação, cabendo às restrições do modelo garantir implicitamente a terminação correta destas ligações lógicas agregadas nas variáveis
$B_{iw}^{mn}$.

Para fins de comparação entre modelos de programação inteira, usualmente uma variável que pode assumir $K$
valores diferentes é convertida em $K$ variáveis binárias \cite{cormen02}. A princípio, o número de variáveis binárias associadas aos componentes
topológicos seria $N^3\cdotp W\cdotp K$ \cite{cormen02}, mas devemos excluir algumas que são trivialmente nulas: aquelas com $i=n$, pois $i$ não pode ser
origem da ligação lógica e ao mesmo tempo destino da ligação física ($n$). Isso resulta em $N^3\cdotp W\cdotp K - N^2\cdotp K$.


\subsection{Fração de Fluxo das Demandas de Tráfego}
\label{cap:twa-sec:VarFracFlow}

Para resolver o sub-problema de roteamento de tráfego, é definida a variável Variável \ref{FlowVar}, que modela a fração de fluxo agregado para as
demandas de tráfego. Elas são
semelhantes às variáveis de fluxo agregado utilizadas em \cite{ram96}, todavia há duas diferenças. Uma delas é que aqui essas variáveis são normalizadas em
função do tráfego agregado na origem ($A_s$), e são portanto uma fração deste. Essa modificação não é requerida pela modelagem, tendo apenas a função de
facilitar a compreensão das restrições do modelo, que ficam menos dependentes do dados de entrada. 

A outra diferença é que o fluxo é separado por comprimento de onda, como se fossem $W$ redes sem multiplexação sobrepostas. Isso facilita a interpretação
das
restrições do modelo, e também ajuda a mantê-lo mais simples. De fato, o controle da distribuição de fluxo deve ser feito em cada ligação lógica
\cite{ram02}, mas a restrição de continuidade de comprimentos de onda exige uma equação para cada $w$ separadamente \cite{Zang00}. Soma-se a isso o fato de
que nesta modelagem múltiplas ligações lógicas são agregadas em cada par $(i,j)$ para todos os valores $w$ utilizados. Assim, separando o tráfego por
comprimento de onda, foi possível combinar o controle da distribuição de tráfego com a restrição de continuidade de comprimentos de onda. Isso será tratado
com mais detalhes na Seção \ref{cap:twa-sec:Bconserv_Cap}.

\begin{var}
 \label{FlowVar}
 Seja $q_{sw}^{ij} \in [0,1]$ a fração do fluxo originado em $s$, passando pelas ligações lógicas entre o par $(i,j)$ com comprimento de onda $w$,
onde $s\neq j$. 
\end{var}

Também devem ser excluídas do modelo, por serem trivialmente nulas, as frações de fluxo com $s=j$. Pois $j$ é destino do tráfego, não podendo ser ao mesmo
tempo origem ($s$). Assim, o número de variáveis reais associadas às frações de fluxo é $N^3\cdotp W - N^2$.

\subsection{Topologia Física}
\label{cap:twa-sec:VarFis}

Apesar da topologia física ser determinada pelos componentes topológicos, para fins de controle do custo de instalação da rede física,
são necessárias novas incógnitas. Para este fim, é definida a Variável \ref{FisVar}, que registrará em $D_{mn}$ a multiplicidade física determinada pelos
componentes topológicos. Se $D_{mn}=0$, não há ligações físicas entre o par $(m,n)$, mas se $D_{mn}=k$, para algum $k \in \{0,..,K\}$, existem $k$ ligações
físicas entre o par $(m,n)$.

\begin{var}
\label{FisVar}
 Seja $D_{mn} \in \{0,..,K\}$ o número de ligações físicas entre o par de nós $(m,n)$. 
\end{var}

O número de variáveis binárias associadas à $D_{mn}$ é  $N^2\cdotp K - N\cdotp K$ \cite{cormen02}, pois deve-se desconsiderar as variáveis onde $m=n$. 

 \section{Custo de instalação e Operação}
 \label{cap:twa-sec:funcaoobjetivo}


Duas métricas importantes no projeto da redes ópticas são os custos de instalação e operação \cite{mukherjee}. 
O custo de instalação $C_{mn}$ é o custo associado a uma ligação física entre o par de nós $(m,n)$. O custo total de instalação é dado na equação
\ref{eq:custoInstlacao}. O custo de operação $TO$, definido como o custo por unidade de fluxo, é calculado na equação \ref{eq:CustoDeOperacao}, e
influencia também no dimensionamento dos nós da rede.

\begin{equation}
   CI = \sum_{mn} C_{mn}\cdot D_{mn}
   \label{eq:custoInstlacao}
\end{equation}


\begin{equation}
    TO = \sum_{sijw} T\cdot q_{sw}^{ij}\cdot A_s
    \label{eq:CustoDeOperacao}
\end{equation}

O custo de operação pode ser dividido em duas partes: uma constante, formada pelas demandas de tráfego (equação \ref{eq:Tc}), que necessariamente
deverão ser roteadas; e outra variável, composta pelo tráfego adicional que é gerado, ou seja, o tráfego 
retransmitido (equação \ref{eq:Tv}). A parte constante do custo de operação não influenciaria na função objetivo, por isso não será incluída em seu cálculo,
dado na equação \ref{eq:FO}.

\begin{equation}
     TOC = \sum_{sd} T\cdot P_{sd}
   \label{eq:Tc}
\end{equation}

\begin{equation}
     TOV = \sum_{sijw} T\cdot q_{sw}^{ij}\cdot A_s\,,\quad \mbox{\small$i\neq s$}
   \label{eq:Tv}
\end{equation}

\begin{equation}
   FO = CI + TOC
   \label{eq:FO}
\end{equation}

Outro ponto positivo dessas métricas é que minimizar o custo por unidade de fluxo é equivalente a minimizar o tráfego retransmitido na rede, o que por 
sua vez, equivale a minimizar o processamento eletrônico de tráfego dos nós da rede \cite{Renato06}. Além disso, será necessária nesta modelagem uma
restrição de limitação da capacidade das ligações lógicas ($Cap$), que equivale à limitar o congestionamento na rede. Assim, limitando a capacidade e
minimizando o custo de operação, temos uma abordagem eficiente, quanto ao custo 
computacional, para controlar também o congestionamento e o processamento, importantes métricas no projeto da topologia virtual \cite{Renato06,ram02}. 

Se não for necessário ponderar o custo por unidade de fluxo, basta fazer $T=1$, e se não for necessário considerar o custo 
total de instalação ($CI$), basta fazer $C_{mn}=0$ para todo $(m,n)$. Deste modo seria 
simplesmente um modelo de minimização do processamento, com limitação do congestionamento \cite{Renato06}. 


 \section{O Modelo TWA}
 
 Nesta seção é apresentada a forma básica do modelo TWA. Suas restrições são apresentadas a seguir, após a função objetivo apresentada na seção anterior.

\textbf{Função Objetivo}


\begin{itemize}

\item Minimizar o Custo de Instalação e Operação:

\begin{equation}
 \sum_{mn} C_{mn}\cdot D_{mn} + \sum_{sijw} T\cdot q_{sw}^{ij}\cdot A_s \,,\quad \mbox{\small$i\neq s$}
\label{fo:MinC}
\end{equation}

\end{itemize}

\textbf{Restrições}

\begin{itemize}
 \item Restrição de Continuidade de Comprimentos de Onda e Limitação de Capacidade:

\begin{equation}
\sum_{s} q_{sw}^{iv}\cdot A_s \leqslant Cap\cdot \left(\sum_{m} B_{iw}^{mv} - \sum_{n} B_{iw}^{vn}\right) \Forall{(i,v,w)} \mbox{, com $i\neq v$}
\label{rest:DefCapFlow}
\end{equation} 

\item Topologia Física:

\begin{equation}
\sum_i B_{iw}^{mn} \leqslant D_{mn} \Forall{(m,n,w)}
\label{rest:DefFis}
\end{equation} 

\item Conservação de Fluxo:

\begin{equation}
\sum_{jw} q_{vw}^{vj} = 1 \Forall{v} 
\label{rest:ConservFlowOut}
\end{equation} 
 
\begin{equation}
\sum_{iw} q_{sw}^{iv} - \sum_{jw} q_{sw}^{vj} = Q_{sv} \Forall{(s,v)} \mbox{, com $s\neq v$}
\label{rest:ConservFlow}
\end{equation}
 
\end{itemize}

O número de equações no modelo básico é $ 2\cdot N^2\cdot W + N^2 + N $, que em notação assintótica é $\Theta(N^2\cdot W)$ \cite{cormen02}. Somando o
número variáveis binárias associadas aos componentes topológicos, mais as associadas à topologia física, temos $\Theta(N^3\cdotp
W\cdotp K)$. Portanto, em número de variáveis e restrições, o TWA é similar a modelos eficientes, mas que resolvem
apenas o sub-problema RWA, como os que foram estudados em \cite{Jaumard04}. Na Tabela \ref{tab:num_var} são resumidos os dados sobre número de
variáveis e equações.

\begin{table}[htb]
{%
\newcommand{\mc}[3]{\multicolumn{#1}{#2}{#3}}
\begin{center}
\begin{tabular}{lll}\hline
\mc{1}{|l|}{Binárias} & \mc{1}{l|}{Reais} & \mc{1}{c|}{Equações}\\\hline
\mc{1}{|l|}{$\Theta(N^3\cdotp W\cdotp K)$} & \mc{1}{|l|}{$\Theta(N^3\cdot W)$} & \mc{1}{|l|}{$\Theta(N^2\cdot W)$}\\\hline
\end{tabular}
\end{center}
}%
\caption{Numero de variáveis binárias, reais e equações no TWA.}
\label{tab:num_var}
\end{table}



\subsection{Planos Lógicos}
\label{cap:twa-sec:planos}

Como os componentes topológicos e as frações de fluxo são indexados pelo comprimento de onda, a distribuição tráfego é feita em partes disjuntas da
topologia lógica, também separadas por comprimento de onda. De fato, esta modelagem é focada nas rotas físicas; elas é que definem as topologias lógica e
física. Pode-se separar as rotas e seu respectivo tráfego em partes disjuntas da rede, agrupadas por cada valor de $w$. Essas rotas não compartilham as
mesmas ligações físicas pois todas possuem o mesmo comprimento de onda. Todavia podem não ser disjuntas pois ainda é possível que passem por um mesmo nó
intermediário.

Mas essa separação só ocorre na
topologia lógica, pois cada rota corresponde a uma ligação lógica. Na topologia física, duas rotas podem compartilhar uma mesma ligação física utilizando
comprimentos de onda diferentes.

Na Figura \ref{fig:planos_logicos} é representada a separação da topologia lógica por
comprimentos de onda. Essas porções disjuntas são vistas na figura como planos paralelos que, quando sobrepostos, formam a topologia
lógica. Esses planos serão aqui chamados de planos lógicos, cada um associado a um comprimento de onda, onde um par $(i,j)$ pode ainda representar múltiplas
ligações lógicas utilizando um mesmo $w$. 

\begin{figure}[htb]
	\centering
	\includegraphics[bb=152 525 500 792,scale=0.7]{./figs/planos_logicos.eps}
	% planos_logicos.eps: 0x0 pixel, 300dpi, 0.00x0.00 cm, bb=152 524 442 792
	\caption{Esquema da separação da topologia lógica por comprimento de onda.}
	\label{fig:planos_logicos}
\end{figure}

Essa forma de visualizar a topologia lógica tem apenas a finalidade de facilitar a interpretação das restrições,
pois permite ver o projeto como se fossem $W$ redes sem multiplexação sobrepostas.
Nas seções que se seguem no restante deste capítulo, a separação da topologia lógica por comprimento de onda será usada na explanação sobre as restrições do
modelo TWA.  

\subsection{Continuidade de Comprimentos de Onda e Capacidade}
\label{cap:twa-sec:Bconserv_Cap}

A Restrição \ref{rest:DefCapFlow} acumula múltiplas funções, atuando como restrição de continuidade de comprimentos de onda e limitação de
capacidade. Em cada plano lógico $w$, ela garante a continuidade das rotas físicas, onde os componentes topológicos devem formar uma caminho sobre a
topologia física, conservando o mesmo comprimento de onda. Esses percursos não são controlados explicitamente; eles são garantidos pela conservação dos
componentes topológicos nos nós intermediários, semelhante a uma restrição de conservação de fluxo \cite{ramamurthy99}. 

A Restrição \ref{rest:DefCapFlow} é repetida na equação \ref{eq:DefCapFlow} para facilitar a leitura desta seção. Nela, a conservação dos percursos lógicos
é feita da seguinte forma: a soma dos componentes das ligações lógicas iniciadas em um nó $i$ no plano $w$, partindo de um nó intermediário $v$, deve ser
menor ou igual à quantidade recebida. Isso é garantido se a equação \ref{eq:ConserB} for satisfeita.

\begin{equation}
\sum_{s} q_{sw}^{iv}\cdot A_s \leqslant Cap\cdot \left(\sum_{m} B_{iw}^{mv} - \sum_{n} B_{iw}^{vn}\right) \Forall{(i,v,w)} \mbox{, com $i\neq v$}
\label{eq:DefCapFlow}
\end{equation} 

\begin{equation}
   \sum_{n} B_{iw}^{vn} \leqslant \sum_{m} B_{iw}^{mv}  \Forall{(i,v,w)}
   \label{eq:ConserB}
\end{equation}

A equação \ref{eq:ConserB} pode ser reescrita na forma da equação \ref{eq:ConserBdif}, que define $LL^{iv}_w$, a diferença entre a soma dos
componentes chegando e saindo de $v$, originados em $i$ no plano $w$. O valor
$LL^{iv}_w$ representa a quantidade de ligações lógicas que não têm continuidade ao passar por $v$, ou seja, são as ligações lógicas incidentes em $v$,
com origem em $i$ no plano $w$.

\begin{equation}
  LL^{iv}_w = \sum_{m} B_{iw}^{mv} - \sum_{n} B_{iw}^{vn} \geqslant 0 \Forall{(i,v,w)}
   \label{eq:ConserBdif}
\end{equation}

 Por sua vez, a equação \ref{eq:ConserBdif} é equivalente à equação
\ref{eq:ConserBcap}. Este última é garantida pela Restrição \ref{rest:DefCapFlow}, como fica demostrado pela equação \ref{eq:ConserBfim}, pois tomando-a
como premissa conclui-se a equação \ref{eq:ConserBcap}. Portanto, a equação \ref{eq:ConserB} é válida. 

\begin{equation}
   0  \leqslant Cap\cdot LL^{iv}_w \Forall{(i,v,w)}
   \label{eq:ConserBcap}
\end{equation}

\begin{equation}
   \sum_{s} q_{sw}^{iv}\cdot A_s  \leqslant Cap\cdot LL^{iv}_w \Forall{(i,v,w)}
   \label{eq:ConserBfim}
\end{equation}

Na figura \ref{fig:Bconserv} é ilustrada a forma como a conservação dos percursos lógicos é feita. Nela vê-se dois componentes chegando no
nó intermediário $v$, ambos compõem ligações lógicas no plano $w$ iniciadas no nó $i$, que não está representado na figura, igualmente ao componente que
deixa $v$. A soma dos valores dos componentes que chegam é $3$ e a dos que saem é $2$, portanto a conservação está mantida. Neste exemplo, como há
diferença de $1$ entre a quantidade de componentes chegando e saindo de $v$, então, necessariamente há $1$ ligação lógica terminando em $v$; para a qual
ele deixa de ser visto como um nó intermediário, se tornando o destino dessa ligação lógica. A conservação não seria mantida no plano $w$ houvessem
componentes partindo de $v$ em maior quantidade do que chegando, pois ai não haveria rastreabilidade do percurso até sua origem $i$. 
 
\begin{figure}[htb]
	\centering
	\includegraphics[bb=109 621 445 749,scale=0.7]{./figs/B_conserv.eps}
	% B_conserv.eps: 0x0 pixel, 300dpi, 0.00x0.00 cm, bb=106 272 452 749
	\caption{Conservação dos Percursos Lógicos.}
	\label{fig:Bconserv}
\end{figure}

A Restrição \ref{rest:DefCapFlow} é um conjunto de equações, onde cada uma trata de um par $(i,j)$ em um plano lógico $w$. Portanto, a capacidade das
ligações lógicas associadas ao par $(i,j)$ é a capacidade de cada uma ($Cap$) multiplicada pelo número de ligações lógicas entre $(i,j)$ no plano lógico
$w$.
Este segundo fator é $LL^{ij}_w$, calculado na equação \ref{eq:ConserBdif}. Todo o tráfego passando pelas ligações lógicas $(i,j)$ nesse plano
deve ser limitado por $Cap\cdot
LL^{ij}_w$, o que de fato é feito pela Restrição \ref{rest:DefCapFlow}. 

A Restrição \ref{rest:DefCapFlow} ainda acumula uma função que, por ser intuitiva, pode passar desapercebida, mas é fundamental para a consistência do
modelo. Ela anula as frações de fluxo agregado entre os nós não conectados diretamente por ligações lógicas. Quando $LL^{ij}_w = 0$, ou seja, não
há ligações lógicas entre o par $(i,j)$ no plano $w$, as frações de fluxo $q_{sw}^{ij}$ serão anuladas pela Restrição \ref{rest:DefCapFlow}, para todas as
origens $s$.

\subsection{Controle da Topologia Física}

Com a finalidade de controlar pela função objetivo \ref{fo:MinC} a quantidade de ligações físicas definidas pelos componentes topológicos, a Restrição
\ref{rest:DefFis} acumula nas variáveis $D_{mn}$ a multiplicidade determinada pelos componentes. Ela é repetida na
equação \ref{eq:DefFis} para facilitar a leitura desta seção. Dado um par $(m,n)$, as equações
dessa restrição são ainda separadas por comprimento de onda. Pois se todos os componentes topológicos alocados em $(m,n)$ usarem o mesmo $w$, apenas uma
ligação física será necessária. Se usarem comprimentos de onda diferentes, $D_{mn}$ precisará atender ao maior desses componentes topológicos. Portanto, a
restrição \ref{rest:DefFis}, minimiza a soma dos maiores de componentes topológicos em cada par $(m,n)$, por força do fator $CI$ na função objetivo (Seção
\ref{cap:twa-sec:funcaoobjetivo}).

\begin{equation}
\sum_i B_{iw}^{mn} \leqslant D_{mn} \Forall{(m,n,w)}
\label{eq:DefFis}
\end{equation} 

\begin{figure}[htb]
	\centering
	\includegraphics[bb=37 371 534 812, scale=0.7]{./figs/Var_Dmn.eps}
	% Var_Dmn.eps: 0x0 pixel, 300dpi, 0.00x0.00 cm, bb=34 593 536 800
	\caption{Interpretação dos componentes topológicos na variável $D_{mn}$.}
	\label{fig:varDmn}
\end{figure}

Na Figura \ref{fig:varDmn} está um exemplo de interpretação dos componentes topológicos na variável $D_{mn}$. No item $a$ estão os componentes topológicos
que definem as ligações físicas indicadas no item $b$. Nos itens $c$ e $d$ estão as ligações lógicas e as rotas físicas correspondentes.

\subsection{Conservação de Fluxo}

A conservação de fluxo é assegurada pelas Restrições \ref{rest:ConservFlowOut} e \ref{rest:ConservFlow}, que também garantem o envio e a entrega das
demandas de tráfego. Elas são repetidas nas equações \ref{eq:ConservFlowOut} e \ref{eq:ConservFlow} para facilitar a leitura desta seção.  
Essas restrições são semelhantes às encontradas na modelagem agregada para o VTD \cite{ram02}. Além da separação do tráfego por
comprimento de onda e da normalização das variáveis, como foi comentado na Seção \ref{cap:twa-sec:VarFracFlow}, a interpretação das restrições é
sutilmente diferente pois um par $(i,j)$ representa um conjunto de ligações lógicas. 

\begin{equation}
\sum_{jw} q_{vw}^{vj} = 1 \Forall{v} 
\label{eq:ConservFlowOut}
\end{equation} 
 
\begin{equation}
\sum_{iw} q_{sw}^{iv} - \sum_{jw} q_{sw}^{vj} = Q_{sv} \Forall{(s,v)} \mbox{, com $s\neq v$}
\label{eq:ConservFlow}
\end{equation}

Cada par $(i,j)$ é visto nas restrições de controle de fluxo como um único caminho, unindo todos os planos lógicos. Se o par representar na verdade
múltiplas
ligações lógicas, a diferença é que ele terá uma capacidade maior de receber tráfego, que é controlada pela Restrição \ref{rest:DefCapFlow}. Deste modo,
essas restrições funcionam da mesma forma que em \cite{ram96}. Portanto, são as restrições de conservação de fluxo que fazem a correlação ente os planos
lógicos.

A Restrição \ref{rest:ConservFlowOut} garante que todo o tráfego originado em cada nó $v$ seja emitido para a rede, exigindo que a soma das frações
de tráfego, em todos os planos lógicos, que iniciam na origem ($i=s=v$) seja igual a $1$, ou seja, $100\%$ do tráfego originado em $v$. 

Por sua vez, a
Restrição \ref{rest:ConservFlow} garante que o tráfego emitido seja encaminhado através da rede e entregue no destino. Fixada uma origem de tráfego $s$,
para cada nó intermediário $v$ ($v\neq s$) a porção de tráfego que deve ser entregue é $Q_{sv}$. Ela é igual à soma do tráfego chegando por todos
os planos lógicos $w$, vindo de qualquer nó intermediário $i$, subtraída da soma do tráfego partindo com destino a qualquer nó $j$, em qualquer
plano $w$. O tráfego não entregue em $v$ continua seguindo seu caminho pela rede até seu destino, e deste modo é feita rastreabilidade do tráfego até sua
origem. Esta restrição apenas não garante que o tráfego seja emitido na origem, tarefa cumprida pela Restrição \ref{rest:ConservFlowOut}.

O tráfego pode ser subdividido e transportado simultaneamente por mais de uma ligação lógica entre o par $(i,j)$, no plano $w$. Neste caso, como as rotas
terão o mesmo comprimento de onda, eles não compartilham ligações físicas ao longo do percurso. Mas essas rotas podem ainda não ser disjuntas, pois é
possível compartilharem nós intermediários.

\section{Limitações da Forma Básica do TWA}

Dada a forma agregada como é feito o roteamento dos comprimentos de onda e também pela forma implícita do tratamento de múltiplas ligações lógicas, sem
separá-las em variáveis de decisão próprias, algumas questões de menor complexidade não são decididas pelo TWA.  Na solução provida pelo modelo, são
alocados recursos suficiente para
atender ao projeto, da forma mais econômica possível. Mas nem todos os detalhes da configuração da rede são determinados.

Como será mostrado nesta seção, essas omissões não
prejudicam o projeto dentro do escopo adotado. Podendo essas questões não resolvidas serem tratadas em fases posteriores do projeto a partir da solução
provida pelo modelo. Isso garante a simplicidade do TWA, permitindo uma modelagem com poucas restrições e variáveis. 

Na lista a seguir são enumeradas as limitações da forma básica do TWA. Em seguida, cada uma será explicada e formas de tratá-las serão
sugeridas.

\begin{enumerate}
	\item Pode não haver uma forma única para configuração das rotas físicas em cada plano lógico.
	\item Podem ocorrer ciclos nas rotas físicas.
	\item Pode não ser possível saber com exatidão a distância percorrida pelo tráfego.
	\item Não é modelada a exata divisão do tráfego entre múltiplas ligações lógicas.
	\item Não é possível minimizar diretamente o congestionamento na forma básica do modelo.
	\item Podem haver ligações físicas não utilizadas na solução.
\end{enumerate}

Como o roteamento de comprimento de onda é feito de forma agregada, podem haver mais de uma possibilidade de configuração das rotas físicas em cada plano
lógico. Na Figura \ref{fig:B_unsolved}, é mostrado um arranjo de componentes topológicos com duas possibilidades de interpretação. Necessariamente duas
ligações lógicas no plano $w_1$ passam transparentemente por $v_4$, enquanto uma nele termina. Ambas possibilidades de interpretação dos componentes são
válidas, ou seja, o TWA não modela o exato percurso físico das ligações lógicas em cada plano. Todavia,
isso não interfere na modelagem do restante do problema e não precisa ser resolvido nesta fase do projeto. 

De posse da solução provida pelo TWA, as
rotas que possuírem alternativas de configuração podem ser decididas levando-se em consideração outras métricas não abordadas aqui, como por exemplo o fator
BL, que pondera tráfego com a distância percorrida sobre a topologia física \cite{Agrawal97}. Esse tratamento seria feito para cada par $(i,j)$
independente, sendo questões de baixa complexidade.

\begin{figure}[htb]
	\centering
	\includegraphics[bb=108 270 473 811,scale=0.7]{./figs/B_unsolved.eps}
	% B_unsolved.eps: 0x0 pixel, 300dpi, 0.00x0.00 cm, bb=108 270 473 811
	\caption{Duas possibilidades de interpretação dos componentes topológicos.}
	\label{fig:B_unsolved}
\end{figure}

Na forma básica do modelo TWA, podem aparecer ciclos nas rotas físicas, pois não há esse controle no modelo básico. Isso poderia ser minimizado adicionando
a soma de todos os componentes topológicos na função objetivo. Mas esses ciclos não interferem na modelagem e podem ser facilmente localizados e retirados
analisando a solução obtida.

Outra questão a ser determinada envolve o fato de um par $(i,j)$ poder representar múltiplas ligações lógicas. Sempre haverá banda suficiente
para atender ao tráfego alocado respeitando à capacidade individual; isso é garantido pela Restrição \ref{rest:DefCapFlow}. Todavia, na distribuição do
tráfego cada par $(i,j)$ é visto como um único caminho, e o tráfego é separado apenas por comprimento de onda. O tráfego pode ser subdividido e
transportado simultaneamente por mais de uma ligação lógica entre o par $(i,j)$ no plano $w$, sem compartilhar ligações físicas ao longo do percurso. Mas
não fica definida a divisão de tráfego entre cada ligação. 

A exata divisão do tráfego também pode ser definida em outra fase do projeto
e não precisa ser modelada aqui. Todavia, seria razoável assumir que o tráfego fosse dividido igualmente entre as ligações, para não sobrecarregar uma em
detrimento da outra. Ou poderia-se também aplicar o fator BL para fazer a divisão do tráfego considerando a distância percorrida. Novamente, essas
situações são pontuais, resolvendo-se para cada par $(i,j)$ individualmente sem demandar expressivo custo computacional.

Em virtude de não ser modelada a exata divisão do tráfego entre múltiplas ligações lógicas, não é possível minimizar diretamente o
congestionamento \cite{ram02}. Mas, a capacidade das ligações lógicas pode exercer o papel de limitante superior (\textit{upper bound}) para o
congestionamento. Conjuntamente com a minimização do tráfego na função objetivo, como foi comentado na Seção \ref{cap:twa-sec:funcaoobjetivo}, temos uma boa
abordagem para tratar do congestionamento, como foi demostrado em \cite{Renato06}.

Por fim resta tratar da possibilidade da topologia física determinada pelos componentes topológicos poder ser superestimada na variável $D_{mn}$.
A Restrição \ref{rest:DefFis} apenas exige que a variável $D_{mn}$ seja suficiente para atender aos componentes topológicos, mas permite que ela assuma
valores maiores que o necessário. Todavia, esse possível excesso não interfere na consistência do que é modelado pelos componentes topológicos. Além disso,
ele é controlado indiretamente minimizando a função objetivo, por meio do custo de instalação, e pode ainda ser tratado analisando a solução fornecida,
extraindo os valores corretos diretamente dos componentes topológicos. A correção feita através da função objetivo funcionaria também com qualquer outra
métrica diretamente relacionada com a variável $D_{mn}$ que fosse minimizada. 






